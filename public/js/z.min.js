store.get("client_blocks")||store.set("client_blocks","");var check_ratelimit_interval=300,content_dms_queued=[],content_mentions_queued=[],content_queued=[],content_rts_stored=[],content_threads_stored=[],content_stored=[],dms_cutoff=50,dms_loaded=0,following=[];store.get("geo")||store.set("geo","on");if(store.get("geo")=="on")var geo_high_accuracy=false,geo_refresh_interval=300,geo_timeout=120;store.get("hashtag_blocks")||store.set("hashtag_blocks","");var home_cutoff=200;
store.get("klout")||store.set("klout","on");var klout=[],kloutinfo_params={className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]};store.get("lang")||store.set("lang","english");var latest_threaded_id=0,latitude=false,loaded=false,longitude=false,max_file_size=2;store.get("mention_blocks")||store.set("mention_blocks","");var mentions_cutoff=100;store.get("notifications")||store.set("notifications","on");
var paused=false,prune_tweets_interval=60,pttid=0,rates=350,remember_cutoff=199,reply_id=false,screen_name="",shortened=false,socket="",stream_queue_interval="";store.get("sound")||store.set("sound","on");store.get("sound-src")||(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?store.set("sound_src","/audio/notify.mp3"):store.set("sound_src","/audio/notify.ogg"));if(store.get("sound")=="on"&&store.get("sound_src").length>0){var audio=new Audio;audio.src=store.get("sound_src")}
store.get("stream_interval")||store.set("stream_interval",1.5);var threaded_cutoff=50,translation="",update_relative_dms_interval=60,update_relative_home_interval=15,update_relative_mentions_interval=30,user_id=0,userinfo_params={className:"user",hideDelay:3,showOn:"click",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]};store.get("user_blocks")||store.set("user_blocks","");store.get("users")||store.set("users","");
function z_engine_attrition(){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>=3||BrowserDetect.browser=="Chrome"||BrowserDetect.browser=="Opera"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"){socket=io.connectWithSession();if(!loaded){z_engine_set_language();store.get("geo")=="on"&&z_engine_geo();new Event.observe("logout","click",function(a){Event.stop(a);z_engine_logout()});$("loading-home").center(8);$("loading-mentions").center(8);
$("loading-inbox").center(8);$("loading-outbox").center(8)}socket.on("connect",function(){loaded||$("new-tweet").setValue("connected...")});socket.on("message",function(a){var b=JSON.stringify(a);if(b.isJSON()&&b.evalJSON(true)){b="";if(a.loaded&&!loaded){loaded=true;$("new-tweet").setValue("");$("new-tweet").enable();(new Control.Tabs("tabbed",{afterChange:function(){if(z_engine_current_timeline()!="threaded-timeline"){$("threaded-timeline").update();latest_threaded_id=0}}})).first();z_engine_check_ratelimit();
socket.emit("message",{fetch:"home"});window.setTimeout(function(){socket.emit("message",{fetch:"mentions"})},1E4);window.setTimeout(function(){socket.emit("message",{fetch:"dms-inbox"})},2E4);window.setTimeout(function(){socket.emit("message",{fetch:"dms-outbox"})},3E4);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.dms")},
update_relative_dms_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.threaded")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_check_ratelimit()},check_ratelimit_interval);new PeriodicalExecuter(function(){paused||z_engine_prune_tweets()},prune_tweets_interval);stream_queue_interval=new PeriodicalExecuter(function(){paused||z_engine_stream_queue()},store.get("stream_interval"));store.get("geo")=="on"&&new PeriodicalExecuter(function(){z_engine_geo()},
geo_refresh_interval);new PeriodicalExecuter(function(){z_engine_input()},1);b=$w(store.get("users").strip()).uniq();var c="";b.each(function(f){c+=f.replace(/@/i,"")+" "});new Autocompleter.Local("new-tweet","autocompleter",b,{choices:20,minChars:2,tokens:" ",afterUpdateElement:function(){$("new-tweet").setValue($("new-tweet").getValue()+" ")}});new Autocompleter.Local("new-dm-user","autocompleter-dm",$w(c.strip()).uniq(),{choices:20,minChars:2});store.get("geo")=="on"&&new HotKey("l",function(){z_engine_geo()},
{shiftKey:true});new HotKey("o",function(){z_engine_clear_timeline()},{shiftKey:true});new HotKey("p",function(){z_engine_tweet_pause()},{shiftKey:true});new HotKey("s",function(){z_engine_shorten_urls()},{shiftKey:true});b=(new Element("button",{className:"window-close"})).update("X");(new Control.Modal($(document.body).down("[href=/account/settings]"),{className:"window",closeOnClick:b,fade:true,method:"GET",overlayOpacity:0.75})).container.insert({top:b});new Event.observe("new-tweet","keyup",
function(){z_engine_input()});new Event.observe("new-tweet","keydown",function(){z_engine_input()});new Event.observe("new-tweet-form","submit",function(f){Event.stop(f);z_engine_send_tweet()});new Event.observe("pause","click",function(f){Event.stop(f);z_engine_tweet_pause()});z_engine_image_dropper();z_engine_notification_setup()}else if(a.loaded&&loaded)$("new-tweet").enable();else if(a["delete"]){b=typeof a["delete"].status=="object"?a["delete"].status.id_str:0;z_engine_drop_tweet(b)}else if(a.direct_message){z_engine_tweet(a.direct_message,
"dms");if(a.direct_message.sender.screen_name!=screen_name){b=a.direct_message.sender.profile_image_url;var d=a.direct_message.text,e="@"+a.direct_message.sender.screen_name+" sent a direct message";z_engine_notification(b,e,d)}}else if(a.dms){dms_loaded++;a.dms.each(function(f){z_engine_tweet(f,"dms")});switch(dms_loaded){case 1:$("loading-inbox").fade();$("loading-outbox").appear();break;case 2:$("loading-outbox").fade()}rates--}else if(a.event)switch(a.event){case "block":b=$w(store.get("mention_blocks")).uniq().strip();
d=$w(store.get("user_blocks")).uniq().strip();var j=false,k=false;b.each(function(f){if(f==a.target.screen_name)j=true});d.each(function(f){if(f==a.target.screen_name)k=true});j||store.set("mention_blocks",current_blocks.join(" ")+" "+a.target.screen_name);k||store.set("user_blocks",current_blocks.join(" ")+" "+a.target.screen_name);break;case "unblock":b=$w(store.get("user_blocks")).uniq().strip();d=$w(store.get("user_blocks")).uniq().strip();var l="",m="";b.each(function(f){if(f!=a.target.screen_name)l+=
f+" "});d.each(function(f){if(f!=a.target.screen_name)m+=f+" "});store.set("mention_blocks",l);store.set("user_blocks",m);break;case "favorite":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;d=a.target_object.text;e="@"+a.source.screen_name+" faved your tweet!";z_engine_notification(b,e,d)}break;case "unfavorite":break;case "follow":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;d=a.source.description;e="@"+a.source.screen_name+" is following you!";z_engine_notification(b,
e,d)}break;case "list_member_added":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;d=a.target_object.description;e="@"+a.source.screen_name+" put you in "+a.target_object.full_name+"!";z_engine_notification(b,e,d)}break;case "list_created":break;case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;d=a.target_object.description;e="@"+a.source.screen_name+
" subscribed to "+a.target_object.full_name+"!";z_engine_notification(b,e,d)}break;case "list_user_unsubscribed":break;case "scrub_geo":break;case "user_update":break;default:console.log(JSON.stringify(a.event));console.log(JSON.stringify(a))}else if(a.friends){b=a.friends.join(" ");store.set("friends",b)}else if(a.home){a.home.each(function(f){z_engine_tweet(f,"home")});$("loading-home").fade();$("loading-mentions").appear();rates--;socket.emit("message",{fetch:"userstream"})}else if(a.info){screen_name=
a.info.screen_name;user_id=a.info.user_id;store.set("screen_name",screen_name);store.set("user_id",user_id)}else if(a.klout){if(store.get("klout")=="on"){d=a.klout;b=a.id_str;if(d!="error"){z_engine_set_klout(d.users,b);klout[d.users[0].twitter_id]=JSON.stringify(d.users)}else if($("klout-"+b)){$("klout-"+b).setStyle("cursor: default;");$("klout-"+b).setAttribute("onclick","");$("klout-"+b).addTip("<big><strong>?</strong></big>",kloutinfo_params)}}}else if(a.mentions){a.mentions.each(function(f){z_engine_tweet(f,
"mentions")});$("loading-mentions").fade();$("loading-inbox").appear();rates--}else if(a.rates){rates=a.rates.remaining_hits;a.rates.remaining_hits<=10&&z_engine_notification("","notice!","you have "+a.rates.remaining_hits+" (of "+a.rates.hourly_limit+") request tokens left!")}else if(a.retweet_info){d=a.retweet_info;b=d.retweeted_status.id_str;e=d.id_str;content_rts_stored[b]=JSON.stringify(d);if($("rt-"+b)){$("rt-"+b).writeAttribute("src","img/rtd.png");$("rt-"+b).writeAttribute("onclick","z_engine_destroy('"+
e+"','rt');")}if($("rt-"+b+"-mentioned")){$("rt-"+b+"-mentioned").writeAttribute("src","img/rtd.png");$("rt-"+b+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+e+"','rt');")}if($("rt-"+b+"-threaded")){$("rt-"+b+"-threaded").writeAttribute("src","img/rtd.png");$("rt-"+b+"-threaded").writeAttribute("onclick","z_engine_destroy('"+e+"','rt');")}}else if(a.server_event){console.log(JSON.stringify(a));switch(a.server_event){case "end":$("new-tweet").disable();z_engine_notification("","notice!",
"lost connection to the userstream, reconnecting...");break;case "error":$("new-tweet").disable();z_engine_notification("","notice!","error occurred, reconnecting...")}}else if(a.shorten){b=$("new-tweet").getValue().replace(a.original,a.shorten);$("new-tweet").setValue(b)}else if(a.show){d=a.show;b=d.retweeted_status?d.retweeted_status.id_str:d.id_str;content_threads_stored[b]=JSON.stringify(d);z_engine_tweet(d,"threaded");rates--}else if(a.text&&a.user&&a.created_at){content_queued.push(JSON.stringify(a));
if(paused){$("paused-count").update("("+pttid+")");pttid++}if(a.retweeted_status&&a.retweeted_status.user.screen_name==screen_name&&a.user.screen_name!=screen_name){b=a.user.profile_image_url;e=a.retweeted_status.retweet_count-1;d=a.retweeted_status.text;e=e>1?"@"+a.user.screen_name+" and "+e+" others rt'd you!":e==1?"@"+a.user.screen_name+" and 1 other rt'd you!":"@"+a.user.screen_name+" retweeted you!";z_engine_notification(b,e,d)}}}else if(b.isJSON())b.evalJSON(true)?console.log("unknown error, output: "+
b):console.log("json could not be properly evaluated, skipping");else console.log("not json, skipping")});socket.on("disconnect",function(){$("new-tweet").disable()})}else $("new-tweet").setValue("sorry, your browser may not support this client!")}function z_engine_check_ratelimit(){socket.emit("message",{fetch:"rates"})}
function z_engine_clear_timeline(){var a=z_engine_current_timeline();if(z_engine_css3()){$(a).addClassName("comment-parent-drop").removeClassName("comment-parent");window.setTimeout(function(){$(a).update().appear()})}else new Effect.Fade(a,{duration:0.5,afterFinish:function(){$(a).update().appear()}})}
function z_engine_current_timeline(){if($("home-timeline").visible())return"home-timeline";else if($("mentions-timeline").visible())return"mentions-timeline";else if($("threaded-timeline").visible())return"threaded-timeline";else if($("dms-inbox-timeline").visible())return"dms-inbox-timeline";if($("dms-outbox-timeline").visible())return"dms-outbox-timeline"}
function z_engine_clicker(a,b){new Event.observe(a,"click",function(c){Event.stop(c);var d=z_engine_current_timeline();$(b).visible()||new Effect.Parallel([new Effect.Fade(d,{duration:0.5,mode:"relative"}),new Effect.Appear(b,{delay:0.51,duration:0.5,mode:"relative"})],{duration:1,beforeStart:function(){switch(b){case "dms-inbox-timeline":case "dms-outbox-timeline":$("new-dm-user").appear();break;default:$("new-dm-user").fade().setValue("")}},afterFinish:function(){$(d).removeClassName("current-tab");
$(b).addClassName("current-tab");if(d=="threaded-timeline"){$("threaded-timeline").update();latest_threaded_id=0}}})})}function z_engine_css3(){return BrowserDetect.browser=="Firefox"&&BrowserDetect.version<=5||BrowserDetect.browser!="Chrome"||BrowserDetect.browser!="Safari"?false:true}
function z_engine_destroy(a,b){if(confirm("\nare you sure you want to delete this?\n")){if(b=="tweet"||b=="rt")var c={destroy:{status:{id_str:a}}};else if(b=="dm"){c={destroy_dm:{status:{id_str:a}}};z_engine_drop_tweet(a)}if(b=="rt"){if($("rt-"+a)){$("rt-"+a).setAttribute("src","img/rt.png");$("rt-"+a).setAttribute("onclick","z_engine_retweet('"+a+"');")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").setAttribute("src","img/rt.png");$("rt-"+a+"-mentioned").setAttribute("onclick","z_engine_retweet('"+
a+"');")}if($("rt-"+a+"-threaded")){$("rt-"+a+"-threaded").setAttribute("src","img/rt.png");$("rt-"+a+"-threaded").setAttribute("onclick","z_engine_retweet('"+a+"');")}content_rts_stored[a]=""}socket.emit("message",c)}}
function z_engine_drop_tweet(a){if($("comment-"+a)){$("comment-"+a).setStyle("text-decoration: line-through;");$("del-"+a)&&$("del-"+a).fade();$("fave-"+a)&&$("fave-"+a).fade();$("reply-"+a)&&$("reply-"+a).fade();$("rt-"+a)&&$("rt-"+a).fade();window.setTimeout(function(){z_engine_fade_up("comment-"+a)},3E3)}if($("comment-"+a+"-mentioned")){$("del-"+a+"-mentioned")&&$("del-"+a+"-mentioned").fade();$("fave-"+a+"-mentioned")&&$("fave-"+a+"-mentioned").fade();$("reply-"+a+"-mentioned")&&$("reply-"+a+
"-mentioned").fade();$("rt-"+a+"-mentioned")&&$("rt-"+a+"-mentioned").fade();window.setTimeout(function(){z_engine_fade_up("comment-"+a+"-mentioned")},3E3)}if($("comment-"+a+"-threaded")){$("del-"+a+"-threaded")&&$("del-"+a+"-threaded").fade();$("fave-"+a+"-threaded")&&$("fave-"+a+"-threaded").fade();$("reply-"+a+"-threaded")&&$("reply-"+a+"-threaded").fade();$("rt-"+a+"-threaded")&&$("rt-"+a+"-threaded").fade();window.setTimeout(function(){z_engine_fade_up("comment-"+a+"-threaded")},3E3)}}
function z_engine_escape(a){return(new Element("textarea")).update(a.replace(/</g,"&lt;").replace(/>/g,"&gt;").strip()).getValue()}function z_engine_fade_down(a){if(!z_engine_css3()){$(a).setStyle("display: none;");new Effect.Appear(a,{duration:1,transition:Effect.Transitions.sinoidal})}}function z_engine_fade_up(a){if(z_engine_css3())$(a).addClassName("comment-parent-drop").removeClassName("comment-parent");else new Effect.Fade(a,{duration:1,transition:Effect.Transitions.sinoidal})}
function z_engine_favorite(a){socket.emit("message",{favorite:{status:{id_str:a}}})}function z_engine_geo(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(z_engine_geo_set,z_engine_geo_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout*1E3})}function z_engine_geo_error(a){switch(a.code){case 0:case 1:case 2:case 3:longitude=latitude=false}}function z_engine_geo_set(a){latitude=a.coords.latitude;longitude=a.coords.longitude}
function z_engine_get_height(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function z_engine_get_klout(a,b,c){if(klout[b]){a=klout[b].evalJSON(true);z_engine_set_klout(a,c)}else socket.emit("message",{klout:a,id_str:c})}
function z_engine_image_dropper(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){$("image").show();$("image").ondragover=function(a){a.preventDefault();$("image").setStyle("border-color: #aaa;");return false};$("image").ondragend=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false};$("image").ondrop=function(a){a.preventDefault();var b=a.dataTransfer.files[0];if(b.size<=max_file_size*1048576)switch(b.type){case "application/pdf":case "image/apng":case "image/bmp":case "image/gif":case "image/jpeg":case "image/jpg":case "image/png":case "image/tiff":a=
new FormData;a.append("image",b);a.append("key",imgur_key);b=new XMLHttpRequest;b.onreadystatechange=function(){if(this.readyState==3||this.readyState==2)$("image").setStyle("border-color: yellow;");if(this.readyState==4&&this.status==200){var c=this.responseText.evalJSON(true).upload.links.original,d=$("new-tweet").getValue();if(d.length>0)var e=d+" "+c;else if(d.length==0)e=c;$("new-tweet").setValue(e);$("image").setStyle("border-color: green;");window.setTimeout(function(){$("image").setStyle("border-color: #ddd;")},
1500)}if(this.readyState==4&&this.status!=200){$("image").setStyle("border-color: red;");window.setTimeout(function(){$("image").setStyle("border-color: #ddd;")},1500)}};b.open("POST","http://api.imgur.com/2/upload.json",true);b.send(a)}return false};$("image").ondragleave=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false}}}
function z_engine_input(){var a=$("new-tweet").getValue();if(a.length==0)shortened=reply_id=false;else if(a.length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else if(a.length>=141){z_engine_shorten_urls();$("new-tweet").setStyle("color: red;")}}function z_engine_logout(){socket.disconnect();$("new-tweet").disable();$("new-tweet").setValue("see ya!");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}
function z_engine_notification(a,b,c){if(store.get("notifications")=="on"){if(store.get("sound")=="on"&&store.get("sound_src").length>0&&(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE"))audio.play();if(c==null)c="";if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var d=window.webkitNotifications.createNotification(a,b,c);d.show();window.setTimeout(function(){d.cancel()},5E3)}else if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==
1){window.webkitNotifications.requestPermission();growler.growl(a,b,c)}else if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2)growler.growl(a,b,c)}}function z_engine_notification_setup(){window.webkitNotifications&&window.webkitNotifications.checkPermission()==1&&window.webkitNotifications.requestPermission()}function z_engine_parse_tweet(a){if(a){a=twttr.txt.autoLink(a);a=a.replace(/\n\r?/g,"<br />")}return a}
function z_engine_prune_tweets(){var a=$("home-timeline").childElements();a.length>=home_cutoff&&a.each(function(b,c){c>home_cutoff&&$(b).remove()});window.setTimeout(function(){var b=$("mentions-timeline").childElements();b.length>=mentions_cutoff&&b.each(function(c,d){d>mentions_cutoff&&$(c).remove()})},12E3);window.setTimeout(function(){var b=$("dms-inbox-timeline").childElements();b.length>=dms_cutoff&&b.each(function(c,d){d>dms_cutoff&&$(c).remove()})},24E3);window.setTimeout(function(){var b=
$("dms-outbox-timeline").childElements();b.length>=dms_cutoff&&b.each(function(c,d){d>dms_cutoff&&$(c).remove()})},36E3);window.setTimeout(function(){var b=$("threaded-timeline").childElements();b.length>=threaded_cutoff&&b.each(function(c,d){d>threaded_cutoff&&$(c).remove()})},48E3)}
function z_engine_remember_author(a){a="@"+a;var b="",c=false;$w(store.get("users")).uniq().compact().each(function(d,e){if(e<=remember_cutoff)if(d==a)c=true;else b+=" "+d});c||(b=a+" "+b);store.set("users",b.strip())}function z_engine_reply(a,b,c){reply_id=b;$("new-tweet").setValue("@"+a+" "+c);$("new-tweet").focus()}function z_engine_reply_dm(a,b){$("new-dm-user").setValue(b);$("new-tweet").focus()}function z_engine_retweet(a){socket.emit("message",{retweet:{status:{id_str:a}}})}
function z_engine_retweet_comment(a,b,c){reply_id=a;$("new-tweet").setValue("RT @"+b+" "+z_engine_escape(c));$("new-tweet").focus()}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();$("new-dm-user").disable();var a=$("new-tweet").getValue().strip(),b=$("new-dm-user").getValue().strip(),c=new Hash;if(b.length>0){if(b.startsWith("@"))b=b.replace(/@/i,"");c={direct_message:{screen_name:b,text:a}}}else{c={status:{status:a,include_entities:true}};store.get("geo")=="on"&&latitude&&longitude&&new Object.extend(c.status,{display_coordinates:true,lat:latitude,
"long":longitude});reply_id&&new Object.extend(c.status,{in_reply_to_status_id:reply_id})}socket.emit("message",c);shortened=reply_id=false;$("new-dm-user").enable();$("new-dm-user").setValue("");$("new-tweet").setValue("");$("new-tweet").enable();$("new-tweet").focus()}}
function z_engine_set_klout(a,b){if(typeof a=="object")if(a.length>0&&typeof b=="string"){var c=Math.round(a[0].score.network_score),d=Math.round(a[0].score.true_reach),e="score: <strong>"+Math.round(a[0].score.kscore)+"</strong><br />";e+="amp: <strong>"+Math.round(a[0].score.amplification_score)+"</strong><br />";e+="network: <strong>"+c+"</strong><br />";e+="reach: <strong>"+d+"</strong><br />";if($("klout-"+b)){$("klout-"+b).addTip(e,kloutinfo_params);$("klout-"+b).setAttribute("src","img/kltd.png");
$("klout-"+b).setAttribute("title","")}if($("klout-"+b+"-mentioned")){$("klout-"+b+"-mentioned").addTip(e,kloutinfo_params);$("klout-"+b+"-mentioned").setAttribute("src","img/kltd.png");$("klout-"+b+"-mentioned").setAttribute("title","")}}}
function z_engine_set_language(){var a=store.get("lang");switch(a){case "english":case "russian":new Ajax.Request("/lang/"+a+".json",{method:"GET",onSuccess:function(b){translation=b.responseText.evalJSON(true);$("home-timeline-click").update(translation.home);$("mentions-timeline-click").update(translation.mentions);$("dms-inbox-timeline-click").update(translation.inbox);$("dms-outbox-timeline-click").update(translation.outbox);$("pause").update(translation.stop);$("image").update(translation.image);
$("settings").update(translation.settings);$("logout").update(translation.exit);$("new-dm-user").placeholder=translation.dm_to_placeholder;$("new-tweet").placeholder=translation.tweet_placeholder}})}}
function z_engine_settings_checked_clicker(a,b){new Event.observe(a,"change",function(c){Event.stop(c);c=$(a).getValue();switch(b){case "lang":store.set(b,c);z_engine_set_language();break;case "stream_interval":store.set(b,c);stream_queue_interval.stop();stream_queue_interval=new PeriodicalExecuter(function(){paused||z_engine_stream_queue()},store.get(b));break;default:c=store.get(b)=="on"?"off":"on";store.set(b,c)}})}
function z_engine_settings_get(a,b){switch(b){case "stream_interval":$(a).setValue(store.get(b));break;case "lang":var c=store.get("lang");$(c).setAttribute("selected","selected");break;default:store.get(b)=="on"&&$(a).click()}}
function z_engine_settings_setup(){z_engine_settings_get("use-audio","sound");z_engine_settings_checked_clicker("use-audio","sound");z_engine_settings_get("use-notify","notifications");z_engine_settings_checked_clicker("use-notify","notifications");z_engine_settings_get("language","lang");z_engine_settings_checked_clicker("language","lang");z_engine_settings_get("stream-interval","stream_interval");z_engine_settings_checked_clicker("stream-interval","stream_interval");z_engine_settings_get("use-geo",
"geo");z_engine_settings_checked_clicker("use-geo","geo");z_engine_settings_get("use-klout","klout");z_engine_settings_checked_clicker("use-klout","klout")}function z_engine_shorten_urls(){var a=$("new-tweet").getValue();if(a.length>0&&!shortened){a.replace(/((https?\:\/\/)|(www\.))([^ \(\)\{\}\[\]]+)/g,function(b){b.length>=20&&socket.emit("message",{shorten:b})});shortened=true}}
function z_engine_stream_queue(){if(content_queued.length>0){var a=content_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"home")}}}
function z_engine_threaded(a,b){if(a){if($("home-timeline").visible())var c="home-timeline";if($("mentions-timeline").visible())c="mentions-timeline";new Effect.Parallel([new Effect.Fade(c,{duration:0.5,mode:"relative"}),new Effect.Appear("threaded-timeline",{delay:0.51,duration:0.5,mode:"relative"})],{duration:1});content_threads_stored[a]?z_engine_tweet(content_threads_stored[a].evalJSON(true),"threaded"):socket.emit("message",{show:{id_str:a}})}else content_threads_stored[b]?z_engine_tweet(content_threads_stored[b].evalJSON(true),
"threaded"):socket.emit("message",{show:{id_str:b}})}
function z_engine_tweet(a,b){if(b!="dms")if(a.retweeted_status){c=a.retweeted_status.user.screen_name;d=a.user.screen_name;e=a.retweeted_status.user.profile_image_url;j=(new Date(a.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");k=a.retweeted_status.user.description;l=a.retweeted_status.entities;m=a.retweeted_status.favorited;f=a.retweeted_status.user.followers_count;h=a.retweeted_status.user.friends_count;g=a.retweeted_status.id_str;q=a.retweeted_status.user.location;t=a.retweeted_status.user["protected"];
r=a.retweeted_status.place;i=a.retweeted_status.in_reply_to_screen_name;u=a.retweeted_status.in_reply_to_status_id_str;n=a.retweeted_status.retweet_count-1;y=true;F=a.retweeted_status.source.stripTags();w=a.retweeted_status.text;z=a.retweeted_status.user.statuses_count;A=a.retweeted_status.user.id;o=a.retweeted_status.user.verified}else var c=a.user.screen_name,d=false,e=a.user.profile_image_url,j=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,""),k=a.user.description,l=a.entities,m=a.favorited,
f=a.user.followers_count,h=a.user.friends_count,g=a.id_str,q=a.user.location,t=a.user["protected"],r=a.place,i=a.in_reply_to_screen_name,u=a.in_reply_to_status_id_str,n=a.retweet_count-1,y=false,F=a.source.stripTags(),w=a.text,z=a.user.statuses_count,A=a.user.id,o=a.user.verified;else{c=a.sender.screen_name;e=a.sender.profile_image_url;j=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");k=a.sender.description;l=false;f=a.sender.followers_count;h=a.sender.friends_count;g=a.id_str;q=a.sender.location;
t=false;i=a.recipient.screen_name;n=0;y=false;w=a.text;z=a.sender.statuses_count;A=a.sender_id;o=a.sender.verified}var I=false,J=false,K=false,L=false,s=false;if(b!="threaded"&&content_stored[g])s=true;b!="dms"&&$w(store.get("client_blocks")).uniq().each(function(x){if(x.replace("'","")==F)I=true});if(l){typeof l.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(x){l.hashtags.uniq().each(function(G){if(x==G)J=true})});typeof l.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(x){l.user_mentions.uniq().each(function(G){if(x==
G)K=true})})}$w(store.get("user_blocks")).uniq().each(function(x){if(x==c)L=true});if(!s&&!I&&!J&&!K&&!L){(new Image).src=e;content_stored[g]=true;z_engine_remember_author(c);s="";if(k!=null)s+=k+"<br /><br />";if(q!=null)s+="location: "+q+"<br />";s+="tweets: <strong>"+z+"</strong><br />";s+="following: <strong>"+h+"</strong><br />";s+="followers: <strong>"+f+"</strong>";if(l){q=z_engine_tweet_mentioned(l);k=z_engine_tweet_mentioned_string(l)}else k=q=false;var E=new Element("br");f=b!="dms"?new Element("div",
{ondblclick:'z_engine_reply("'+c+'", "'+g+'", "'+k+'");',id:"comment-"+g,"class":"comment-parent"}):new Element("div",{ondblclick:'z_engine_reply_dm("'+A+'", "'+c+'");',id:"comment-"+g,"class":"comment-parent"});z=new Element("div",{"class":"comment-profile-wrapper left"});var C=new Element("div",{"class":"comment-gravatar"});h=new Element("img",{id:"av-"+g,src:e,style:"height: 50px; width: 50px; cursor: pointer;",alt:""});C.insert(h);z.insert(C);C=new Element("div",{id:"comment-"+g+"content","class":"comment-content-wrapper right"});
var D=c!=screen_name?q?new Element("div",{"class":"comment-body-mentioned"}):new Element("div",{"class":"comment-body"}):new Element("div",{"class":"comment-body-me"}),p=new Element("div",{"class":"comment-arrow"});D.insert(p);var B=new Element("div",{"class":"post-date"});p=new Element("div",{"class":"left",id:"left-"+g});var M=new Element("a",{target:"_blank",href:"http://twitter.com/"+c});M.update("@"+c+" ");var N=new Element("span");N.update(translation.wrote_this);if(b!="dms")var v=new Element("a",
{target:"_blank",id:"comment-"+g+"-relative-date",href:"http://twitter.com/"+c+"/status/"+g});var H=new Element("time",{datetime:j,"class":b});H.update(relative_time(j));b!="dms"&&v.insert(H);p.insert(M);p.insert({bottom:N});if(b!="dms"){p.insert({bottom:v});if(u){j=new Element("span");j.update(translation.in_reply_to);v=b=="threaded"?new Element("a",{target:"_blank",href:"http://twitter.com/"+i+"/status/"+u}):new Element("span",{onclick:'z_engine_threaded("'+g+'","'+u+'");',style:"cursor: pointer;"});
v.update("@"+i+" ");p.insert(j);p.insert({bottom:v})}i=new Element("span",{"class":"via"});i.update(translation.via+" "+F);p.insert({bottom:i})}else{p.insert({bottom:H});if(i){j=new Element("span");j.update(" in reply to ");v=new Element("a",{target:"_blank",href:"http://twitter.com/"+i});v.update(i+" ");p.insert(j);p.insert({bottom:v})}}if(o){o=new Element("span");o.update(" ");i=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});o.insert({bottom:i});p.insert({bottom:o})}B.insert(p);
o=new Element("div",{"class":"right"});if(y){i=n>0?"retweeted by "+d+" and "+n+" others!":"retweeted by "+d+"!";n=new Element("span",{"class":"rtd"});n.update(" ");i=new Element("img",{src:"img/rtd2.png",alt:"",title:i});j=new Element("a",{target:"_blank",href:"http://twitter.com/"+d});j.update(d);n.insert({top:i});n.insert({bottom:j});o.insert({bottom:n})}if(b!="dms"&&r&&r.full_name){n=new Element("span",{"class":"place",id:"place-"+g});i=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+
r.full_name});r=new Element("img",{src:"img/plc.png",alt:"",title:r.full_name});i.update(r);n.update(i);o.insert({bottom:n})}B.insert({bottom:o});D.insert({bottom:B});n=new Element("div",{"class":"clearer"});n.update("&nbsp;");D.insert({bottom:n});B=new Element("div",{"class":"comment-text"});o=new Element("p",{id:"comment-"+g+"-text"});r=new Element("div",{id:"right-"+g,"class":"right"});o.insert(E);o.insert({bottom:r});E=new Element("div",{id:"text-"+g});E.update(z_engine_parse_tweet(w));o.insert({bottom:E});
B.insert(o);D.insert({bottom:B});C.insert(D);f.insert(z);f.insert({bottom:C});f.insert({bottom:n});new Element.extend(h);new Element.extend(p);new Element.extend(r);new Element.extend(f);switch(b){case "dms":if(c!=screen_name)$("dms-inbox-timeline").insert({top:f});else c==screen_name&&$("dms-outbox-timeline").insert({top:f});break;case "home":$("home-timeline").insert({top:f});break;case "mentions":$("mentions-timeline").insert({bottom:f})}if(q&&b!="mentions"&&b!="threaded"&&c!=screen_name&&!a.retweeted_status){q=
cloneNodeWithEvents(f);q.setAttribute("id","comment-"+g+"-mentioned");p.setAttribute("id","left-"+g+"-mentioned");r.setAttribute("id","right-"+g+"-mentioned");h.setAttribute("id","av-"+g+"-mentioned");new Element.extend(q);$("mentions-timeline").insert({top:q});z_engine_tweet_buttons("mentions",g,c,d,A,w,t,m,y,k,s);z_engine_fade_down("comment-"+g+"-mentioned");z_engine_notification(e,"@"+c+" mentioned you!",w)}if(b=="threaded"){p.setAttribute("id","left-"+g+"-threaded");r.setAttribute("id","right-"+
g+"-threaded");h.setAttribute("id","av-"+g+"-threaded");e=cloneNodeWithEvents(f);e.setAttribute("id","comment-"+g+"-threaded");new Element.extend(e);$("threaded-timeline").insert({bottom:e});z_engine_tweet_buttons("threaded",g,c,d,A,w,t,m,y,k,s);z_engine_fade_down("comment-"+g+"-threaded")}if($("comment-"+g)){z_engine_tweet_buttons(b,g,c,d,A,w,t,m,y,k,s);z_engine_fade_down("comment-"+g)}}b=="threaded"&&u&&z_engine_threaded(false,u)}
function z_engine_tweet_buttons(a,b,c,d,e,j,k,l,m,f,h){switch(a){case "dms":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);if(c!=screen_name){h=new Element("img",{onclick:'z_engine_reply_dm("'+e+'", "'+c+'");',src:"/img/rep.png",title:"reply",id:"reply-"+b,alt:""});new Element.extend(h);$("right-"+b).insert(h)}h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "dm");',src:"/img/del.png",title:"delete",id:"del-"+b,alt:""});new Element.extend(h);$("right-"+b).insert({bottom:h});
z_engine_tweet_right_click(b,"comment-"+b,c,d,e,f,j,l,m,k,a);break;case "home":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);if(store.get("klout")=="on")if($("left-"+b)&&!$("klout-"+b)){h=new Element("span",{"class":"klout"});h.update(" ");var g=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+e+'", "'+b+'");',src:"/img/klt.png",id:"klout-"+b,alt:"",title:"click to get this users klout score"});h.insert({top:g});new Element.extend(g);$("left-"+b).insert({top:h})}if(c!=
screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+f+'");',title:"reply",id:"reply-"+b,alt:""});new Element.extend(h);if(k)g=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{g=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:"retweet",id:"rt-"+b,alt:""});new Element.extend(g)}$("right-"+b).update();$("right-"+b).insert(h);$("right-"+b).insert({bottom:g})}else{h=new Element("img",{onclick:'z_engine_destroy("'+
b+'", "tweet");',title:"delete",src:"/img/del.png",id:"del-"+b,alt:""});new Element.extend(h);$("right-"+b).update();$("right-"+b).insert({bottom:h})}z_engine_tweet_right_click(b,"comment-"+b,c,d,e,f,j,l,m,k,a);break;case "mentions":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);$("av-"+b+"-mentioned")&&$("av-"+b+"-mentioned").addTip(z_engine_parse_tweet(h),userinfo_params);if(c!=screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'-mentioned", "'+
f+'");',title:"reply",id:"reply-"+b+"-mentioned",alt:""});new Element.extend(h);if(k)g=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{g=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:"retweet",id:"rt-"+b+"-mentioned",alt:""});new Element.extend(g)}if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert(h);$("right-"+b).insert({bottom:g})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert(h);
$("right-"+b+"-mentioned").insert({bottom:g})}}else{h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',title:"delete",src:"/img/del.png",id:"del-"+b+"-mentioned",alt:""});new Element.extend(h);if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert({bottom:h})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert({bottom:h})}}$("comment-"+b)&&z_engine_tweet_right_click(b,"comment-"+b,c,d,e,f,j,l,m,k,a);$("comment-"+b+"-mentioned")&&
z_engine_tweet_right_click(b,"comment-"+b+"-mentioned",c,d,e,f,j,l,m,k,a);break;case "threaded":$("av-"+b+"-threaded")&&$("av-"+b+"-threaded").addTip(z_engine_parse_tweet(h),userinfo_params);if(c!=screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+f+'");',title:"reply",id:"reply-"+b+"-threaded",alt:""});new Element.extend(h);if(k)g=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{g=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+
b+'");',id:"rt-"+b+"-threaded",title:"retweet",alt:""});new Element.extend(g)}if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert(h);$("right-"+b+"-threaded").insert({bottom:g})}}else{h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"/img/del.png",title:"delete",id:"del-"+b+"-threaded",alt:""});new Element.extend(h);if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert({bottom:h})}}z_engine_tweet_right_click(b,
"comment-"+b+"-threaded",c,d,e,f,j,l,m,k,a)}}function z_engine_tweet_mentioned(a){var b=false;a.user_mentions.uniq().each(function(c){if(c.screen_name==screen_name)b=true});return b}function z_engine_tweet_mentioned_string(a){if(a.user_mentions.length>0){var b="";a.user_mentions.uniq().each(function(c){if(c.screen_name!=screen_name)b+="@"+c.screen_name+" "});return b.length>0?$w(b).uniq().join(" ")+" ":""}else return""}
function z_engine_tweet_pause(){if(paused){paused=false;new Effect.Fade("paused-count",{afterFinish:function(){$("paused-count").update("(0)");$("pause").update(translation.stop);pttid=0}})}else{paused=true;$("pause").update(translation.start);$("paused-count").appear()}}
function z_engine_tweet_right_click(a,b,c,d,e,j,k,l,m,f,h){var g=false,q=true,t=false,r=false;if(c==screen_name){g=true;q=false}m||(t=true);if(m&&d!=screen_name){t=true;m=false}else if(m&&d==screen_name)r=true;var i=new Control.ContextMenu(b,{animation:false});switch(h){case "home":case "mentions":case "threaded":if(g)i.addItem({label:'<img src="/img/del.png" title="delete" alt="" />',callback:function(){z_engine_destroy(a,"tweet")}});else{i.addItem({label:'<img src="/img/rep.png" title="reply" alt="" />',
callback:function(){z_engine_reply(c,a,j)}});if(f)i.addItem({label:'<img src="/img/lock.png" title="this account is private" alt="" />',enabled:false});else{i.addItem({label:function(){return'<img src="/img/rt.png" title="retweet" alt="" />'},condition:function(){return t},callback:function(){if(content_rts_stored[a])a=content_rts_stored[a].evalJSON(true).retweeted_status.id_str;z_engine_retweet(a);new PeriodicalExecuter(function(u){if(content_rts_stored[a]){u.stop();u=content_rts_stored[a].evalJSON(true).id_str;
i.destroy();z_engine_tweet_right_click(u,b,c,screen_name,e,j,k,l,true,f,h)}},1)}});i.addItem({label:function(){return'<span title="retweet (with comment, old method)">RT</span>'},condition:function(){return t},callback:function(){z_engine_retweet_comment(a,c,k)}});i.addItem({label:function(){return'<img src="/img/rtd.png" title="undo retweet" alt="" />'},condition:function(){return r},callback:function(){z_engine_destroy(a,"rt");i.destroy();z_engine_tweet_right_click(a,b,c,screen_name,e,j,k,l,false,
f,h)}})}l?i.addItem({label:'<img src="/img/favd.png" title="unfave" alt="" />',callback:function(){z_engine_unfavorite(a);i.destroy();z_engine_tweet_right_click(a,b,c,d,e,j,k,false,m,f,h)}}):i.addItem({label:'<img src="/img/fav.png" title="fave" alt="" />',callback:function(){z_engine_favorite(a);i.destroy();z_engine_tweet_right_click(a,b,c,d,e,j,k,true,m,f,h)}})}break;case "dms":i.addItem({label:function(){return'<img src="/img/rep.png" title="reply" alt="" />'},condition:function(){return q},callback:function(){z_engine_reply_dm(e,
c)}});i.addItem({label:'<img src="/img/del.png" title="delete" alt="" />',callback:function(){z_engine_destroy(a,"dm")}})}}function z_engine_unfavorite(a){socket.emit("message",{unfavorite:{status:{id_str:a}}})}function z_engine_update_relative_time(a){a=$$(a);a.length>0&&a.each(function(b){var c=b.getAttribute("datetime");b.update(relative_time(c))})};
