var audio=new Audio();if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"){audio.src="/audio/notify.mp3"}else{audio.src="/audio/notify.ogg"}if(!store.get("blocks")){store.set("blocks","")}var blocks=store.get("blocks");store.set("connect_id",CONNECT_SID);var content=Array();var content_paused=Array();var dms_cutoff=150;var dms_loaded=0;var dm_to=false;var following=Array();var geo_high_accuracy=false;var geo_timeout=12000;var home_cutoff=200;var ids=Array();var latit=false;var longit=false;if(!S2.Extensions.HardwareAcceleratedCSSTransitions){var max_fps=30}else{var max_fpx=120}var mentions_cutoff=150;var paused=false;var pttid=0;var prune_tweets_interval=60000;var reply_id=false;var screen_name="";var socket=new io.SessionSocket();var tid=0;var ttid=0;var update_relative_dms_interval=60000;var update_relative_home_interval=15000;var update_relative_mentions_interval=30000;var user_id=0;if(!store.get("users")){store.set("users","")}new S2.FX.Base({fps:max_fps});function z_engine_attrition(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(z_engine_get_geolocation,z_engine_geolocation_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout})}if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission()}$("loading-home").center(8);$("loading-mentions").center(8);$("loading-inbox").center(8);$("loading-outbox").center(8);new Event.observe("clear","click",function(a){Event.stop(a);return z_engine_tweet_clear()});new Event.observe("logout","click",function(a){Event.stop(a);return z_engine_logout()});new Event.observe("pause","click",function(a){Event.stop(a);return z_engine_tweet_pause()});new Event.observe("new-tweet","keyup",function(a){if($("new-tweet").getValue().length===0){dm_to=false;reply_id=false}else{if($("new-tweet").getValue().length<=140){$("new-tweet").setStyle("color: #4d4d4d;")}else{if($("new-tweet").getValue().length>=141){$("new-tweet").setStyle("color: red;")}}}});new Event.observe("new-tweet","keydown",function(a){if($("new-tweet").getValue().length===0){reply_id=false}else{if($("new-tweet").getValue().length<=140){$("new-tweet").setStyle("color: #4d4d4d;")}else{if($("new-tweet").getValue().length>=141){$("new-tweet").setStyle("color: red;")}}}});socket.connect();socket.on("connect",function(){$("new-tweet").setValue("connected...")});socket.on("message",function(p){var a=JSON.stringify(p);if(a.isJSON()&&a.evalJSON(true)){a="";if(p.loaded){$("new-tweet").setValue("");$("new-tweet").enable();new Event.observe("new-tweet-form","submit",function(s){Event.stop(s);z_engine_send_tweet()});z_engine_clicker("home-timeline-click","home-timeline");z_engine_clicker("mentions-timeline-click","mentions-timeline");z_engine_clicker("dms-timeline-click","dms-timeline");z_engine_dms_clicker("dms-inbox-timeline-click","dms-inbox-timeline");z_engine_dms_clicker("dms-outbox-timeline-click","dms-outbox-timeline");socket.send({fetch:"home"});var o=window.setTimeout(function(){socket.send({fetch:"mentions"})},10000);var k=window.setTimeout(function(){socket.send({fetch:"dms-inbox"})},20000);var f=window.setTimeout(function(){socket.send({fetch:"dms-outbox"})},30000);var n=window.setInterval(function(){this.z_engine_update_relative_time("time.home")},update_relative_home_interval);var g=window.setInterval(function(){this.z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval);var e=window.setInterval(function(){this.z_engine_update_relative_time("time.dms")},update_relative_dms_interval);var l=window.setInterval(function(){this.z_engine_prune_tweets()},prune_tweets_interval)}else{if(p.account){store.set("account",p.account)}else{if(p["delete"]){if(typeof(p["delete"].status)=="object"){var h=p["delete"].status.id_str}else{var h=0}if($("comment-"+h)){$("comment-"+h).setStyle("text-decoration: line-through;");if($("del-"+h)){$("del-"+h).fade()}if($("fave-"+h)){$("fave-"+h).fade()}if($("reply-"+h)){$("reply-"+h).fade()}if($("rt-"+h)){$("rt-"+h).fade()}window.setTimeout(function(){new S2.FX.Parallel([new Effect.Fade("comment-"+h,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp("comment-"+h,{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5})},3000)}if($("comment-"+h+"-mentioned")){if($("del-"+h+"-mentioned")){$("del-"+h+"-mentioned").fade()}if($("fave-"+h+"-mentioned")){$("fave-"+h+"-mentioned").fade()}if($("reply-"+h+"-mentioned")){$("reply-"+h+"-mentioned").fade()}if($("rt-"+h+"-mentioned")){$("rt-"+h+"-mentioned").fade()}window.setTimeout(function(){new S2.FX.Parallel([new Effect.Fade("comment-"+h+"-mentioned",{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp("comment-"+h+"-mentioned",{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5})},3000)}}else{if(p.direct_message){z_engine_tweet(p.direct_message,"dms");if(p.direct_message.sender.screen_name!=screen_name){z_engine_notification(p.direct_message.sender.profile_image_url,"@"+p.direct_message.sender.screen_name+" sent a direct message",p.direct_message.text)}}else{if(p.dms){dms_loaded++;p.dms.each(function(s){z_engine_tweet(s,"dms")});switch(dms_loaded){case 1:$("loading-inbox").fade();$("loading-outbox").appear();break;case 2:$("loading-outbox").fade();break}}else{if(p.event){var m=p.event;switch(m){case"block":var c=$w(store.get("blocks")).uniq();var i=false;c.each(function(s){if(s==p.target.id){i=true;$break}});if(!i){var b=p.target.id;var q=c.join(" ")+" "+b;store.set("blocks",q)}break;case"unblock":var c=$w(store.get("blocks")).uniq();var d="";c.each(function(s){if(s!=p.target.id){d+=s+" "}});store.set("blocks",d);break;case"favorite":if(p.source.screen_name!=screen_name){z_engine_notification(p.source.profile_image_url,"@"+p.source.screen_name+" faved your tweet!",p.target_object.text)}break;case"unfavorite":break;case"follow":if(p.source.screen_name!=screen_name){z_engine_notification(p.source.profile_image_url,"@"+p.source.screen_name+" is following you!",p.source.description)}break;case"list_member_added":if(p.source.screen_name!=screen_name){z_engine_notification(p.source.profile_image_url,"@"+p.source.screen_name+" put you in "+p.target_object.full_name+"!",p.target_object.description)}break;case"list_created":break;case"list_destroyed":break;case"list_member_removed":if(p.source.screen_name!=screen_name){z_engine_notification(p.source.profile_image_url,"@"+p.source.screen_name+" removed you from "+p.target_object.full_name+"!",p.target_object.description)}break;case"list_updated":break;case"list_user_subscribed":if(p.source.screen_name!=screen_name){z_engine_notification(p.source.profile_image_url,"@"+p.source.screen_name+" subscribed to "+p.target_object.full_name+"!",p.target_object.description)}break;case"list_user_unsubscribed":break;case"scrub_geo":break;case"user_update":break;default:console.log(JSON.stringify(p.event));console.log(JSON.stringify(p));break}}else{if(p.friends){var j=p.friends.join(" ");store.set("friends",j)}else{if(p.home){p.home.each(function(s){z_engine_tweet(s,"home")});socket.send({fetch:"userstream"});$("loading-home").fade();$("loading-mentions").appear()}else{if(p.info){screen_name=p.info.screen_name;user_id=p.info.user_id;store.set("screen_name",screen_name);store.set("user_id",user_id)}else{if(p.klout){var r=p.klout.users;var h=p.id_str;z_engine_set_klout(r,h)}else{if(p.mentions){p.mentions.each(function(s){z_engine_tweet(s,"mentions")});$("loading-mentions").fade();$("loading-inbox").appear()}else{if(p.retweet_info){var r=p.retweet_info;if($("comment-"+r.retweeted_status.id_str)){if($("rt-"+r.retweeted_status.id_str)){$("rt-"+r.retweeted_status.id_str).writeAttribute("src","img/rtd.png");$("rt-"+r.retweeted_status.id_str).writeAttribute("onclick","z_engine_destroy('"+r.retweeted_status.id_str+"','rt');")}if($("rt-"+r.retweeted_status.id_str+"-mentioned")){$("rt-"+r.retweeted_status.id_str+"-mentioned").writeAttribute("src","img/rtd.png");$("rt-"+r.retweeted_status.id_str+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+r.retweeted_status.id_str+"','rt');")}}}else{if(p.server_event){console.log(JSON.stringify(p));switch(p.server_event){case"end":z_engine_notification("","notice!","lost connection to the userstream, reconnecting...");socket.disconnect(false);$("new-tweet").disable();socket.connect();$("new-tweet").enable();socket.send({fetch:"userstream"});break;case"error":z_engine_notification("","notice!","userstream error occurred, reconnecting...");socket.disconnect(false);$("new-tweet").disable();socket.connect();$("new-tweet").enable();break}}else{if(p.text&&p.user&&p.created_at){if(p.retweeted_status&&p.retweeted_status.user.screen_name==screen_name&&p.user.screen_name!=screen_name){z_engine_notification(p.user.profile_image_url,"@"+p.user.screen_name+" retweeted you!",p.retweeted_status.text)}else{if(!paused){z_engine_tweet(p,"home")}else{z_engine_tweet_pause_handler(p)}}}}}}}}}}}}}}}}}else{if(!a.isJSON()){console.log("not json, skipping")}else{if(!a.evalJSON(true)){console.log("json could not be properly evaluated, skipping")}else{console.log("unknown error, output: "+a)}}}});socket.on("disconnect",function(a){if(a){z_engine_notification("","error!","lost connection to server")}$("new-tweet").disable();$("new-tweet").setValue("lost connection!")})}function z_engine_clicker(b,a){new Event.observe(b,"click",function(d){Event.stop(d);if(a=="dms-timeline"){new S2.FX.Parallel([new Effect.Fade("dms-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Appear("dms-inbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"}),new Effect.Appear("dms-outbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"})],{duration:1})}else{if($("dms-inbox-timeline-click").visible()||$("dms-outbox-timeline-click").visible()){new S2.FX.Parallel([new Effect.Fade("dms-outbox-timeline-click",{duration:0.15,mode:"relative"}),new Effect.Fade("dms-inbox-timeline-click",{duration:0.15,mode:"relative"}),new Effect.Appear("dms-timeline-click",{delay:0.15,duration:0.25,mode:"relative"})],{duration:1})}}if(!$(a).visible()){if($("home-timeline").visible()){var c="home-timeline"}else{if($("mentions-timeline").visible()){var c="mentions-timeline"}else{if($("dms-timeline").visible()){var c="dms-timeline"}}}new S2.FX.Parallel([new Effect.Fade(c,{duration:0.4,mode:"relative"}),new Effect.Appear(a,{delay:0.35,duration:0.4,mode:"relative"})],{duration:1})}})}function z_engine_dms_clicker(b,a){new Event.observe(b,"click",function(d){Event.stop(d);if(!$(a).visible()){if($("dms-outbox-timeline").visible()){var c="dms-outbox-timeline"}else{if($("dms-inbox-timeline").visible()){var c="dms-inbox-timeline"}}new S2.FX.Parallel([new Effect.Fade(c,{duration:0.4,mode:"relative"}),new Effect.Appear(a,{delay:0.35,duration:0.4,mode:"relative"})],{duration:1})}})}function z_engine_destroy(d,c){var b=confirm("\nare you sure you want to delete this?\n");if(b){if(c=="tweet"||c=="rt"){var a={destroy:{status:{id_str:d}}}}else{if(c=="dm"){var a={destroy_dm:{status:{id_str:d}}};$("comment-"+d).setStyle("text-decoration: line-through;");if($("del-"+d)){$("del-"+d).fade()}if($("fave-"+d)){$("fave-"+d).fade()}if($("reply-"+d)){$("reply-"+d).fade()}if($("rt-"+d)){$("rt-"+d).fade()}window.setTimeout(function(){new S2.FX.Parallel([new Effect.Fade("comment-"+d,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp("comment-"+d,{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5})},3000)}}if(c=="rt"){if($("rt-"+d)){$("rt-"+d).setAttribute("src","img/rt.png");$("rt-"+d).setAttribute("onclick","z_engine_retweet('"+d+"');")}if($("rt-"+d+"-mentioned")){$("rt-"+d+"-mentioned").setAttribute("src","img/rt.png");$("rt-"+d+"-mentioned").setAttribute("onclick","z_engine_retweet('"+d+"');")}}socket.send(a)}}function z_engine_favorite(a){socket.send({favorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/favd.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}}function z_engine_get_geolocation(a){latit=a.coords.latitude;longit=a.coords.longitude}function z_engine_geolocation_error(a){switch(a.code){case 0:case 1:case 2:case 3:latit=false;longit=false;break}}function z_engine_highlight(a){if($("comment-"+a)&&$("comment-"+a).isVisible()){new Effect.Highlight(a,{duration:2.5,before:function(){$("comment-"+a).scrollTo()}})}}function z_engine_get_klout(a,b){socket.send({fetch:"klout",screen_name:a,id_str:b})}function z_engine_logout(){store.remove("account");store.remove("connect_id");store.remove("friends");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}function z_engine_notification(d,a,c){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE"){audio.play()}if(c==null){c=""}if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var b=window.webkitNotifications.createNotification(d,a,c);b.show();window.setTimeout(function(){b.cancel()},5000)}else{if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission();growler.growl(z_engine_parse_tweet(a),z_engine_parse_tweet(c))}else{if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2){growler.growl(z_engine_parse_tweet(a),z_engine_parse_tweet(c))}}}}function z_engine_parse_tweet(a){if(!a){return a}else{a=twttr.txt.autoLink(a,{hashtagUrlBase:"https://search.twitter.com/search?q=%23"});a=a.replace(/\n\r?/g,"<br />");return a}}function z_engine_prune_tweets(){var a=$("home-timeline").childElements();a.each(function(c,b){if(b>home_cutoff){$(c).remove()}});window.setTimeout(function(){var b=$("mentions-timeline").childElements();b.each(function(d,c){if(c>mentions_cutoff){$(d).remove()}})},10000);window.setTimeout(function(){var b=$("dms-inbox-timeline").childElements();b.each(function(d,c){if(c>dms_cutoff){$(d).remove()}})},20000);window.setTimeout(function(){var b=$("dms-outbox-timeline").childElements();b.each(function(d,c){if(c>dms_cutoff){$(d).remove()}})},30000)}function z_engine_remember(c){var d=false;var b=$w(store.get("users")).uniq();b.each(function(g,f){if(g==c){d=true;$break}});if(!d){var e="";if(b.length>=100){var a=b.without(0)}else{var a=b}a.each(function(g,f){if(f<100){e+=g+" "}});e+=c;store.set("users",e)}}function z_engine_reply(c,d,a){reply_id=d;var b="@"+c+" "+a;$("new-tweet").setValue(b);$("new-tweet").focus()}function z_engine_reply_dm(b,a){dm_to=b;$("new-tweet").setValue("~");$("new-tweet").focus()}function z_engine_retweet(e,c,d){var b=confirm("\nare you sure you want to retweet this?\n");if(b){var a=confirm("ok for normal retweet\ncancel for commented retweet");if(a){socket.send({retweet:{status:{id_str:e}}})}else{reply_id=e;$("new-tweet").setValue("RT @"+c+": "+d)}}}function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();var a=$("new-tweet").getValue();var d=new Hash();if(!dm_to){var d={status:{status:a,include_entities:true}};if(latit&&longit){var c={display_coordinates:true,lat:latit,"long":longit};new Object.extend(d.status,c)}if(reply_id){var b={in_reply_to_status_id:reply_id,};new Object.extend(d.status,b)}}else{var d={direct_message:{text:a,user_id:dm_to}}}socket.send(d);reply_id=false;dm_to=false;$("new-tweet").setValue("");$("new-tweet").enable()}}function z_engine_set_klout(g,b){if(g.length>0&&typeof(b)=="string"){var f=Math.round(g[0].score.amplification_score);var d=g[0].score.delta_1day;var k=g[0].score.description;var m=g[0].score.delta_5day;var c=g[0].score.kclass;var l=g[0].score.kclass_description;var a=Math.round(g[0].score.kscore);var e=g[0].score.kscore_description;var h=Math.round(g[0].score.network_score);var j=Math.round(g[0].score.true_reach);if($("klout-"+b)){var i="score: "+a+"<br />";i+="amp: "+f+"<br />";i+="network: "+h+"<br />";i+="reach: "+j;$("klout-"+b).addTip(i,{className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]});$("klout-"+b).setAttribute("src","img/kltd.png");$("klout-"+b).setAttribute("title","")}}else{if(g.length==0){if($("klout-"+b)){$("klout-"+b).setAttribute("title","it appears that this user doesnt have klout")}}}}function z_engine_tweet(ae,I){var X=false;if(I!="dms"){if(!ae.retweeted_status){var h=ae.user.screen_name;var ag=false;var r=ae.user.profile_image_url;var m=false;var ad=new Date(ae.created_at).toLocaleString().replace(/GMT.+/,"");var s=ae.user.description;var Q=ae.entities;var k=ae.favorited;var J=ae.user.followers_count;var G=ae.user.friends_count;var S=ae.id_str;var x=ae.user.location;var O=ae.user["protected"];var q=ae.user.name;var b=ae.place;var W=ae.in_reply_to_screen_name;var V=ae.in_reply_to_status_id_str;var ac=false;var D=ae.source;var L=ae.text;var aj=ae.user.statuses_count;var Z=ae.user.id;var t=ae.user.verified}else{var h=ae.retweeted_status.user.screen_name;var ag=ae.user.screen_name;var r=ae.retweeted_status.user.profile_image_url;var m=ae.user.profile_image_url;var ad=new Date(ae.retweeted_status.created_at).toLocaleString().replace(/GMT.+/,"");var s=ae.retweeted_status.user.description;var Q=ae.retweeted_status.entities;var k=ae.retweeted_status.favorited;var J=ae.retweeted_status.user.followers_count;var G=ae.retweeted_status.user.friends_count;var S=ae.retweeted_status.id_str;var x=ae.retweeted_status.user.location;var O=ae.retweeted_status.user["protected"];var q=ae.retweeted_status.user.name;var b=ae.retweeted_status.place;var W=ae.retweeted_status.in_reply_to_screen_name;var V=ae.retweeted_status.in_reply_to_status_id_str;var ac=true;var D=ae.retweeted_status.source;var L=ae.retweeted_status.text;var aj=ae.retweeted_status.user.statuses_count;var Z=ae.retweeted_status.user.id;var E=ae.user.id;var t=ae.retweeted_status.user.verified}}else{var h=ae.sender.screen_name;var r=ae.sender.profile_image_url;var ad=new Date(ae.created_at).toLocaleString().replace(/GMT.+/,"");var Q=false;var J=ae.user.followers_count;var G=ae.user.friends_count;var S=ae.id_str;var O=false;var W=ae.recipient.screen_name;var ac=false;var L=ae.text;var Z=ae.sender_id;var t=ae.sender.verified}var ai=$w(store.get("blocks")).uniq();ai.each(function(ak){if(ak==Z){X=true;$break}});if(!content[S]&&!X){if(I!="mentions"){ids[tid]=S;content[S]=true}var e=new Element("br");if(!Q){var N=false;var j=false}else{var N=z_engine_tweet_mentioned(Q);var j=z_engine_tweet_mentioned_string(Q)}var F=new Element("li",{id:"comment-"+S,"class":"comment-parent",style:"display:none;opacity:0;"});var n=new Element("div",{"class":"comment-profile-wrapper left"});var H=new Element("div",{"class":"comment-gravatar"});var Y=new Element("img",{src:r,style:"height:50px;width:50px;cursor:pointer;",alt:""});H.insert(Y);if(I!="dms"){var o="";if(s!=""){o+=s+"<br /><br />"}if(x!=""){o+="- location: "+x+"<br />"}o+="tweets: "+aj+"<br />";o+="following: "+G+"<br />";o+="followers: "+J;Y.addTip(o,{className:"user",stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]})}n.insert(H);var l=new Element("div",{id:"comment-"+S+"content","class":"comment-content-wrapper right"});if(h!=screen_name){if(!N){var K=new Element("div",{"class":"comment-body"})}else{var K=new Element("div",{"class":"comment-body-mentioned"})}}else{var K=new Element("div",{"class":"comment-body-me"})}var ah=new Element("div",{"class":"comment-arrow"});K.insert(ah);var w=new Element("div",{"class":"post-date"});var P=new Element("div",{"class":"left",id:"left-"+S});var B=new Element("a",{target:"_blank",href:"http://twitter.com/"+h});B.update("@"+h+" ");var p=new Element("span");p.update("wrote this ");if(I!="dms"){var v=new Element("a",{target:"_blank",id:"comment-"+S+"-relative-date",href:"http://twitter.com/"+h+"/status/"+S})}var aa=new Element("time",{datetime:ad,"class":I});aa.update(relative_time(ad));if(I!="dms"){v.insert(aa)}P.insert(B);P.insert({bottom:p});if(I!="dms"){P.insert({bottom:v});if(V){var f=new Element("span");f.update(" in reply to ");var d=new Element("a",{target:"_blank",href:"http://twitter.com/"+W+"/status/"+V});d.update(W+" ");P.insert(f);P.insert({bottom:d})}var M=new Element("span");M.update(" via "+D);P.insert({bottom:M})}else{P.insert({bottom:aa});if(W){var f=new Element("span");f.update(" in reply to ");var d=new Element("a",{target:"_blank",href:"http://twitter.com/"+W});d.update(W+" ");P.insert(f);P.insert({bottom:d})}}if(t){var a=new Element("span");a.update(" ");var c=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});a.insert({bottom:c});P.insert({bottom:a})}w.insert(P);var g=new Element("div",{"class":"right"});if(ac){var i=new Element("span");i.update(" ");var T=new Element("img",{src:"img/rtd2.png",alt:""});i.insert({top:T});i.insert({bottom:'by <a target="_blank" href="http://twitter.com/'+ag+'">'+ag+"</a> "});g.insert({bottom:i})}if(I!="dms"&&b&&b.full_name){var z=new Element("span");var A=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+b.full_name});var R=new Element("img",{src:"img/plc.png",alt:""});A.update(R);z.update(A);g.insert({bottom:z})}w.insert({bottom:g});K.insert({bottom:w});var C=new Element("div",{"class":"clearer"});C.update("&nbsp;");K.insert({bottom:C});var ab=new Element("div",{"class":"comment-text"});var af=new Element("p",{id:"comment-"+S+"-text"});var U=new Element("div",{id:"right-"+S,"class":"right"});af.insert(e);af.insert({bottom:U});var y=new Element("div",{id:"text-"+S});y.update(z_engine_parse_tweet(L));af.insert({bottom:y});ab.insert(af);K.insert({bottom:ab});l.insert(K);F.insert(n);F.insert({bottom:l});F.insert({bottom:C});new Element.extend(U);new Element.extend(F);switch(I){case"dms":if(h!=screen_name){$("dms-inbox-timeline").insert({top:F})}else{if(h==screen_name){$("dms-outbox-timeline").insert({top:F})}}break;case"mentions":$("mentions-timeline").insert({bottom:F});break;case"home":$("home-timeline").insert({top:F});break}if(N&&I!="mentions"&&h!=screen_name){var u=cloneNodeWithEvents(F);u.setAttribute("id","comment-"+S+"-mentioned");P.setAttribute("id","left-"+S+"-mentioned");U.setAttribute("id","right-"+S+"-mentioned");z_engine_tweet_buttons("mentions",S,h,Z,L,O,k,j);new Element.extend(u);$("mentions-timeline").insert({top:u});z_engine_notification(r,"@"+h+" mentioned you!",L);new S2.FX.Parallel([new Effect.Appear("comment-"+S+"-mentioned",{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindDown("comment-"+S+"-mentioned",{duration:0.7,mode:"relative",transition:"easeOutSine"})],{duration:1.5})}z_engine_tweet_buttons(I,S,h,Z,L,O,k,j);new S2.FX.Parallel([new Effect.Appear("comment-"+S,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindDown("comment-"+S,{duration:0.7,mode:"relative",transition:"easeOutSine"})],{duration:1.5})}if(!N){tid++}}function z_engine_tweet_buttons(j,a,c,d,m,e,n,g){switch(j){case"home":if(c!=screen_name){var f=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+a+'", "'+g+'");',id:"reply-"+a,alt:""});if(!e){var k=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+a+'", "'+c+'", "'+escape_string(m)+'");',id:"rt-"+a,alt:""});new Element.extend(k)}else{var k=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""})}if(!n){var h=new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+a+'");',id:"fave-"+a,alt:""})}else{var h=new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+a+'");',id:"fave-"+a,alt:""})}new Element.extend(f);new Element.extend(h);$("right-"+a).insert(f);$("right-"+a).insert({bottom:k});$("right-"+a).insert({bottom:h})}else{var i=new Element("img",{onclick:'z_engine_destroy("'+a+'", "tweet");',src:"img/del.png",id:"del-"+a,alt:""});$("right-"+a).insert({bottom:i});new Element.extend(i)}var b=new Element("span");b.update(" ");var l=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+a+'");',src:"img/klt.png",id:"klout-"+a,alt:"",title:"click to get this users klout score",style:"cursor: pointer;"});b.insert({top:l});$("left-"+a).insert({top:b});break;case"mentions":if(c!=screen_name){var f=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+a+'-mentioned", "'+g+'");',id:"reply-"+a+"-mentioned",alt:""});if(!e){var k=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+a+'", "'+c+'", "'+escape_string(m)+'");',id:"rt-"+a+"-mentioned",alt:""});new Element.extend(k)}else{var k=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""})}if(!n){var h=new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+a+'");',id:"fave-"+a+"-mentioned",alt:""})}else{var h=new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+a+'");',id:"fave-"+a+"-mentioned",alt:""})}new Element.extend(f);new Element.extend(h);if($("right-"+a)){$("right-"+a).insert(f);$("right-"+a).insert({bottom:k});$("right-"+a).insert({bottom:h})}if($("right-"+a+"-mentioned")){$("right-"+a+"-mentioned").insert(f);$("right-"+a+"-mentioned").insert({bottom:k});$("right-"+a+"-mentioned").insert({bottom:h})}}else{var i=new Element("img",{onclick:'z_engine_destroy("'+a+'", "tweet");',src:"img/del.png",id:"del-"+a+"-mentioned",alt:""});if($("right-"+a)){$("right-"+a).insert({bottom:i})}if($("right-"+a+"-mentioned")){$("right-"+a+"-mentioned").insert({bottom:i})}new Element.extend(i)}if($("left-"+a)){var b=new Element("span");b.update(" ");var l=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+a+'");',src:"img/klt.png",id:"klout-"+a,alt:"",title:"click to get this users klout score",style:"cursor: pointer;"});b.insert({top:l});$("left-"+a).insert({top:b})}if($("left-"+a+"-mentioned")){var b=new Element("span");b.update(" ");var l=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+a+'");',src:"img/klt.png",id:"klout-"+a+"-mentioned",alt:"",title:"click to get this users klout score",style:"cursor: pointer;"});b.insert({top:l});$("left-"+a+"-mentioned").insert({top:b})}break;case"dms":if(c!=screen_name){var f=new Element("img",{onclick:'z_engine_reply_dm("'+d+'", "'+c+'");',src:"img/rep.png",id:"reply-"+a,alt:""});new Element.extend(f);$("right-"+a).insert(f)}var i=new Element("img",{onclick:'z_engine_destroy("'+a+'", "dm");',src:"img/del.png",id:"del-"+a,alt:""});new Element.extend(i);$("right-"+a).insert({bottom:i});break}}function z_engine_tweet_clear(){if($("home-timeline").visible()){var a="home-timeline"}else{if($("mentions-timeline").visible()){var a="mentions-timeline"}else{if($("dms-inbox-timeline").visible()){var a="dms-inbox-timeline"}else{if($("dms-outbox-timeline").visible()){var a="dms-outbox-timeline"}}}}$(a).fade({after:function(){$(a).update();$(a).appear()}})}function z_engine_tweet_mentioned(a){var b=false;a.user_mentions.each(function(c){if(c.screen_name==screen_name){b=true;$break}});return b}function z_engine_tweet_mentioned_string(a){var b="";a.user_mentions.each(function(c){if(c.screen_name!=screen_name){b+="@"+c.screen_name+" "}});return b}function z_engine_tweet_pause(){if(!paused){paused=true;$("pause").update("unpause");$("paused-count").appear();$("paused-count").morph("opacity: 1;");window.clearTimeout(a)}else{content_paused.each(function(b){if(typeof(b)==="undefined"){}else{if(b.isJSON()){var c=b.evalJSON(true);z_engine_tweet(c,"home")}}});content_paused.clear();paused=false;pttid=0;$("paused-count").fade({after:function(){$("pause").update("pause");$("paused-count").update("(0)")}});var a=window.setInterval(function(){this.z_engine_prune_tweets()},prune_tweets_interval)}}function z_engine_tweet_pause_handler(a){content_paused[pttid]=JSON.stringify(a);pttid++;$("paused-count").update("("+pttid+")")}function z_engine_unfavorite(a){socket.send({unfavorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/fav.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_favorite('"+a+"');")}}function z_engine_update_relative_time(b){var a=$$(b);a.each(function(c){var d=c.getAttribute("datetime");c.update(relative_time(d))})};