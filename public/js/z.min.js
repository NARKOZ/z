var content=Array();var content_paused=Array();var cutoff=200;var dm_to=false;var following=Array();var ids=Array();var paused=false;var page=1;var pttid=0;var reply_id=false;var screen_name="";var socket=new io.SessionSocket();var tid=0;var ts=0;var ttid=0;var user_id=0;function z_engine_attrition(){if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission()}new Element.extend("new-tweet-form");new Element.extend("home-timeline");new Element.extend("mentions-timeline");new Element.extend("dms-timeline");new Element.extend("dms-inbox-timeline");new Element.extend("dms-outbox-timeline");new Event.observe("clear","click",function(a){Event.stop(a);return z_engine_tweet_clear()});new Event.observe("pause","click",function(a){Event.stop(a);return z_engine_tweet_pause()});new Event.observe("new-tweet","keyup",function(a){if($("new-tweet").getValue().length===0){dm_to=false;reply_id=false}else{if($("new-tweet").getValue().length<=140){$("new-tweet").setStyle("color: #4d4d4d;")}else{if($("new-tweet").getValue().length>=141){$("new-tweet").setStyle("color: red;")}}}});new Event.observe("new-tweet","keydown",function(a){if($("new-tweet").getValue().length===0){reply_id=false}else{if($("new-tweet").getValue().length<=140){$("new-tweet").setStyle("color: #4d4d4d;")}else{if($("new-tweet").getValue().length>=141){$("new-tweet").setStyle("color: red;")}}}});socket.connect();socket.on("connect",function(){$("new-tweet").setValue("connected...")});socket.on("message",function(d){if(d.loaded){$("new-tweet").setValue("");$("new-tweet").enable();$("new-tweet-submit").enable();$("loading").fade();new Event.observe("new-tweet-form","submit",function(j){Event.stop(j);z_engine_send_tweet()});z_engine_clicker("home-timeline-click","home-timeline");z_engine_clicker("mentions-timeline-click","mentions-timeline");z_engine_clicker("dms-timeline-click","dms-timeline");z_engine_dms_clicker("dms-inbox-timeline-click","dms-inbox-timeline");z_engine_dms_clicker("dms-outbox-timeline-click","dms-outbox-timeline");socket.send({fetch:"home"});var b=window.setTimeout(function(){socket.send({fetch:"mentions"})},10000);var c=window.setTimeout(function(){socket.send({fetch:"dms-inbox"})},15000);var a=window.setTimeout(function(){socket.send({fetch:"dms-outbox"})},20000);var f=window.setInterval(function(){this.z_engine_update_relative_time()},15000);var h=window.setInterval(function(){z_engine_clean_tweets()},30000)}else{if(d["delete"]){var g=d["delete"].status.id;if(d["delete"].status.id_str){g=d["delete"].status.id_str}if($("comment-"+g)){$("comment-"+g).setStyle("text-decoration: line-through;");window.setTimeout(function(){new S2.FX.Parallel([new Effect.BlindUp("comment-"+g,{duration:1.25,mode:"relative"}),new Effect.Fade("comment-"+g,{duration:1,mode:"relative"}),],{duration:1.25})},5000)}}else{if(d.direct_message){z_engine_tweet(d.direct_message,"dms");if(d.direct_message.sender.screen_name!=screen_name){z_engine_notification(d.direct_message.sender.profile_image_url,d.direct_message.sender.screen_name+" sent a direct message",d.direct_message.text)}}else{if(d.dms){for(i=0;i<d.dms.length;i++){z_engine_tweet(d.dms[i],"dms")}}else{if(d.event){var e=d.event;if(e.favorite&&e.source.user.screen_name!=screen_name){z_engine_notification(e.source.user.profile_image_url,e.source.user.screen_name+" favorited your tweet!",e.target_object.text)}else{if(e.follow&&e.source.screen_name!=screen_name){z_engine_notification(e.source.profile_image_url,e.source.screen_name+" started following you!",e.source.description)}else{if(e.list_member_added&&d.source.screen_name!=screen_name){z_engine_notification(d.source.profile_image_url,d.source.screen_name+" put you in "+d.target_object.full_name,d.target_object.description)}else{console.log(JSON.stringify(d.event))}}}}else{if(d.friends){following=JSON.stringify(d.friends);Cookie.init({name:"friends",expires:365});Cookie.setData(JSON.stringify(d.friends),false)}else{if(d.info){screen_name=d.info.screen_name;user_id=d.info.user_id;Cookie.init({name:"info",expires:365});Cookie.setData(JSON.stringify(d.info),false)}else{if(d.mentions){for(i=0;i<d.mentions.length;i++){z_engine_tweet(d.mentions[i],"mentions")}}else{if(d.retweet_info){var e=d.retweet_info;if($("comment-"+e.retweeted_status.id_str)){$("rt-"+e.retweeted_status.id_str).writeAttribute("src","img/rtd.png");$("rt-"+e.retweeted_status.id_str).writeAttribute("onclick","z_engine_destroy('"+e.retweeted_status.id_str+"','rt');")}}else{if(d.text&&d.user&&d.created_at){if(!paused){z_engine_tweet(d,"home")}else{z_engine_tweet_pause_handler(d)}}}}}}}}}}}});socket.on("disconnect",function(){$("new-tweet").disable();$("new-tweet-submit").disable();$("new-tweet").setValue("lost connection!")})}function z_engine_clicker(b,a){new Event.observe(b,"click",function(d){Event.stop(d);if(a=="dms-timeline"){new S2.FX.Parallel([new Effect.Fade("dms-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Appear("dms-inbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"}),new Effect.Appear("dms-outbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"})],{duration:1})}else{if($("dms-inbox-timeline-click").visible()||$("dms-outbox-timeline-click").visible()){new S2.FX.Parallel([new Effect.Fade("dms-outbox-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Fade("dms-inbox-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Appear("dms-timeline-click",{delay:0.25,duration:0.25,mode:"relative"})],{duration:1})}}if(!$(a).visible()){if($("home-timeline").visible()){var c="home-timeline"}else{if($("mentions-timeline").visible()){var c="mentions-timeline"}else{if($("dms-timeline").visible()){var c="dms-timeline"}}}new S2.FX.Parallel([new Effect.Fade(c,{duration:0.25,mode:"relative"}),new Effect.BlindUp(c,{duration:0.25,mode:"relative"}),new Effect.BlindDown(a,{duration:0.25,mode:"relative"}),new Effect.Appear(a,{duration:0.25,mode:"relative"})],{duration:0.5})}})}function z_engine_dms_clicker(b,a){new Event.observe(b,"click",function(d){Event.stop(d);if(!$(a).visible()){if($("dms-outbox-timeline").visible()){var c="dms-outbox-timeline"}else{if($("dms-inbox-timeline").visible()){var c="dms-inbox-timeline"}}new S2.FX.Parallel([new Effect.Fade(c,{duration:0.25,mode:"relative"}),new Effect.BlindUp(c,{duration:0.25,mode:"relative"}),new Effect.BlindDown(a,{duration:0.25,mode:"relative"}),new Effect.Appear(a,{duration:0.25,mode:"relative"})],{duration:1})}})}function z_engine_clean_tweets(){var a=$("home-timeline").childElements();if(a.length>0){for(i=0;i<a.length;i++){if(i>cutoff){$(a[i]).remove()}}}window.setTimeout(function(){var b=$("mentions-timeline").childElements();if(b.length>0){for(i=0;i<b.length;i++){if(i>cutoff){$(b[i]).remove()}}}},10000);window.setTimeout(function(){var b=$("dms-inbox-timeline").childElements();if(b.length>0){for(i=0;i<b.length;i++){if(i>cutoff){$(b[i]).remove()}}}},20000);window.setTimeout(function(){var b=$("dms-outbox-timeline").childElements();if(b.length>0){for(i=0;i<b.length;i++){if(i>cutoff){$(b[i]).remove()}}}},30000)}function z_engine_destroy(d,c){var b=confirm("\nAre you sure you want to delete this?\n");if(b){if(c=="tweet"||c=="rt"){var a={destroy:{status:{id_str:d}}}}else{if(c=="dm"){var a={destroy_dm:{status:{id_str:d}}}}}if(c=="rt"){$("rt-"+d).setAttribute("src","img/rt.png");$("rt-"+d).setAttribute("onclick","z_engine_retweet('"+d+"');")}socket.send(a)}}function z_engine_favorite(a){socket.send({favorite:{status:{id_str:a}}});$("fave-"+a).writeAttribute("src","img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}function z_engine_kickstart(){if(window.addEventListener){window.addEventListener("load",z_engine_attrition(),false)}else{window.attachEvent("onload",z_engine_attrition())}}function z_engine_notification(d,a,c){if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var b=window.webkitNotifications.createNotification(d,a,c);b.show();window.setTimeout(function(){b.cancel()},5000)}else{if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission()}}}function z_engine_parse_tweet(a){if(!a){return a}else{a=twttr.txt.autoLink(a,{hashtagUrlBase:"https://search.twitter.com/search?q=%23"});a=a.replace(/\n\r?/g,"<br />");return a}}function z_engine_reply(b,a){reply_id=b;$("new-tweet").setValue("@"+a+" ");$("new-tweet").focus()}function z_engine_reply_dm(a){dm_to=a;$("new-tweet").setValue("~");$("new-tweet").focus()}function z_engine_retweet(b){var a=confirm("\nAre you sure you want to retweet this?\n");if(a){socket.send({retweet:{status:{id_str:b}}})}}function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();$("new-tweet-submit").disable();var a=$("new-tweet").getValue();if(!reply_id&&!dm_to){var b={status:{status:a,include_entities:true}}}else{if(reply_id!=false){var b={status:{status:a,in_reply_to_status_id:reply_id,include_entities:true}}}else{if(dm_to!=false){a=a.replace(/~/,"");var b={direct_message:{text:a,user_id:dm_to}}}}}socket.send(b);reply_id=false;dm_to=false;$("new-tweet").setValue("");$("new-tweet").enable();$("new-tweet-submit").enable()}}function z_engine_tweet(aa,E){if(E!="dms"){if(!aa.retweeted_status){var g=aa.user.screen_name;var ac=false;var q=aa.user.profile_image_url;var l=false;var Z=new Date(aa.created_at).toLocaleString().replace(/GMT.+/,"");var M=aa.entities;var j=aa.favorited;if(E!="dms"){var O=aa.id_str}else{var O=aa.id}var K=aa.user["protected"];var o=aa.user.name;var b=aa.place;var S=aa.in_reply_to_screen_name;var R=aa.in_reply_to_status_id_str;var Y=false;var A=aa.source;var H=aa.text;var V=aa.user.id;var r=aa.user.verified}else{var g=aa.retweeted_status.user.screen_name;var ac=aa.user.screen_name;var q=aa.retweeted_status.user.profile_image_url;var l=aa.user.profile_image_url;var Z=new Date(aa.retweeted_status.created_at).toLocaleString().replace(/GMT.+/,"");var M=aa.retweeted_status.entities;var j=aa.retweeted_status.favorited;if(E!="dms"){var O=aa.retweeted_status.id_str}else{var O=aa.retweeted_status.id}var K=aa.retweeted_status.user["protected"];var o=aa.retweeted_status.user.name;var b=aa.retweeted_status.place;var S=aa.retweeted_status.in_reply_to_screen_name;var R=aa.retweeted_status.in_reply_to_status_id_str;var Y=true;var A=aa.retweeted_status.source;var H=aa.retweeted_status.text;var V=aa.retweeted_status.user.id;var r=aa.retweeted_status.user.verified}}else{var g=aa.sender.screen_name;var q=aa.sender.profile_image_url;var Z=new Date(aa.created_at).toLocaleString().replace(/GMT.+/,"");var O=aa.id_str;var K=aa.sender["protected"];var o=aa.sender.name;var S=aa.in_reply_to_screen_name;var Y=false;var H=aa.text;var V=aa.sender_id;var r=aa.sender.verified}if(!content[O]){if(E!="mentions"){ids[tid]=O;content[O]=true}var d=new Element("br");if(!M){var J=false}else{var J=z_engine_tweet_mentioned(M)}var C=new Element("li",{id:"comment-"+O,"class":"comment-parent",style:"display:none;opacity:0;"});var m=new Element("div",{"class":"comment-profile-wrapper left"});var D=new Element("div",{"class":"comment-gravatar"});var a=new Element("a",{target:"_blank",href:"http://twitter.com/"+g});var U=new Element("img",{src:q,style:"height:50px;width:50px",alt:""});a.insert(U);D.insert(a);m.insert(D);var k=new Element("div",{id:"comment-"+O+"content","class":"comment-content-wrapper right"});if(g!=screen_name){if(!J){var G=new Element("div",{"class":"comment-body"})}else{var G=new Element("div",{"class":"comment-body-mentioned"})}}else{var G=new Element("div",{"class":"comment-body-me"})}var ad=new Element("div",{"class":"comment-arrow"});G.insert(ad);var t=new Element("div",{"class":"post-date"});var L=new Element("div",{"class":"left"});var y=new Element("a",{target:"_blank",href:"http://twitter.com/"+g});y.update("@"+g+" ");var n=new Element("span");n.update("wrote this ");if(E!="dms"){var u=new Element("a",{target:"_blank",id:"comment-"+O+"-relative-date",href:"http://twitter.com/"+g+"/status/"+O})}var W=new Element("time",{datetime:Z});W.update(relative_time(Z));if(E!="dms"){u.insert(W)}L.insert(y);L.insert({bottom:n});if(E!="dms"){L.insert({bottom:u});if(R){var e=new Element("span");e.update(" in reply to ");var c=new Element("a",{target:"_blank",href:"http://twitter.com/"+S+"/status/"+R});c.update(S+" ");L.insert(e);L.insert({bottom:c})}var I=new Element("span");I.update(" via "+A);L.insert({bottom:I});if(b&&b.full_name){var F=new Element("span");F.update(' from <a target="_blank" href="http://maps.google.com?q='+b.full_name+'">'+b.full_name+"</a>");L.insert({bottom:F})}}else{L.insert({bottom:W})}t.insert(L);var f=new Element("div",{"class":"right"});if(Y){var h=new Element("span");h.update('RT\'d by <a target="_blank" href="http://twitter.com/'+ac+'">'+ac+"</a> ");f.insert(h)}if(E!="dms"&&b&&b.full_name){var w=new Element("span");var x=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+b.full_name});var N=new Element("img",{src:"img/plc.png",alt:""});x.update(N);w.update(x);f.insert({bottom:w})}t.insert({bottom:f});G.insert({bottom:t});var z=new Element("div",{"class":"clearer"});z.update("&nbsp;");G.insert({bottom:z});var X=new Element("div",{"class":"comment-text"});var ab=new Element("p",{id:"comment-"+O+"-text"});var Q=new Element("div",{"class":"right"});if(g!=screen_name&&E!="dms"){var p=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+O+'", "'+g+'");',id:"reply-"+O,alt:""});if(!K){var P=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+O+'");',id:"rt-"+O,alt:""});new Element.extend(P)}else{var P=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""})}if(!j){var B=new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+O+'");',id:"fave-"+O,alt:""})}else{var B=new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+O+'");',id:"fave-"+O,alt:""})}new Element.extend(p);new Element.extend(B);Q.insert(p);Q.insert({bottom:P});Q.insert({bottom:B})}else{if(g==screen_name&&E!="dms"){var T=new Element("img",{onclick:'z_engine_destroy("'+O+'", "tweet");',src:"img/del.png",id:"del-"+O,alt:""});Q.insert({bottom:T});new Element.extend(T)}else{if(E=="dms"){if(g!=screen_name){var p=new Element("img",{onclick:'z_engine_reply_dm("'+V+'");',src:"img/rep.png",id:"reply-"+O,alt:""});Q.insert(p);new Element.extend(p)}var T=new Element("img",{onclick:'z_engine_destroy("'+O+'", "dm");',src:"img/del.png",id:"del-"+O,alt:""});Q.insert({bottom:T});new Element.extend(T)}}}ab.insert(d);ab.insert({bottom:Q});var v=new Element("div",{id:"text-"+O});v.update(z_engine_parse_tweet(H));ab.insert({bottom:v});X.insert(ab);G.insert({bottom:X});k.insert(G);C.insert(m);C.insert({bottom:k});C.insert({bottom:z});new Element.extend(C);switch(E){case"dms":if(g!=screen_name){$("dms-inbox-timeline").insert({top:C})}else{if(g==screen_name){$("dms-outbox-timeline").insert({top:C})}}break;case"mentions":$("mentions-timeline").insert({top:C});break;case"home":$("home-timeline").insert({top:C});break}new S2.FX.Parallel([new Effect.Appear("comment-"+O,{duration:1.25,mode:"relative"}),new Effect.BlindDown("comment-"+O,{duration:0.7,mode:"relative"})],{duration:1.5});if(J&&E!="mentions"){if(J){var s=cloneNodeWithEvents(C);s.setAttribute("id","comment-"+O+"-mentioned");new Element.extend(s);$("mentions-timeline").insert({top:s});z_engine_notification(q,g,H)}new S2.FX.Parallel([new Effect.Appear("comment-"+O+"-mentioned",{duration:1.25,mode:"relative"}),new Effect.BlindDown("comment-"+O+"-mentioned",{duration:0.7,mode:"relative"})],{duration:1.5})}}else{if(g==screen_name&&ac!=screen_name){z_engine_notification(l,ac+" retweeted you!",H)}}if(!J){tid++}}function z_engine_tweet_clear(){$("home-timeline").update()}function z_engine_tweet_mentioned(b){var c=false;if(b.user_mentions.length>0){for(var a=b.user_mentions.length;a--;){if(b.user_mentions[a].screen_name===screen_name){c=true;break}}}return c}function z_engine_tweet_pause(){if(!paused){paused=true;$("pause").update("paused")}else{for(i=0;i<=content_paused.length;i++){if(typeof(content_paused[i])==="undefined"){}else{if(content_paused[i].isJSON()){var a=content_paused[i].evalJSON();z_engine_tweet(a,"home")}}}content_paused=Array();paused=false;pttid=0;$("pause").update("pause")}}function z_engine_tweet_pause_handler(a){content_paused[pttid]=JSON.stringify(a);pttid++}function z_engine_unfavorite(a){socket.send({unfavorite:{status:{id_str:a}}});$("fave-"+a).writeAttribute("src","img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}function z_engine_update_relative_time(){var b=$$("time");for(var a=b.length;a--;){var c=b[a].getAttribute("datetime");b[a].update(relative_time(c))}};