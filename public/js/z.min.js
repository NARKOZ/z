store.get("client_blocks")||store.set("client_blocks","");var check_ratelimit_interval=300,content_faved_stored=[],content_queued=[],content_rts_stored=[],content_stored=[],current_tab="home-timeline",dms_cutoff=50,following=[];store.get("geo")||store.set("geo","off");if(store.get("geo")=="on")var geo_high_accuracy=false,geo_refresh_interval=300,geo_timeout=120;store.get("hashtag_blocks")||store.set("hashtag_blocks","");var home_cutoff=100;store.get("image_dropper")||store.set("image_dropper","on");
store.get("lang")||store.set("lang","english");var latest_threaded_id=0,latitude=false,loaded=false,loaded2=false,longitude=false,max_file_size=2;store.get("mention_blocks")||store.set("mention_blocks","");var mentions_cutoff=100;store.get("notifications")||store.set("notifications","on");store.get("notifications_timeout")||store.set("notifications_timeout",5);var paused=false,progress_bar="",prune_tweets_interval=60,rates=350,remember_cutoff=199,reply_id=false;
store.get("rt_type")||store.set("rt_type","comment");var screen_name="",scrollbar_home="",scrollbar_inbox="",scrollbar_mentions="",scrollbar_outbox="",scrollbar_threads="",shortened=false,socket="",socket_io_version_split=io.version.split("."),socket_io_version=socket_io_version_split[1],stream_queue_interval="";store.get("sound")||store.set("sound","on");
store.get("sound-src")||(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?store.set("sound_src","/audio/notify.mp3"):store.set("sound_src","/audio/notify.ogg"));if(store.get("sound")=="on"&&store.get("sound_src").length>0)if(window.HTMLAudioElement){var audio=new Audio;audio.src=store.get("sound_src")}store.get("stream_interval")||store.set("stream_interval",1.5);
var tabs="",threaded_cutoff=50,translation="",update_relative_dms_interval=60,update_relative_home_interval=15,update_relative_mentions_interval=30,uploading=false,user_id=0;store.get("user_blocks")||store.set("user_blocks","");store.get("users")||store.set("users","");
function z_engine_attrition(){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>=3||BrowserDetect.browser=="Chrome"||BrowserDetect.browser=="Opera"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"){if(socket_io_version!="6")socket=io.connectWithSession();else{socket=new io.SessionSocket;socket.connect()}if(!loaded){z_engine_get_language();new Event.observe("logout","click",function(a){Event.stop(a);z_engine_logout()})}socket.on("connect",
function(){loaded||$("new-tweet").setValue("connected...")});socket.on("disconnect",function(){$("new-tweet").disable();$("new-tweet").setValue("...")});if(socket_io_version!="6"){socket.on("delete",function(a){z_engine_handle_tweet_delete(a)});socket.on("direct_message",function(a){z_engine_handle_tweet_dm(a)});socket.on("dms",function(a){z_engine_handle_tweet_dms(a)});socket.on("event",function(a){z_engine_handle_events(a)});socket.on("friends",function(a){z_engine_handle_friends(a)});socket.on("home",
function(a){z_engine_handle_tweet_home(a)});socket.on("info",function(a){z_engine_handle_info(a)});socket.on("loaded",function(a){z_engine_handle_loaded(a)});socket.on("mentions",function(a){z_engine_handle_tweet_mentions(a)});socket.on("rates",function(a){z_engine_handle_rates(a)});socket.on("retweet_info",function(a){z_engine_handle_retweet_info(a)});socket.on("server_error",function(a){z_engine_handle_server_error(a)});socket.on("shorten",function(a){z_engine_handle_shortened(a)});socket.on("show",
function(a){z_engine_handle_tweet_show(a)});socket.on("tweet",function(a){z_engine_handle_tweet_data(a)})}else socket.on("message",function(a){var b=a.payload;switch(a.msg){case "delete":z_engine_handle_tweet_delete(b);break;case "direct_message":z_engine_handle_tweet_dm(b);break;case "dms":z_engine_handle_tweet_dms(b);break;case "event":z_engine_handle_events(b);break;case "friends":z_engine_handle_friends(b);break;case "home":z_engine_handle_tweet_home(b);break;case "info":z_engine_handle_info(b);
break;case "loaded":z_engine_handle_loaded(b);break;case "mentions":z_engine_handle_tweet_mentions(b);break;case "rates":z_engine_handle_rates(b);break;case "retweet_info":z_engine_handle_retweet_info(b);break;case "server_error":z_engine_handle_server_error(b);break;case "shorten":z_engine_handle_shortened(b);break;case "show":z_engine_handle_tweet_show(b);break;case "tweet":z_engine_handle_tweet_data(b)}})}else $("new-tweet").setValue("sorry, your browser may not support this client!")}
function z_engine_clear_timeline(){new Effect.Fade(current_tab,{duration:0.5,afterFinish:function(){$(current_tab).update().appear()}})}
function z_engine_destroy(a,b){if(confirm("\nare you sure you want to delete this?\n"))switch(b){case "dm":z_engine_handle_emitter("delete",{action:"dm",id_str:a});z_engine_drop_tweet(a);break;case "rt":content_rts_stored.each(function(c,h){if(c.isJSON()){var f=c.evalJSON(true);if(a==f.id_str){var g=f.retweeted_status.screen_name,i=f.screen_name,e=f.retweeted_status.entities,j=f.retweeted_status.favorited;a=f.retweeted_status.id_str;var m=f.retweeted_status.user["protected"],d=f.retweeted_status.text;
f=f.retweeted_status.user.id;e=e?z_engine_tweet_mentioned_string(e):false;content_rts_stored.splice(h,1);if($("rt-"+a)){$("rt-"+a).writeAttribute("title",translation.retweet);$("rt-"+a).writeAttribute("src","/img/rt.png");$("rt-"+a).writeAttribute("onclick","z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a,g,i,f,e,d,j,false,m,"home")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").writeAttribute("title",translation.retweet);$("rt-"+a+"-mentioned").writeAttribute("src","/img/rt.png");
$("rt-"+a+"-mentioned").writeAttribute("onclick","z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a+"-mentioned",g,i,f,e,d,j,false,m,"mentions")}if($("rt-"+a+"-threaded")){$("rt-"+a+"-threaded").writeAttribute("title",translation.retweet);$("rt-"+a+"-threaded").writeAttribute("src","/img/rt.png");$("rt-"+a+"-threaded").writeAttribute("onclick","z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a+"-threaded",g,i,f,e,d,j,false,m,"threads")}z_engine_handle_emitter("delete",
{action:"tweet",id_str:a})}}});break;case "tweet":z_engine_handle_emitter("delete",{action:"tweet",id_str:a})}}
function z_engine_drop_tweet(a){if(content_stored[a]){var b=content_stored.indexOf(a);content_stored.splice(b,1)}if($("comment-"+a)){$("comment-"+a).setStyle("text-decoration: line-through;");$("del-"+a)&&$("del-"+a).fade();$("fave-"+a)&&$("fave-"+a).fade();$("reply-"+a)&&$("reply-"+a).fade();$("rt-"+a)&&$("rt-"+a).fade();z_engine_fade_up("comment-"+a)}if($("comment-"+a+"-mentioned")){$("del-"+a+"-mentioned")&&$("del-"+a+"-mentioned").fade();$("fave-"+a+"-mentioned")&&$("fave-"+a+"-mentioned").fade();
$("reply-"+a+"-mentioned")&&$("reply-"+a+"-mentioned").fade();$("rt-"+a+"-mentioned")&&$("rt-"+a+"-mentioned").fade();z_engine_fade_up("comment-"+a+"-mentioned")}if($("comment-"+a+"-threaded")){$("del-"+a+"-threaded")&&$("del-"+a+"-threaded").fade();$("fave-"+a+"-threaded")&&$("fave-"+a+"-threaded").fade();$("reply-"+a+"-threaded")&&$("reply-"+a+"-threaded").fade();$("rt-"+a+"-threaded")&&$("rt-"+a+"-threaded").fade();z_engine_fade_up("comment-"+a+"-threaded")}z_engine_tweet_recalculate_layouts();
z_engine_timeline_recalculate_layouts()}function z_engine_fade_down(a){$(a).setStyle("display: none;");new Effect.Appear(a,{duration:1,transition:Effect.Transitions.sinoidal})}function z_engine_fade_up(a){new Effect.Fade(a,{duration:1,transition:Effect.Transitions.sinoidal})}
function z_engine_favorite(a){a=z_engine_reset_id(a);z_engine_handle_emitter("favorite",{action:"do",id_str:a});if($("fave-"+a)){$("fave-"+a).writeAttribute("title",translation.unfavorite);$("fave-"+a).writeAttribute("src","/img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("title",translation.unfavorite);$("fave-"+a+"-mentioned").writeAttribute("src","/img/favd.png");$("fave-"+a+"-mentioned").writeAttribute("onclick",
"z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-threaded")){$("fave-"+a+"-threaded").writeAttribute("title",translation.unfavorite);$("fave-"+a+"-threaded").writeAttribute("src","/img/favd.png");$("fave-"+a+"-threaded").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}}function z_engine_fetch_timeline(a){z_engine_handle_emitter("fetch",a)}
function z_engine_geo(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(z_engine_geo_set,z_engine_geo_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout*1E3});else if(google.loader.ClientLocation!=null){latitude=google.loader.ClientLocation.latitude;longitude=google.loader.ClientLocation.longitude}else longitude=latitude=false}
function z_engine_geo_error(a){switch(a.code){case 0:case 1:case 2:case 3:if(google.loader.ClientLocation!=null){latitude=google.loader.ClientLocation.latitude;longitude=google.loader.ClientLocation.longitude}else longitude=latitude=false}}function z_engine_geo_set(a){latitude=a.coords.latitude;longitude=a.coords.longitude}
function z_engine_get_height(a){var b=document;b=Math.max(Math.max(b.body.scrollHeight,b.documentElement.scrollHeight),Math.max(b.body.offsetHeight,b.documentElement.offsetHeight),Math.max(b.body.clientHeight,b.documentElement.clientHeight));if(a!=null|a!=0)b-=a;return b}
function z_engine_get_language(){var a=store.get("lang");switch(a){case "english":case "russian":new Ajax.Request("/lang/"+a+".json",{method:"GET",onSuccess:function(b){if(b.responseText.isJSON()){translation="";translation=b.responseText.evalJSON(true);z_engine_set_language();z_engine_settings_set_language()}}})}}function z_engine_handle_emitter(a,b){socket_io_version!="6"?socket.emit(a,b):socket.send({msg:a,payload:b})}
function z_engine_handle_events(a){switch(a.event){case "block":var b=$w(store.get("mention_blocks")).uniq().strip(),c=$w(store.get("user_blocks")).uniq().strip(),h=false,f=false;b.each(function(j){if(j==a.target.screen_name)h=true});c.each(function(j){if(j==a.target.screen_name)f=true});h||store.set("mention_blocks",current_blocks.join(" ")+" "+a.target.screen_name);f||store.set("user_blocks",current_blocks.join(" ")+" "+a.target.screen_name);break;case "unblock":b=$w(store.get("user_blocks")).uniq().strip();
c=$w(store.get("user_blocks")).uniq().strip();var g="",i="";b.each(function(j){if(j!=a.target.screen_name)g+=j+" "});c.each(function(j){if(j!=a.target.screen_name)i+=j+" "});store.set("mention_blocks",g);store.set("user_blocks",i);break;case "favorite":if(a.source.screen_name!=screen_name){if(content_faved_stored[a.target_object.id_str])content_faved_stored[a.target_object.id_str]++;else content_faved_stored[a.target_object.id_str]=1;b=a.source.profile_image_url;c=a.target_object.text;var e="@"+a.source.screen_name+
" faved your tweet!";z_engine_notification(b,e,c)}break;case "unfavorite":break;case "follow":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.source.description;e="@"+a.source.screen_name+" is following you!";z_engine_notification(b,e,c)}break;case "list_member_added":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.target_object.description;e="@"+a.source.screen_name+" put you in "+a.target_object.full_name+"!";z_engine_notification(b,e,c)}break;case "list_created":break;
case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.target_object.description;e="@"+a.source.screen_name+" subscribed to "+a.target_object.full_name+"!";z_engine_notification(b,e,c)}break;case "list_user_unsubscribed":break;case "scrub_geo":break;case "user_update":break;default:console.log(Object.toJSON(a.event));console.log(Object.toJSON(a))}}
function z_engine_handle_friends(a){a=a.join(" ");store.set("friends",a)}function z_engine_handle_info(a){screen_name=a.screen_name;user_id=a.user_id}function z_engine_handle_loaded(){if(loaded){z_engine_fetch_timeline("userstream");$("new-tweet").clear();$("new-tweet").enable()}else{loaded=true;z_engine_settings_setup();z_engine_timers();z_engine_timeline_recalculate_layouts();z_engine_ui_components();z_engine_ui_events()}}
function z_engine_handle_rates(a){rates=a.remaining_hits;a.remaining_hits<=10&&growler.growl("/img/dummy.png","notice!","you have "+a.remaining_hits+" (of "+a.hourly_limit+") request tokens left!")}function z_engine_handle_retweet_info(a){var b=a.retweeted_status.id_str,c=a.id_str;content_rts_stored[b]=Object.toJSON(a);z_engine_unretweet(b,c)}
function z_engine_handle_server_errors(a){switch(a.event){case "end":$("new-tweet").disable();growler.growl("/img/dummy.png","notice!","lost connection to the userstream, reconnecting...");break;case "error":$("new-tweet").disable();growler.growl("/img/dummy.png","notice!","error occurred, reconnecting...")}}function z_engine_handle_shortened(a){typeof a.shortened!="undefined"&&$("new-tweet").setValue($("new-tweet").getValue().sub(a.original,a.shortened))}
function z_engine_handle_tweet_data(a){if(a.retweeted_status&&a.retweeted_status.user.screen_name==screen_name&&a.user.screen_name!=screen_name){var b=a.retweeted_status.retweet_count-1;z_engine_notification(a.user.profile_image_url,b>1?"@"+a.user.screen_name+" and "+b+" others rt'd you!":b==1?"@"+a.user.screen_name+" and 1 other rt'd you!":"@"+a.user.screen_name+" retweeted you!",a.retweeted_status.text)}else{content_queued.push(Object.toJSON(a));paused&&$("paused-count").update("("+content_queued.length+
")")}}function z_engine_handle_tweet_delete(a){typeof a.status=="object"&&z_engine_drop_tweet(a.status.id_str)}function z_engine_handle_tweet_dm(a){z_engine_tweet(a,"dms top");if(a.sender.screen_name!=screen_name){var b=a.sender.profile_image_url,c=a.text;a="@"+a.sender.screen_name+" sent a direct message"}else{b=a.recipient.profile_image_url;c="sent a dm to @"+a.recipient.screen_name+"!";a=a.text}z_engine_notification(b,a,c)}
function z_engine_handle_tweet_dms(a){z_engine_tweet(a,"dms bottom");if(!loaded2){loaded2=true;$("loading").fade()}}function z_engine_handle_tweet_home(a){z_engine_tweet(a,"home bottom");if(!loaded2){loaded2=true;$("loading").fade()}}function z_engine_handle_tweet_mentions(a){z_engine_tweet(a,"mentions bottom");if(!loaded2){loaded2=true;$("loading").fade()}}
function z_engine_handle_tweet_show(a){content_stored[a.retweeted_status?a.retweeted_status.id_str:a.id_str]=Object.toJSON(a);z_engine_tweet(a,"threaded bottom")}
function z_engine_image_dropper(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){$("image").show();$("image").ondragover=function(a){a.preventDefault();$("image").setStyle("border-color: #aaa;");return false};$("image").ondragend=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false};$("image").ondrop=function(a){a.preventDefault();if(uploading){growler.growl("/img/dummy.png","error!","wait until the current upload is finished!");$("image").setStyle("border-color: red;");
Element.setStyle.delay(2,"image","border-color: #ddd;")}else{var b=a.dataTransfer.files[0];if(b.size<=max_file_size*1048576)switch(b.type){case "application/pdf":case "image/apng":case "image/bmp":case "image/gif":case "image/jpeg":case "image/jpg":case "image/png":case "image/tiff":a=new FormData;a.append("image",b);a.append("key",imgur_key);b=new XMLHttpRequest;b.upload.onprogress=function(c){uploading=true;c.lengthComputable&&progress_bar.step(c.loaded/c.total*100)};b.onreadystatechange=function(){if(this.readyState==
1){$("progress-bar").appear();$("image").setStyle("border-color: #ddd;")}else if(this.readyState==4){$("progress-bar").fade();if(this.status==200){if(this.responseText.isJSON()){var c=this.responseText.evalJSON(true).upload.links.original,h=$("new-tweet").getValue();if(h.length>0)var f=h+" "+c;else if(h.length==0)f=c;$("new-tweet").setValue(f)}}else{growler.growl("/img/dummy.png","error!","there seems to have been an error on imgur's end!");$("image").setStyle("border-color: red;");Element.setStyle.delay(2,
"image","border-color: #ddd;")}uploading=false}};b.open("POST","http://api.imgur.com/2/upload.json",true);b.send(a);break;default:growler.growl("/img/dummy.png","error!","this file is not supported, sorry!");$("image").setStyle("border-color: red;");Element.setStyle.delay(2,"image","border-color: #ddd;")}}return false};$("image").ondragleave=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false}}}
function z_engine_input(){var a=$("new-tweet").getValue();$("new-dm-user").getValue();if(a.length==0){$("new-tweet").setStyle("color: #4d4d4d;");shortened=reply_id=false}else if(a.length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else if(a.length>=141){z_engine_shorten_urls();$("new-tweet").setStyle("color: red;")}}
function z_engine_input_resize(){$("new-tweet").style.height=Math.floor($F($("new-tweet")).split("\n").inject(1,function(a,b){return a+(b.length/$("new-tweet").getHeight()+15)}))+"px"}function z_engine_logout(){$("new-tweet").disable();$("new-tweet").setValue("see ya!");window.location="/oauth/logout"}
function z_engine_notification(a,b,c){if(store.get("notifications")=="on"){if(store.get("sound")=="on"&&store.get("sound_src").length>0&&(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE"))audio.play();if(c==null)c="";growler.growl(a,b,c.unescapeHTML())}}function z_engine_parse_tweet(a){if(a){a=twttr.txt.autoLink(a);a=a.replace(/\n\r?/g,"<br />")}return a}
function z_engine_prune_tweets(){var a=$("home-timeline").childElements(),b=$("mentions-timeline").childElements(),c=$("dms-inbox-timeline").childElements(),h=$("dms-outbox-timeline").childElements(),f=$("threaded-timeline").childElements();a.length>=home_cutoff&&a.each(function(g,i){if(i>home_cutoff){var e=$(g).readAttribute("id").replace(/comment-/i,"");e=content_stored.indexOf(e);content_stored.splice(e,1);$(g).remove()}});b.length>=mentions_cutoff&&b.each.delay(12,function(g,i){if(i>mentions_cutoff){var e=
$(g).readAttribute("id").replace(/comment-/i,"");e=e.replace(/-mentioned/i,"");e=content_stored.indexOf(e);content_stored.splice(e,1);$(g).remove()}});c.length>=dms_cutoff&&c.each.delay(24,function(g,i){if(i>dms_cutoff){var e=$(g).readAttribute("id").replace(/comment-/i,"");e=content_stored.indexOf(e);content_stored.splice(e,1);$(g).remove()}});h.length>=dms_cutoff&&h.each.delay(36,function(g,i){if(i>dms_cutoff){var e=$(g).readAttribute("id").replace(/comment-/i,"");e=content_stored.indexOf(e);content_stored.splice(e,
1);$(g).remove()}});f.length>=threaded_cutoff&&f.each.delay(48,function(g,i){if(i>threaded_cutoff){var e=$(g).readAttribute("id").replace(/comment-/i,"");e=e.replace(/-mentioned/i,"");e=content_stored.indexOf(e);content_stored.splice(e,1);$(g).remove()}})}function z_engine_reply(a,b,c){reply_id=b;$("new-tweet").setValue("@"+a+" "+c);$("new-tweet").focus()}function z_engine_reply_dm(a,b){$("new-dm-user").setValue(b);$("new-tweet").focus()}
function z_engine_reset_id(a){content_rts_stored.each(function(b){if(b.isJSON()){b=b.evalJSON(true);if(a==b.id_str)a=b.retweeted_status.id_str}});return a}function z_engine_retweet(a){z_engine_handle_emitter("retweet",{id_str:a})}function z_engine_retweet_comment(a,b,c){reply_id=a;switch(store.get("rt_type")){case "comment":$("new-tweet").setValue("RT @"+b+": "+c.unescapeHTML());break;case "quote":$("new-tweet").setValue('"@'+b+": "+c.unescapeHTML()+'" ')}$("new-tweet").focus()}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();$("new-dm-user").disable();var a=$("new-tweet").getValue().strip(),b=$("new-dm-user").getValue().strip();switch(current_tab){case "home-timeline-container":case "mentions-timeline-container":case "threaded-timeline-container":var c={action:"tweet",data:{status:a,include_entities:true}};store.get("geo")=="on"&&latitude&&longitude&&new Object.extend(c.data,{display_coordinates:true,
lat:latitude,"long":longitude});reply_id&&new Object.extend(c.data,{in_reply_to_status_id:reply_id});break;case "dms-inbox-timeline-container":case "dms-outbox-timeline-container":if(b.length>0){if(b.startsWith("@"))b=b.replace(/@/i,"");c={action:"dm",data:{screen_name:b,text:a}}}}z_engine_handle_emitter("status",c);shortened=reply_id=false;$("new-dm-user").enable();$("new-dm-user").clear();$("new-tweet").clear();$("new-tweet").enable();$("new-tweet").focus()}}
function z_engine_set_language(){$("home-timeline-click").update(translation.home);$("mentions-timeline-click").update(translation.mentions);$("dms-inbox-timeline-click").update(translation.inbox);$("dms-outbox-timeline-click").update(translation.outbox);$("pause").update(translation.stop);$("image").update(translation.image);$("settings").update(translation.settings);$("logout").update(translation.exit);$("new-dm-user").placeholder=translation.dm_to_placeholder;$("new-tweet").placeholder=translation.tweet_placeholder}
function z_engine_settings_checked_clicker(a,b){new Event.observe(a,"change",function(c){Event.stop(c);c=$(a).getValue();switch(b){case "geo":c=store.get(b)=="on"?"off":"on";store.set(b,c);if(store.get(b)=="on")z_engine_geo();else longitude=latitude=false;break;case "lang":store.set(b,c);z_engine_get_language();break;case "notifications_timeout":store.set(b,c);break;case "rt_type":store.set(b,c);break;case "stream_interval":store.set(b,c);stream_queue_interval.stop();stream_queue_interval=new PeriodicalExecuter(function(){paused||
z_engine_stream_queue()},c);break;default:c=store.get(b)=="on"?"off":"on";store.set(b,c)}})}
function z_engine_settings_get(a,b){switch(b){case "lang":$("language").childElements().each(function(c){c.removeAttribute("selected")});$(store.get(b)).writeAttribute("selected","selected");break;case "notifications_timeout":$(a).setValue(store.get(b));break;case "rt_type":$("retweet").childElements().each(function(c){c.removeAttribute("selected")});$(store.get(b)).writeAttribute("selected","selected");break;case "stream_interval":$(a).setValue(store.get(b));break;default:store.get(b)=="on"&&$(a).click()}}
function z_engine_settings_set_language(){$("language-settings").update(translation.language_settings);$("retweet-settings").update(translation.retweet_settings);$("comment").update(translation.comment);$("quote").update(translation.quote);$("notify-settings").update(translation.notify_settings);$("notify-enable-settings").update(translation.notify_enable_settings);$("notify-audio-settings").update(translation.notify_audio_settings);$("notify-length-settings").update(translation.notify_length_settings);
$("wait-length-settings").update(translation.wait_length_settings);$("other-settings").update(translation.other_settings);$("geo-settings").update(translation.geo_settings)}
function z_engine_settings_setup(){z_engine_settings_get("language","lang");z_engine_settings_checked_clicker("language","lang");z_engine_settings_get("retweet","rt_type");z_engine_settings_checked_clicker("retweet","rt_type");z_engine_settings_get("use-audio","sound");z_engine_settings_checked_clicker("use-audio","sound");z_engine_settings_get("use-notify","notifications");z_engine_settings_checked_clicker("use-notify","notifications");z_engine_settings_get("notify-length","notifications_timeout");
z_engine_settings_checked_clicker("notify-length","notifications_timeout");z_engine_settings_get("stream-interval","stream_interval");z_engine_settings_checked_clicker("stream-interval","stream_interval");z_engine_settings_get("use-geo","geo");z_engine_settings_checked_clicker("use-geo","geo")}
function z_engine_shorten_urls(){var a=$("new-tweet").getValue();if(a.length>0&&!shortened){a.scan(/((https?\:\/\/)|(www\.))([^ \(\)\{\}\[\]]+)/,function(b){b[0].length>=20&&z_engine_handle_emitter("shorten",{shorten:b[0]})});shortened=true;z_engine_input()}}function z_engine_stream_queue(){if(content_queued.length>0){var a=content_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"home top")}}}
function z_engine_timers(){z_engine_fetch_timeline("dms-inbox");z_engine_fetch_timeline("rates");z_engine_fetch_timeline("home");z_engine_fetch_timeline.delay(2,"userstream");z_engine_fetch_timeline.delay(15,"mentions");z_engine_fetch_timeline.delay(30,"dms-inbox");z_engine_fetch_timeline.delay(45,"dms-outbox");new PeriodicalExecuter(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.mentions")},
update_relative_mentions_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.dms")},update_relative_dms_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.threaded")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_fetch_timeline("rates")},check_ratelimit_interval);new PeriodicalExecuter(function(){paused||z_engine_prune_tweets()},prune_tweets_interval);stream_queue_interval=new PeriodicalExecuter(function(){paused||
z_engine_stream_queue()},store.get("stream_interval"));store.get("geo")=="on"&&new PeriodicalExecuter(function(){z_engine_geo()},geo_refresh_interval);new PeriodicalExecuter(function(){z_engine_input()},1)}
function z_engine_threaded(a,b){if(a){tabs.last();if(content_stored[a])content_stored[a].isJSON()&&z_engine_tweet(content_stored[a].evalJSON(true),"threaded top");else z_engine_handle_emitter("show",{id_str:a})}else if(content_stored[b])content_stored[b].isJSON()&&z_engine_tweet(content_stored[b].evalJSON(true),"threaded bottom");else z_engine_handle_emitter("show",{id_str:b})}
function z_engine_tweet(a,b){var c=$w(b),h=c[0];c=c[1];if(h!="dms")if(a.retweeted_status){f=a.retweeted_status.user.screen_name;g=a.user.screen_name;i=a.retweeted_status.user.profile_image_url;e=BrowserDetect.browser=="Opera"?a.retweeted_status.created_at:(new Date(a.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");j=a.retweeted_status.entities;m=a.retweeted_status.favorited;d=a.retweeted_status.id_str;o=a.retweeted_status.user["protected"];l=a.retweeted_status.place;n=a.retweeted_status.in_reply_to_screen_name;
v=a.retweeted_status.in_reply_to_status_id_str;k=a.retweeted_status.retweet_count-1;t=true;E=a.retweeted_status.source.stripTags();z=a.retweeted_status.text;C=a.retweeted_status.user.id;p=a.retweeted_status.user.verified}else{var f=a.user.screen_name,g=false,i=a.user.profile_image_url,e=BrowserDetect.browser=="Opera"?a.created_at:(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");e=a.created_at;var j=a.entities,m=a.favorited,d=a.id_str,o=a.user["protected"],l=a.place,n=a.in_reply_to_screen_name,
v=a.in_reply_to_status_id_str,k=a.retweet_count-1,t=false,E=a.source.stripTags(),z=a.text,C=a.user.id,p=a.user.verified}else{f=a.sender.screen_name;i=a.sender.profile_image_url;e=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");j=false;d=a.id_str;o=false;n=a.recipient.screen_name;k=0;t=false;z=a.text;C=a.sender_id;p=a.sender.verified}var J=false,K=false,L=false,M=false,w=false;if(h!="threaded"&&content_stored[d])w=true;h!="dms"&&$w(store.get("client_blocks")).uniq().each(function(A){if(A.replace("'",
"")==E)J=true});if(j){typeof j.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(A){j.hashtags.uniq().each(function(F){if(A==F)K=true})});typeof j.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(A){j.user_mentions.uniq().each(function(F){if(A==F)L=true})})}$w(store.get("user_blocks")).uniq().each(function(A){if(A==f)M=true});if(!w&&!J&&!K&&!L&&!M){(new Image).src=i;content_stored[d]=Object.toJSON(a);if(j){G=z_engine_tweet_mentioned(j);w=z_engine_tweet_mentioned_string(j)}else{var G=
false;w=false}var D=new Element("br"),x=h!="dms"?new Element("div",{ondblclick:'z_engine_reply("'+f+'", "'+d+'", "'+w+'");',id:"comment-"+d,"class":"comment-parent"}):new Element("div",{ondblclick:'z_engine_reply_dm("'+C+'", "'+f+'");',id:"comment-"+d,"class":"comment-parent"}),N=new Element("div",{"class":"comment-profile-wrapper left"}),r=new Element("div",{"class":"comment-gravatar"}),H=new Element("img",{id:"av-"+d,src:i,style:"height: 50px; width: 50px;",alt:""});r.insert(H);N.insert(r);var O=
new Element("div",{id:"comment-"+d+"content","class":"comment-content-wrapper right"});r=f!=screen_name?G?new Element("div",{"class":"comment-body-mentioned",id:"comment-body-"+d}):new Element("div",{"class":"comment-body",id:"comment-body-"+d}):new Element("div",{"class":"comment-body-me"});var q=new Element("div",{"class":"comment-arrow"});r.insert(q);var y=new Element("div",{"class":"post-date"});q=new Element("div",{"class":"left",id:"left-"+d});var P=new Element("a",{target:"_blank",href:"http://twitter.com/"+
f});P.update("@"+f+" ");var Q=new Element("span");Q.update(translation.wrote_this);if(h!="dms")var s=new Element("a",{target:"_blank",id:"comment-"+d+"-relative-date",href:"http://twitter.com/"+f+"/status/"+d});var I=new Element("time",{datetime:e,"class":h});I.update(relative_time(e));h!="dms"&&s.insert(I);q.insert(P);q.insert({bottom:Q});if(h!="dms"){q.insert({bottom:s});if(v){s=new Element("span");s.update(translation.in_reply_to);e=h=="threaded"?new Element("a",{target:"_blank",href:"http://twitter.com/"+
n+"/status/"+v}):new Element("span",{onclick:'z_engine_threaded("'+d+'","'+v+'");',style:"cursor: pointer;"});e.update("@"+n+" ");q.insert(s);q.insert({bottom:e})}n=new Element("span",{"class":"via"});n.update(translation.via+" "+E);q.insert({bottom:n})}else{q.insert({bottom:I});if(n){s=new Element("span");s.update(" in reply to ");e=new Element("a",{target:"_blank",href:"http://twitter.com/"+n});e.update(n+" ");q.insert(s);q.insert({bottom:e})}}if(p){p=new Element("span");p.update(" ");n=new Element("img",
{src:"/img/ver.png",alt:"",title:"verified user"});p.insert({bottom:n});q.insert({bottom:p})}y.insert(q);p=new Element("div",{"class":"right"});if(h!="dms"&&l&&l.full_name){n=new Element("span",{"class":"place",id:"place-"+d});s=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+l.full_name});l=new Element("img",{src:"/img/plc.png",alt:"",title:l.full_name});s.update(l);n.update(s);p.insert({bottom:n})}if(t){k=k>0?translation.retweeted_by+" "+g+" + "+k+" "+translation.others+"!":translation.retweeted_by+
" "+g+"!";l=new Element("span",{"class":"rtd"});l.update(" ");k=new Element("img",{src:"/img/rtd2.png",alt:"",title:k});n=new Element("a",{target:"_blank",href:"http://twitter.com/"+g});n.update(g);l.insert({top:k});l.insert({bottom:n});p.insert({bottom:l})}y.insert({bottom:p});r.insert({bottom:y});l=new Element("div",{"class":"clearer"});l.update("&nbsp;");r.insert({bottom:l});k=new Element("div",{"class":"comment-text"});p=new Element("p",{id:"comment-"+d+"-text"});y=new Element("div",{id:"right-"+
d,"class":"right"});p.insert(D);p.insert({bottom:y});D=new Element("div",{id:"text-"+d,"class":"comment-text-select"});D.update(z_engine_parse_tweet(z.truncate(140)));p.insert({bottom:D});k.insert(p);r.insert({bottom:k});O.insert(r);x.insert(N);x.insert({bottom:O});x.insert({bottom:l});new Element.extend(r);new Element.extend(q);new Element.extend(y);new Element.extend(x);switch(c){case "bottom":var u={bottom:x};break;case "top":u={top:x}}switch(h){case "dms":if(f!=screen_name)$("dms-inbox-timeline").insert(u);
else f==screen_name&&$("dms-outbox-timeline").insert(u);break;case "home":$("home-timeline").insert(u);break;case "mentions":$("mentions-timeline").insert(u)}if(G&&h!="mentions"&&h!="threaded"&&f!=screen_name&&!a.retweeted_status){u=cloneNodeWithEvents(x);u.writeAttribute("id","comment-"+d+"-mentioned");r.writeAttribute("id","comment-body-"+d+"-mentioned");q.writeAttribute("id","left-"+d+"-mentioned");y.writeAttribute("id","right-"+d+"-mentioned");H.writeAttribute("id","av-"+d+"-mentioned");new Element.extend(u);
switch(c){case "bottom":var B={bottom:u};break;case "top":B={top:u}}$("mentions-timeline").insert(B);z_engine_tweet_buttons("mentions",d,f,g,C,z,o,m,t,w);z_engine_fade_down("comment-"+d+"-mentioned");z_engine_notification(i,"@"+f+" mentioned you!",z)}if(h=="threaded"){r.writeAttribute("id","comment-body-"+d+"-threaded");q.writeAttribute("id","left-"+d+"-threaded");y.writeAttribute("id","right-"+d+"-threaded");H.writeAttribute("id","av-"+d+"-threaded");B=cloneNodeWithEvents(x);B.writeAttribute("id",
"comment-"+d+"-threaded");new Element.extend(B);switch(c){case "bottom":var R={bottom:B};break;case "top":R={top:B}}$("threaded-timeline").insert(R);z_engine_tweet_buttons("threaded",d,f,g,C,z,o,m,t,w);z_engine_fade_down("comment-"+d+"-threaded")}if($("comment-"+d)){z_engine_tweet_buttons(h,d,f,g,C,z,o,m,t,w);z_engine_fade_down("comment-"+d)}}h=="threaded"&&v&&z_engine_threaded(false,v);z_engine_tweet_recalculate_layouts()}
function z_engine_tweet_buttons(a,b,c,h,f,g,i,e,j,m){switch(a){case "dms":if(c!=screen_name){var d=new Element("img",{onclick:'z_engine_reply_dm("'+f+'", "'+c+'");',src:"/img/rep.png",title:translation.reply,id:"reply-"+b,alt:""});new Element.extend(d);$("right-"+b).insert(d)}d=new Element("img",{onclick:'z_engine_destroy("'+b+'", "dm");',src:"/img/del.png",title:translation.destroy,id:"del-"+b,alt:""});new Element.extend(d);$("right-"+b).insert({bottom:d});z_engine_tweet_right_click(b,"comment-"+
b,c,h,f,m,g,e,j,i,a);break;case "home":if(c!=screen_name){d=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+m+'");',title:translation.reply,id:"reply-"+b,alt:""});new Element.extend(d);if(i)o=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{var o=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:translation.retweet,id:"rt-"+b,alt:""});new Element.extend(o)}var l=e?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+
b+'");',title:translation.unfavorite,id:"fave-"+b,alt:""}):new Element("img",{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:translation.favorite,id:"fave-"+b,alt:""});$("right-"+b).update();$("right-"+b).insert(d);$("right-"+b).insert({bottom:o});$("right-"+b).insert({bottom:l})}else{d=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',title:translation.destroy,src:"/img/del.png",id:"del-"+b,alt:""});new Element.extend(d);$("right-"+b).update();$("right-"+b).insert({bottom:d})}z_engine_tweet_right_click(b,
"comment-"+b,c,h,f,m,g,e,j,i,a);break;case "mentions":if(c!=screen_name){d=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'-mentioned", "'+m+'");',title:translation.reply,id:"reply-"+b+"-mentioned",alt:""});new Element.extend(d);if(i)o=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{o=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:translation.retweet,id:"rt-"+b+"-mentioned",alt:""});new Element.extend(o)}l=
e?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',title:translation.unfavorite,id:"fave-"+b+"-mentioned",alt:""}):new Element("img",{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:translation.favorite,id:"fave-"+b+"-mentioned",alt:""});if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert(d);$("right-"+b).insert({bottom:o});$("right-"+b).insert({bottom:l})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert(d);
$("right-"+b+"-mentioned").insert({bottom:o});$("right-"+b+"-mentioned").insert({bottom:l})}}else{d=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',title:translation.destroy,src:"/img/del.png",id:"del-"+b+"-mentioned",alt:""});new Element.extend(d);if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert({bottom:d})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert({bottom:d})}}$("comment-"+b)&&z_engine_tweet_right_click(b,"comment-"+
b,c,h,f,m,g,e,j,i,a);$("comment-"+b+"-mentioned")&&z_engine_tweet_right_click(b,"comment-"+b+"-mentioned",c,h,f,m,g,e,j,i,a);break;case "threaded":if(c!=screen_name){d=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+m+'");',title:translation.reply,id:"reply-"+b+"-threaded",alt:""});new Element.extend(d);if(i)o=new Element("img",{src:"/img/lock.png",style:"cursor: default;",alt:""});else{o=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',
id:"rt-"+b+"-threaded",title:translation.retweet,alt:""});new Element.extend(o)}l=e?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',title:translation.unfavorite,id:"fave-"+b+"-threaded",alt:""}):new Element("img",{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:translation.favorite,id:"fave-"+b+"-threaded",alt:""});if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert(d);$("right-"+b+"-threaded").insert({bottom:o});
$("right-"+b+"-threaded").insert({bottom:l})}}else{d=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"/img/del.png",title:translation.destroy,id:"del-"+b+"-threaded",alt:""});new Element.extend(d);if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert({bottom:d})}}z_engine_tweet_right_click(b,"comment-"+b+"-threaded",c,h,f,m,g,e,j,i,a)}}
function z_engine_tweet_mentioned(a){var b=false;a.user_mentions.uniq().each(function(c){if(c.screen_name==screen_name)b=true});return b}function z_engine_tweet_mentioned_string(a){if(a&&a.user_mentions.length>0){var b="";a.user_mentions.uniq().each(function(c){if(c.screen_name!=screen_name)b+="@"+c.screen_name+" "});return b.length>0?$w(b).uniq().join(" ")+" ":""}else return""}
function z_engine_tweet_pause(){if(paused){paused=false;new Effect.Fade("paused-count",{afterFinish:function(){$("paused-count").update("(0)");$("pause").update(translation.stop)}})}else{paused=true;$("pause").update(translation.start);$("paused-count").appear()}}
function z_engine_timeline_recalculate_layouts(){$("home-timeline").setStyle("height: "+z_engine_get_height(120)+"px;");$("mentions-timeline").setStyle("height: "+z_engine_get_height(120)+"px;");$("dms-inbox-timeline").setStyle("height: "+z_engine_get_height(120)+"px;");$("dms-outbox-timeline").setStyle("height: "+z_engine_get_height(120)+"px;");$("threaded-timeline").setStyle("height: "+z_engine_get_height(120)+"px;")}
function z_engine_tweet_recalculate_layouts(){scrollbar_home.recalculateLayout();scrollbar_inbox.recalculateLayout();scrollbar_mentions.recalculateLayout();scrollbar_outbox.recalculateLayout();scrollbar_threads.recalculateLayout()}
function z_engine_tweet_right_click(a,b,c,h,f,g,i,e,j,m,d){var o=false,l=true,n=false,v=false;if(c==screen_name){o=true;l=false}j||(n=true);if(j&&h!=screen_name){n=true;j=false}else if(j&&h==screen_name)v=true;var k=new Control.ContextMenu(b,{animation:false});switch(d){case "home":case "mentions":case "threaded":if(o)k.addItem({label:'<img src="/img/del.png" alt="" />',callback:function(){z_engine_destroy(a,"tweet")}});else{k.addItem({label:'<img src="/img/rep.png" alt="" />',callback:function(){z_engine_reply(c,
a,g)}});if(m)k.addItem({label:'<img src="/img/lock.png" alt="" />',enabled:false});else{k.addItem({label:function(){return'<img src="/img/rt.png" alt="" />'},condition:function(){return n},callback:function(){z_engine_retweet(a);k.destroy();new PeriodicalExecuter(function(t){if(content_rts_stored[a]&&content_rts_stored[a].isJSON()){t.stop();t=content_rts_stored[a].evalJSON(true).id_str;z_engine_tweet_right_click(t,b,c,screen_name,f,g,i,e,true,m,d)}},0.25)}});k.addItem({label:function(){return"<span>RT</span>"},
condition:function(){return n},callback:function(){z_engine_retweet_comment(a,c,i)}});k.addItem({label:function(){return'<img src="/img/rtd.png" alt="" />'},condition:function(){return v},callback:function(){z_engine_destroy(a,"rt");k.close();k.destroy();z_engine_tweet_right_click(a,b,c,screen_name,f,g,i,e,false,m,d)}})}e?k.addItem({label:'<img src="/img/favd.png" alt="" />',callback:function(){z_engine_unfavorite(a);k.close();k.destroy();z_engine_tweet_right_click(a,b,c,h,f,g,i,false,j,m,d)}}):k.addItem({label:'<img src="/img/fav.png" alt="" />',
callback:function(){z_engine_favorite(a);k.close();k.destroy();z_engine_tweet_right_click(a,b,c,h,f,g,i,true,j,m,d)}})}break;case "dms":k.addItem({label:function(){return'<img src="/img/rep.png" alt="" />'},condition:function(){return l},callback:function(){z_engine_reply_dm(f,c)}});k.addItem({label:'<img src="/img/del.png" alt="" />',callback:function(){z_engine_destroy(a,"dm")}})}}
function z_engine_ui_components(){$("new-tweet").clear();$("new-tweet").enable();store.get("geo")=="on"&&z_engine_geo();store.get("image_dropper")=="on"&&z_engine_image_dropper();store.get("geo")=="on"&&new HotKey("l",function(){z_engine_geo()},{shiftKey:true});new HotKey("o",function(){z_engine_clear_timeline()},{shiftKey:true});new HotKey("p",function(){z_engine_tweet_pause()},{shiftKey:true});new HotKey("s",function(){z_engine_shorten_urls()},{shiftKey:true});progress_bar=new Control.ProgressBar("progress-bar");
new Control.Modal($(document.body).down("[href=#settings-div]"),{className:"window",closeOnClick:"overlay",fade:true,overlayOpacity:0.5});scrollbar_home=new Control.ScrollBar("home-timeline","home-timeline-scroll",{scroll_to_smoothing:0.5});scrollbar_mentions=new Control.ScrollBar("mentions-timeline","mentions-timeline-scroll",{scroll_to_smoothing:0.5});scrollbar_inbox=new Control.ScrollBar("dms-inbox-timeline","dms-inbox-timeline-scroll",{scroll_to_smoothing:0.5});scrollbar_outbox=new Control.ScrollBar("dms-outbox-timeline",
"dms-outbox-timeline-scroll",{scroll_to_smoothing:0.5});scrollbar_threads=new Control.ScrollBar("threaded-timeline","threaded-timeline-scroll",{scroll_to_smoothing:0.5});tabs=new Control.Tabs("tabbed",{defaultTab:"first",afterChange:function(a){current_tab=a.id;switch(a.id){case "dms-inbox-timeline-container":case "dms-outbox-timeline-container":$("new-tweet").hasClassName("tweet")&&$("new-tweet").removeClassName("tweet");$("new-tweet").hasClassName("dm")||$("new-tweet").addClassName("dm");$("new-dm-user").appear();
break;case "home-timeline-container":case "mentions-timeline-container":case "threaded-timeline-container":$("new-tweet").hasClassName("dm")&&$("new-tweet").removeClassName("dm");$("new-tweet").hasClassName("tweet")||$("new-tweet").addClassName("tweet");$("new-dm-user").fade().clear()}if(a.id!="threaded-timeline"){$("threaded-timeline").update();latest_threaded_id=0}z_engine_timeline_recalculate_layouts();z_engine_tweet_recalculate_layouts()}})}
function z_engine_ui_events(){new Event.observe("new-tweet","keyup",function(){z_engine_input()});new Event.observe("new-tweet","keydown",function(){z_engine_input()});new Event.observe("new-tweet-form","submit",function(a){Event.stop(a);z_engine_send_tweet()});new Event.observe("pause","click",function(a){Event.stop(a);z_engine_tweet_pause()});new Event.observe(window,"resize",function(){z_engine_tweet_recalculate_layouts();z_engine_timeline_recalculate_layouts()})}
function z_engine_unfavorite(a){a=z_engine_reset_id(a);z_engine_handle_emitter("favorite",{action:"undo",id_str:a});if($("fave-"+a)){$("fave-"+a).writeAttribute("title",translation.favorite);$("fave-"+a).writeAttribute("src","/img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("title",translation.favorite);$("fave-"+a+"-mentioned").writeAttribute("src","/img/fav.png");$("fave-"+a+"-mentioned").writeAttribute("onclick",
"z_engine_favorite('"+a+"');")}if($("fave-"+a+"-threaded")){$("fave-"+a+"-threaded").writeAttribute("title",translation.favorite);$("fave-"+a+"-threaded").writeAttribute("src","/img/fav.png");$("fave-"+a+"-threaded").writeAttribute("onclick","z_engine_favorite('"+a+"');")}}
function z_engine_unretweet(a,b){if($("rt-"+a)){$("rt-"+a).writeAttribute("title",translation.unretweet);$("rt-"+a).writeAttribute("src","/img/rtd.png");$("rt-"+a).writeAttribute("onclick","z_engine_destroy('"+b+"','rt');")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").writeAttribute("title",translation.unretweet);$("rt-"+a+"-mentioned").writeAttribute("src","/img/rtd.png");$("rt-"+a+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+b+"','rt');")}if($("rt-"+a+"-threaded")){$("rt-"+
a+"-threaded").writeAttribute("title",translation.unretweet);$("rt-"+a+"-threaded").writeAttribute("src","/img/rtd.png");$("rt-"+a+"-threaded").writeAttribute("onclick","z_engine_destroy('"+b+"','rt');")}}function z_engine_update_relative_time(a){a=$$(a);a.length>0&&a.each(function(b){var c=b.readAttribute("datetime");b.update(relative_time(c))})};
