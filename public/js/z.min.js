var audio=new Audio;audio.src=BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?"/audio/notify.mp3":"/audio/notify.ogg";store.get("client_blocks")||store.set("client_blocks","");store.set("connect_id",CONNECT_SID);var content=[],content_queued=[],dms_cutoff=50,dms_loaded=0,dm_to=false,following=[],geo_high_accuracy=false,geo_timeout=12E3;store.get("hashtag_blocks")||store.set("hashtag_blocks","");var home_cutoff=150,ids=[],latit=false,longit=false;
if(S2.Extensions.HardwareAcceleratedCSSTransitions)var max_fpx=120;else var max_fps=30;var mentions_cutoff=100,paused=false,pttid=0,prune_tweets_interval=6E4,reply_id=false,screen_name="",socket=io.connectWithSession(),stream_queue_interval=1500,tid=0,ttid=0,update_relative_dms_interval=6E4,update_relative_home_interval=15E3,update_relative_mentions_interval=3E4,user_id=0;store.get("user_blocks")||store.set("user_blocks","");store.get("users")||store.set("users","");
var window_height=document.viewport.getDimensions().height-Number(30),window_width=document.viewport.getDimensions().width-Number(30);new S2.FX.Base({fps:max_fps});z_engine_attrition();
function z_engine_attrition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(z_engine_get_geolocation,z_engine_geolocation_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout});window.webkitNotifications&&window.webkitNotifications.checkPermission()==1&&window.webkitNotifications.requestPermission();if(window.File&&window.FileReader&&window.FileList&&window.Blob){var a=$("container"),c=$("image");c.show();a.ondragover=function(b){b.preventDefault();return false};
a.ondragend=function(b){b.preventDefault();return false};a.ondrop=function(b){b.preventDefault();b=b.dataTransfer.files[0];var d=new FileReader;d.onload=function(e){$(document.body).setStyle("background-url('"+e.target.result+"'); repeat left top;")};d.readAsDataURL(b);return false};c.ondragover=function(b){b.preventDefault();c.setStyle("border-color: #aaa;");return false};c.ondragend=function(b){b.preventDefault();c.setStyle("border-color: #ddd;");return false};c.ondrop=function(b){b.preventDefault();
z_engine_dropped_image(b.dataTransfer.files[0]);return false};c.addTip("drag and drop images here!",{className:"user",showOn:"click",target:true})}$("container").setStyle("width: "+window_width+"px; height: "+window_height+"px;");$("loading-home").center(8);$("loading-mentions").center(8);$("loading-inbox").center(8);$("loading-outbox").center(8);new Event.observe("logout","click",function(b){Event.stop(b);return z_engine_logout()});new Event.observe("pause","click",function(b){Event.stop(b);return z_engine_tweet_pause()});
new Event.observe("shorten","click",function(b){Event.stop(b);return z_engine_shorten_urls()});new Event.observe("new-tweet","keyup",function(){if($("new-tweet").getValue().length===0)reply_id=dm_to=false;else if($("new-tweet").getValue().length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")});new Event.observe("new-tweet","keydown",function(){if($("new-tweet").getValue().length===0)reply_id=false;else if($("new-tweet").getValue().length<=
140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")});socket.on("connect",function(){$("new-tweet").setValue("connected...")});socket.on("message",function(b){var d=JSON.stringify(b);if(d.isJSON()&&d.evalJSON(true)){d="";if(b.loaded){$("new-tweet").setValue("");$("new-tweet").enable();new Event.observe("new-tweet-form","submit",function(h){Event.stop(h);z_engine_send_tweet()});z_engine_clicker("home-timeline-click","home-timeline");
z_engine_clicker("mentions-timeline-click","mentions-timeline");z_engine_clicker("dms-timeline-click","dms-timeline");z_engine_clicker_dms("dms-inbox-timeline-click","dms-inbox-timeline");z_engine_clicker_dms("dms-outbox-timeline-click","dms-outbox-timeline");socket.emit("message",{fetch:"home"});setTimeout(function(){socket.emit("message",{fetch:"mentions"})},1E4);setTimeout(function(){socket.emit("message",{fetch:"dms-inbox"})},2E4);setTimeout(function(){socket.emit("message",{fetch:"dms-outbox"})},
3E4);setInterval(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval);setInterval(function(){z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval);setInterval(function(){z_engine_update_relative_time("time.dms")},update_relative_dms_interval);setInterval(function(){paused||z_engine_prune_tweets()},prune_tweets_interval);setInterval(function(){paused||z_engine_stream_queue()},stream_queue_interval)}else if(b.account)store.set("account",
b.account);else if(b["delete"]){var e=typeof b["delete"].status=="object"?b["delete"].status.id_str:0;z_engine_drop_tweet(e)}else if(b.direct_message){z_engine_tweet(b.direct_message,"dms");b.direct_message.sender.screen_name!=screen_name&&z_engine_notification(b.direct_message.sender.profile_image_url,"@"+b.direct_message.sender.screen_name+" sent a direct message",b.direct_message.text)}else if(b.dms){dms_loaded++;b.dms.each(function(h){z_engine_tweet(h,"dms")});switch(dms_loaded){case 1:$("loading-inbox").fade();
$("loading-outbox").appear();break;case 2:$("loading-outbox").fade()}}else if(b.event)switch(b.event){case "block":e=$w(store.get("user_blocks")).uniq();var j=false;e.each(function(h){if(h==b.target.screen_name)j=true});if(!j){d=b.target.screen_name;e=e.join(" ")+" "+d;store.set("user_blocks",e)}break;case "unblock":e=$w(store.get("user_blocks")).uniq();var f="";e.each(function(h){if(h!=b.target.screen_name)f+=h+" "});store.set("user_blocks",f);break;case "favorite":b.source.screen_name!=screen_name&&
z_engine_notification(b.source.profile_image_url,"@"+b.source.screen_name+" faved your tweet!",b.target_object.text);break;case "unfavorite":break;case "follow":b.source.screen_name!=screen_name&&z_engine_notification(b.source.profile_image_url,"@"+b.source.screen_name+" is following you!",b.source.description);break;case "list_member_added":b.source.screen_name!=screen_name&&z_engine_notification(b.source.profile_image_url,"@"+b.source.screen_name+" put you in "+b.target_object.full_name+"!",b.target_object.description);
break;case "list_created":break;case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":b.source.screen_name!=screen_name&&z_engine_notification(b.source.profile_image_url,"@"+b.source.screen_name+" subscribed to "+b.target_object.full_name+"!",b.target_object.description);break;case "list_user_unsubscribed":break;case "scrub_geo":break;case "user_update":break;default:console.log(JSON.stringify(b.event));console.log(JSON.stringify(b))}else if(b.friends){e=
b.friends.join(" ");store.set("friends",e)}else if(b.home){b.home.each(function(h){z_engine_tweet(h,"home")});socket.emit("message",{fetch:"userstream"});$("loading-home").fade();$("loading-mentions").appear()}else if(b.imgur){if(b.imgur!="error"){d=b.imgur.upload.links.original;var i=$("new-tweet").getValue();if(i.length>0)e=i+" "+d;else if(i.length==0)e=d;$("new-tweet").setValue(e);$("image").setStyle("border-color: green;")}else $("image").setStyle("border-color: red;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},
1500)}else if(b.info){screen_name=b.info.screen_name;user_id=b.info.user_id;store.set("screen_name",screen_name);store.set("user_id",user_id)}else if(b.klout){d=b.klout;e=b.id_str;if(d!="error"||d.status!=200)z_engine_set_klout(d.users,e);else if($("klout-"+e)){$("klout-"+e).setStyle("cursor: default;");$("klout-"+e).setAttribute("onclick","");$("klout-"+e).addTip("<big><strong>?</strong></big>",{className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]})}}else if(b.mentions){b.mentions.each(function(h){z_engine_tweet(h,
"mentions")});$("loading-mentions").fade();$("loading-inbox").appear()}else if(b.retweet_info){d=b.retweet_info;if($("comment-"+d.retweeted_status.id_str)){if($("rt-"+d.retweeted_status.id_str)){$("rt-"+d.retweeted_status.id_str).writeAttribute("src","img/rtd.png");$("rt-"+d.retweeted_status.id_str).writeAttribute("onclick","z_engine_destroy('"+d.retweeted_status.id_str+"','rt');")}if($("rt-"+d.retweeted_status.id_str+"-mentioned")){$("rt-"+d.retweeted_status.id_str+"-mentioned").writeAttribute("src",
"img/rtd.png");$("rt-"+d.retweeted_status.id_str+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+d.retweeted_status.id_str+"','rt');")}}}else if(b.server_event){console.log(JSON.stringify(b));switch(b.server_event){case "end":z_engine_notification("","notice!","lost connection to the userstream, reconnecting...");socket.disconnect();socket.connect();$("new-tweet").enable();socket.emit({fetch:"userstream"});break;case "error":z_engine_notification("","notice!","userstream error occurred, reconnecting...");
socket.disconnect();socket.connect();$("new-tweet").enable()}}else if(b.shorten){console.log(JSON.stringify(b.shorten));i=$("new-tweet").getValue().replace(b.original,b.shorten);$("new-tweet").setValue(i)}else if(b.text&&b.user&&b.created_at){content_queued.push(JSON.stringify(b));if(paused){$("paused-count").update("("+pttid+")");pttid++}b.retweeted_status&&b.retweeted_status.user.screen_name==screen_name&&b.user.screen_name!=screen_name&&z_engine_notification(b.user.profile_image_url,"@"+b.user.screen_name+
" retweeted you!",b.retweeted_status.text)}}else if(d.isJSON())d.evalJSON(true)?console.log("unknown error, output: "+d):console.log("json could not be properly evaluated, skipping");else console.log("not json, skipping")});socket.on("disconnect",function(){$("new-tweet").disable()})}
function z_engine_clicker(a,c){new Event.observe(a,"click",function(b){Event.stop(b);if(c=="dms-timeline")new S2.FX.Parallel([new Effect.Fade("dms-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Appear("dms-inbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"}),new Effect.Appear("dms-outbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"})],{duration:1});else if($("dms-inbox-timeline-click").visible()||$("dms-outbox-timeline-click").visible())new S2.FX.Parallel([new Effect.Fade("dms-outbox-timeline-click",
{duration:0.15,mode:"relative"}),new Effect.Fade("dms-inbox-timeline-click",{duration:0.15,mode:"relative"}),new Effect.Appear("dms-timeline-click",{delay:0.15,duration:0.25,mode:"relative"})],{duration:1});if(!$(c).visible()){if($("home-timeline").visible())var d="home-timeline";else if($("mentions-timeline").visible())d="mentions-timeline";else if($("dms-timeline").visible())d="dms-timeline";new S2.FX.Parallel([new Effect.Fade(d,{duration:0.4,mode:"relative"}),new Effect.Appear(c,{delay:0.35,duration:0.4,
mode:"relative"})],{duration:1})}})}function z_engine_clicker_dms(a,c){new Event.observe(a,"click",function(b){Event.stop(b);if(!$(c).visible()){if($("dms-outbox-timeline").visible())var d="dms-outbox-timeline";else if($("dms-inbox-timeline").visible())d="dms-inbox-timeline";new S2.FX.Parallel([new Effect.Fade(d,{duration:0.4,mode:"relative"}),new Effect.Appear(c,{delay:0.35,duration:0.4,mode:"relative"})],{duration:1})}})}
function z_engine_destroy(a,c){if(confirm("\nare you sure you want to delete this?\n")){if(c=="tweet"||c=="rt")var b={destroy:{status:{id_str:a}}};else if(c=="dm"){b={destroy_dm:{status:{id_str:a}}};z_engine_drop_tweet(a)}if(c=="rt"){if($("rt-"+a)){$("rt-"+a).setAttribute("src","img/rt.png");$("rt-"+a).setAttribute("onclick","z_engine_retweet('"+a+"');")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").setAttribute("src","img/rt.png");$("rt-"+a+"-mentioned").setAttribute("onclick","z_engine_retweet('"+
a+"');")}}socket.emit("message",b)}}
function z_engine_drop_tweet(a){if($("comment-"+a)){$("comment-"+a).setStyle("text-decoration: line-through;");$("del-"+a)&&$("del-"+a).fade();$("fave-"+a)&&$("fave-"+a).fade();$("reply-"+a)&&$("reply-"+a).fade();$("rt-"+a)&&$("rt-"+a).fade();setTimeout(function(){new S2.FX.Parallel([new Effect.Fade("comment-"+a,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp("comment-"+a,{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5})},3E3)}if($("comment-"+a+"-mentioned")){$("del-"+
a+"-mentioned")&&$("del-"+a+"-mentioned").fade();$("fave-"+a+"-mentioned")&&$("fave-"+a+"-mentioned").fade();$("reply-"+a+"-mentioned")&&$("reply-"+a+"-mentioned").fade();$("rt-"+a+"-mentioned")&&$("rt-"+a+"-mentioned").fade();setTimeout(function(){new S2.FX.Parallel([new Effect.Fade("comment-"+a+"-mentioned",{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp("comment-"+a+"-mentioned",{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5})},3E3)}}
function z_engine_dropped_image(a){var c=new FormData;c.append("image",a);c.append("key",imgur_key);a=new XMLHttpRequest;a.onreadystatechange=function(){this.readyState==3&&$("image").setStyle("border-color: yellow;");if(this.readyState==4&&this.status==200){var b=this.responseText.evalJSON(true).upload.links.original,d=$("new-tweet").getValue();if(d.length>0)var e=d+" "+b;else if(d.length==0)e=b;$("new-tweet").setValue(e);$("image").setStyle("border-color: green;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},
1500)}if(this.readyState==4&&this.status!=200){$("image").setStyle("border-color: red;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},1500)}};a.open("POST","http://api.imgur.com/2/upload.json",true);a.send(c)}
function z_engine_favorite(a){socket.emit("message",{favorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/favd.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}}function z_engine_get_geolocation(a){latit=a.coords.latitude;longit=a.coords.longitude}
function z_engine_geolocation_error(a){switch(a.code){case 0:case 1:case 2:case 3:longit=latit=false}}function z_engine_get_klout(a,c){socket.emit("message",{fetch:"klout",screen_name:a,id_str:c})}function z_engine_logout(){socket.disconnect();$("new-tweet").disable();$("new-tweet").setValue("see ya!");store.remove("account");store.remove("friends");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}
function z_engine_notification(a,c,b){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE")audio.play();if(b==null)b="";if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var d=window.webkitNotifications.createNotification(a,c,b);d.show();setTimeout(function(){d.cancel()},5E3)}else if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission();growler.growl(z_engine_parse_tweet(c),
z_engine_parse_tweet(b))}else if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2)growler.growl(z_engine_parse_tweet(c),z_engine_parse_tweet(b))}function z_engine_parse_tweet(a){if(a){a=twttr.txt.autoLink(a);a=a.replace(/\n\r?/g,"<br />")}return a}
function z_engine_prune_tweets(){$("home-timeline").childElements().each(function(a,c){c>home_cutoff&&$(a).remove()});setTimeout(function(){$("mentions-timeline").childElements().each(function(a,c){c>mentions_cutoff&&$(a).remove()})},15E3);setTimeout(function(){$("dms-inbox-timeline").childElements().each(function(a,c){c>dms_cutoff&&$(a).remove()})},3E4);setTimeout(function(){$("dms-outbox-timeline").childElements().each(function(a,c){c>dms_cutoff&&$(a).remove()})},45E3)}
function z_engine_reply(a,c,b){reply_id=c;$("new-tweet").setValue("@"+a+" "+b);$("new-tweet").focus()}function z_engine_reply_dm(a){dm_to=a;$("new-tweet").setValue("~");$("new-tweet").focus()}function z_engine_retweet(a,c,b){if(confirm("\nare you sure you want to retweet this?\n"))if(confirm("ok for normal retweet\ncancel for commented retweet"))socket.emit("message",{retweet:{status:{id_str:a}}});else{reply_id=a;$("new-tweet").setValue("RT @"+c+" "+b);$("new-tweet").focus()}}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();var a=$("new-tweet").getValue().strip(),c=new Hash;if(dm_to){a.startsWith("~")&&a.replace(/~/i,"");c={direct_message:{text:a,user_id:dm_to}}}else{c={status:{status:a,include_entities:true}};latit&&longit&&new Object.extend(c.status,{display_coordinates:true,lat:latit,"long":longit});reply_id&&new Object.extend(c.status,{in_reply_to_status_id:reply_id})}socket.emit("message",
c);dm_to=reply_id=false;$("new-tweet").setValue("");$("new-tweet").enable()}}
function z_engine_set_klout(a,c){if(typeof a==="object")if(a.length>0&&typeof c=="string"){var b=Math.round(a[0].score.network_score),d=Math.round(a[0].score.true_reach),e="score: <strong>"+Math.round(a[0].score.kscore)+"</strong><br />";e+="amp: <strong>"+Math.round(a[0].score.amplification_score)+"</strong><br />";e+="network: <strong>"+b+"</strong><br />";e+="reach: <strong>"+d+"</strong><br />";if($("klout-"+c)){$("klout-"+c).addTip(e,{className:"klout",stem:true,target:true,targetJoint:["left",
"top"],tipJoint:["right","bottom"]});$("klout-"+c).setAttribute("src","img/kltd.png");$("klout-"+c).setAttribute("title","")}if($("klout-"+c+"-mentioned")){$("klout-"+c+"-mentioned").addTip(e,{className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]});$("klout-"+c+"-mentioned").setAttribute("src","img/kltd.png");$("klout-"+c+"-mentioned").setAttribute("title","")}}}
function z_engine_shorten_urls(){$("new-tweet").getValue().replace(/((https?\:\/\/)|(www\.))([^ ]+)/g,function(a){socket.emit("message",{shorten:a})})}function z_engine_stream_queue(){if(content_queued.length>0){var a=content_queued.shift();if(typeof a!=="undefined")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"home")}}}
function z_engine_tweet(a,c){if(c!="dms")if(a.retweeted_status){b=a.retweeted_status.user.screen_name;d=a.user.screen_name;e=a.retweeted_status.user.profile_image_url;j=(new Date(a.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");f=a.retweeted_status.user.description;i=a.retweeted_status.entities;h=a.retweeted_status.favorited;w=a.retweeted_status.user.followers_count;p=a.retweeted_status.user.friends_count;g=a.retweeted_status.id_str;k=a.retweeted_status.user.location;A=a.retweeted_status.user["protected"];
q=a.retweeted_status.place;l=a.retweeted_status.in_reply_to_screen_name;o=a.retweeted_status.in_reply_to_status_id_str;n=true;D=a.retweeted_status.source.stripTags();x=a.retweeted_status.text;y=a.retweeted_status.user.statuses_count;B=a.retweeted_status.user.id;r=a.retweeted_status.user.verified}else var b=a.user.screen_name,d=false,e=a.user.profile_image_url,j=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,""),f=a.user.description,i=a.entities,h=a.favorited,w=a.user.followers_count,p=
a.user.friends_count,g=a.id_str,k=a.user.location,A=a.user["protected"],q=a.place,l=a.in_reply_to_screen_name,o=a.in_reply_to_status_id_str,n=false,D=a.source.stripTags(),x=a.text,y=a.user.statuses_count,B=a.user.id,r=a.user.verified;else{b=a.sender.screen_name;e=a.sender.profile_image_url;j=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");f=a.sender.description;i=false;w=a.sender.followers_count;p=a.sender.friends_count;g=a.id_str;k=a.sender.location;A=false;l=a.recipient.screen_name;
n=false;x=a.text;y=a.sender.statuses_count;B=a.sender_id;r=a.sender.verified}var G=false,H=false,I=false,J=false;c!="dms"&&$w(store.get("client_blocks")).uniq().each(function(u){if(u==D)G=true});if(i){typeof i.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(u){i.hashtags.uniq().each(function(E){if(u==E)H=true})});typeof i.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(u){i.user_mentions.uniq().each(function(E){if(u==E)I=true})})}$w(store.get("user_blocks")).uniq().each(function(u){if(u==
b)J=true});if(!content[g]&&!G&&!H&&!I&&!J){var v="";if(f!=null)v+=f+"<br /><br />";if(k!=null)v+="location: "+k+"<br />";v+="tweets: <strong>"+y+"</strong><br />";v+="following: <strong>"+p+"</strong><br />";v+="followers: <strong>"+w+"</strong>";ids[tid]=g;content[g]=true;var C=new Element("br");if(i){p=z_engine_tweet_mentioned(i);f=z_engine_tweet_mentioned_string(i)}else f=p=false;k=new Element("li",{id:"comment-"+g,"class":"comment-parent",style:"display: none; opacity: 0;"});y=new Element("div",
{"class":"comment-profile-wrapper left"});var z=new Element("div",{"class":"comment-gravatar"}),s=new Element("a",{target:"_blank",href:"http://twitter.com/"+b});w=new Element("img",{id:"av-"+g,src:e,style:"height: 50px; width: 50px; cursor: pointer;",alt:""});s.insert(w);z.insert(s);y.insert(z);z=new Element("div",{id:"comment-"+g+"content","class":"comment-content-wrapper right"});s=b!=screen_name?p?new Element("div",{"class":"comment-body-mentioned"}):new Element("div",{"class":"comment-body"}):
new Element("div",{"class":"comment-body-me"});var m=new Element("div",{"class":"comment-arrow"});s.insert(m);var t=new Element("div",{"class":"post-date"});m=new Element("div",{"class":"left",id:"left-"+g});var K=new Element("a",{target:"_blank",href:"http://twitter.com/"+b});K.update("@"+b+" ");var L=new Element("span");L.update("wrote this ");if(c!="dms")var M=new Element("a",{target:"_blank",id:"comment-"+g+"-relative-date",href:"http://twitter.com/"+b+"/status/"+g});var F=new Element("time",
{datetime:j,"class":c});F.update(relative_time(j));c!="dms"&&M.insert(F);m.insert(K);m.insert({bottom:L});if(c!="dms"){m.insert({bottom:M});if(o){j=new Element("span");j.update(" in reply to ");o=new Element("a",{target:"_blank",href:"http://twitter.com/"+l+"/status/"+o});o.update(l+" ");m.insert(j);m.insert({bottom:o})}l=new Element("span",{"class":"via"});l.update(" via "+D);m.insert({bottom:l})}else{m.insert({bottom:F});if(l){j=new Element("span");j.update(" in reply to ");o=new Element("a",{target:"_blank",
href:"http://twitter.com/"+l});o.update(l+" ");m.insert(j);m.insert({bottom:o})}}if(r){r=new Element("span");r.update(" ");l=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});r.insert({bottom:l});m.insert({bottom:r})}t.insert(m);r=new Element("div",{"class":"right"});if(n){n=new Element("span",{"class":"rtd"});n.update(" ");l=new Element("img",{src:"img/rtd2.png",alt:""});o=new Element("a",{target:"_blank",href:"http://twitter.com/"+d});o.update(d);n.insert({top:l});n.insert({bottom:o});
r.insert({bottom:n})}if(c!="dms"&&q&&q.full_name){d=new Element("span",{"class":"place"});q=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+q.full_name});n=new Element("img",{src:"img/plc.png",alt:""});q.update(n);d.update(q);r.insert({bottom:d})}t.insert({bottom:r});s.insert({bottom:t});d=new Element("div",{"class":"clearer"});d.update("&nbsp;");s.insert({bottom:d});n=new Element("div",{"class":"comment-text"});t=new Element("p",{id:"comment-"+g+"-text"});q=new Element("div",{id:"right-"+
g,"class":"right"});t.insert(C);t.insert({bottom:q});C=new Element("div",{id:"text-"+g});C.update(z_engine_parse_tweet(x));t.insert({bottom:C});n.insert(t);s.insert({bottom:n});z.insert(s);k.insert(y);k.insert({bottom:z});k.insert({bottom:d});new Element.extend(q);new Element.extend(k);switch(c){case "dms":if(b!=screen_name)$("dms-inbox-timeline").insert({top:k});else b==screen_name&&$("dms-outbox-timeline").insert({top:k});break;case "mentions":$("mentions-timeline").insert({bottom:k});break;case "home":$("home-timeline").insert({top:k})}if(p&&
c!="mentions"&&b!=screen_name&&!a.retweeted_status){p=cloneNodeWithEvents(k);p.setAttribute("id","comment-"+g+"-mentioned");m.setAttribute("id","left-"+g+"-mentioned");q.setAttribute("id","right-"+g+"-mentioned");w.setAttribute("id","av-"+g+"-mentioned");z_engine_tweet_buttons("mentions",g,b,B,x,A,h,f,v);new Element.extend(p);$("mentions-timeline").insert({top:p});z_engine_notification(e,"@"+b+" mentioned you!",x);new S2.FX.Parallel([new Effect.Appear("comment-"+g+"-mentioned",{duration:1.25,mode:"relative",
transition:"easeOutSine"}),new Effect.BlindDown("comment-"+g+"-mentioned",{duration:0.7,mode:"relative",transition:"easeOutSine"})],{duration:1.5})}z_engine_tweet_buttons(c,g,b,B,x,A,h,f,v);new S2.FX.Parallel([new Effect.Appear("comment-"+g,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindDown("comment-"+g,{duration:0.7,mode:"relative",transition:"easeOutSine"})],{duration:1.5})}tid++}
function z_engine_tweet_buttons(a,c,b,d,e,j,f,i,h){switch(a){case "home":if(b!=screen_name){a=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+b+'", "'+c+'", "'+i+'");',id:"reply-"+c,alt:""});if(j)e=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{e=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+c+'", "'+b+'", "'+escape_string(e)+'");',id:"rt-"+c,alt:""});new Element.extend(e)}f=f?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+
c+'");',id:"fave-"+c,alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+c+'");',id:"fave-"+c,alt:""});new Element.extend(a);new Element.extend(f);$("right-"+c).insert(a);$("right-"+c).insert({bottom:e});$("right-"+c).insert({bottom:f})}else{f=new Element("img",{onclick:'z_engine_destroy("'+c+'", "tweet");',src:"img/del.png",id:"del-"+c,alt:""});$("right-"+c).insert({bottom:f});new Element.extend(f)}if(!$("klout-"+c)){f=new Element("span",{"class":"klout"});f.update(" ");b=
new Element("img",{onclick:'z_engine_get_klout("'+b+'", "'+c+'");',src:"img/klt.png",id:"klout-"+c,alt:"",title:"click to get this users klout score"});f.insert({top:b});$("left-"+c).insert({top:f});new Element.extend(b)}$("av-"+c)&&$("av-"+c).addTip(h,{className:"user",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]});break;case "mentions":if(b!=screen_name){a=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+b+'", "'+c+'-mentioned", "'+
i+'");',id:"reply-"+c+"-mentioned",alt:""});if(j)e=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{e=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+c+'", "'+b+'", "'+escape_string(e)+'");',id:"rt-"+c+"-mentioned",alt:""});new Element.extend(e)}f=f?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+c+'");',id:"fave-"+c+"-mentioned",alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+c+'");',id:"fave-"+c+"-mentioned",
alt:""});new Element.extend(a);new Element.extend(f);if($("right-"+c)){$("right-"+c).insert(a);$("right-"+c).insert({bottom:e});$("right-"+c).insert({bottom:f})}if($("right-"+c+"-mentioned")){$("right-"+c+"-mentioned").insert(a);$("right-"+c+"-mentioned").insert({bottom:e});$("right-"+c+"-mentioned").insert({bottom:f})}}else{f=new Element("img",{onclick:'z_engine_destroy("'+c+'", "tweet");',src:"img/del.png",id:"del-"+c+"-mentioned",alt:""});$("right-"+c)&&$("right-"+c).insert({bottom:f});$("right-"+
c+"-mentioned")&&$("right-"+c+"-mentioned").insert({bottom:f});new Element.extend(f)}$("av-"+c)&&$("av-"+c).addTip(h,{className:"user",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]});$("av-"+c+"-mentioned")&&$("av-"+c+"-mentioned").addTip(h,{className:"user",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]});break;case "dms":if(b!=screen_name){a=new Element("img",{onclick:'z_engine_reply_dm("'+d+'", "'+b+
'");',src:"img/rep.png",id:"reply-"+c,alt:""});new Element.extend(a);$("right-"+c).insert(a)}f=new Element("img",{onclick:'z_engine_destroy("'+c+'", "dm");',src:"img/del.png",id:"del-"+c,alt:""});new Element.extend(f);$("right-"+c).insert({bottom:f})}}function z_engine_tweet_mentioned(a){var c=false;a.user_mentions.each(function(b){if(b.screen_name==screen_name)c=true});return c}
function z_engine_tweet_mentioned_string(a){var c="";a.user_mentions.uniq().each(function(b){if(b.screen_name!=screen_name)c+="@"+b.screen_name+" "});return c}function z_engine_tweet_pause(){if(paused){paused=false;$("paused-count").fade();$("paused-count").update("(0)");$("pause").update("pause");pttid=0}else{paused=true;$("pause").update("unpause");$("paused-count").appear()}}
function z_engine_unfavorite(a){socket.emit("message",{unfavorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/fav.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_favorite('"+a+"');")}}
function z_engine_update_relative_time(a){$$(a).each(function(c){var b=c.getAttribute("datetime");c.update(relative_time(b))})};
