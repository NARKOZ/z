store.get("client_blocks")||store.set("client_blocks","");var check_ratelimit_interval=300,content_queued=[],content_rts_stored=[],content_stored=[],dms_cutoff=50,dms_loaded=0,following=[];store.get("geo")||store.set("geo","on");if(store.get("geo")=="on")var geo_high_accuracy=false,geo_refresh_interval=300,geo_timeout=120;store.get("hashtag_blocks")||store.set("hashtag_blocks","");var home_cutoff=200;store.get("klout")||store.set("klout","off");
var klout=[],kloutinfo_params={className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]};store.get("lang")||store.set("lang","english");var latest_threaded_id=0,latitude=false,loaded=false,longitude=false,max_file_size=2;store.get("mention_blocks")||store.set("mention_blocks","");var mentions_cutoff=100;store.get("notifications")||store.set("notifications","on");store.get("notifications_timeout")||store.set("notifications_timeout",5);
var paused=false,previous_tab="",progress_bar="",prune_tweets_interval=60,pttid=0,rates=350,remember_cutoff=199,reply_id=false,screen_name="",shortened=false,socket="",stream_queue_interval="";store.get("sound")||store.set("sound","on");store.get("sound-src")||(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?store.set("sound_src","/audio/notify.mp3"):store.set("sound_src","/audio/notify.ogg"));
if(store.get("sound")=="on"&&store.get("sound_src").length>0){var audio=new Audio;audio.src=store.get("sound_src")}store.get("stream_interval")||store.set("stream_interval",1.5);var tabs="",threaded_cutoff=50,translation="",update_relative_dms_interval=60,update_relative_home_interval=15,update_relative_mentions_interval=30,user_id=0,userinfo_params={className:"user",hideDelay:3,hideOn:"mouseout",showOn:"click",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]};
store.get("user_blocks")||store.set("user_blocks","");store.get("users")||store.set("users","");
function z_engine_attrition(){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>=3||BrowserDetect.browser=="Chrome"||BrowserDetect.browser=="Opera"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"){socket=io.connectWithSession();if(!loaded){z_engine_get_language();new Event.observe("logout","click",function(a){Event.stop(a);z_engine_logout()});$("loading-home").center(8);$("loading-mentions").center(8);$("loading-inbox").center(8);
$("loading-outbox").center(8)}socket.on("connect",function(){loaded||$("new-tweet").setValue("connected...")});socket.on("delete",function(a){typeof a.status=="object"&&z_engine_drop_tweet(a.status.id_str)});socket.on("direct_message",function(a){z_engine_tweet(a,"dms top");a.sender.screen_name!=screen_name&&z_engine_notification(a.sender.profile_image_url,"@"+a.sender.screen_name+" sent a direct message",a.text)});socket.on("dms",function(a){dms_loaded++;a.each(function(b){z_engine_tweet(b,"dms bottom")});
switch(dms_loaded){case 1:$("loading-inbox").fade();$("loading-outbox").appear();break;case 2:$("loading-outbox").fade()}rates--});socket.on("event",function(a){switch(a.event){case "block":var b=$w(store.get("mention_blocks")).uniq().strip(),c=$w(store.get("user_blocks")).uniq().strip(),g=false,f=false;b.each(function(i){if(i==a.target.screen_name)g=true});c.each(function(i){if(i==a.target.screen_name)f=true});g||store.set("mention_blocks",current_blocks.join(" ")+" "+a.target.screen_name);f||store.set("user_blocks",
current_blocks.join(" ")+" "+a.target.screen_name);break;case "unblock":b=$w(store.get("user_blocks")).uniq().strip();c=$w(store.get("user_blocks")).uniq().strip();var e="",j="";b.each(function(i){if(i!=a.target.screen_name)e+=i+" "});c.each(function(i){if(i!=a.target.screen_name)j+=i+" "});store.set("mention_blocks",e);store.set("user_blocks",j);break;case "favorite":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.target_object.text;var d="@"+a.source.screen_name+" faved your tweet!";
z_engine_notification(b,d,c)}break;case "unfavorite":break;case "follow":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.source.description;d="@"+a.source.screen_name+" is following you!";z_engine_notification(b,d,c)}break;case "list_member_added":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.target_object.description;d="@"+a.source.screen_name+" put you in "+a.target_object.full_name+"!";z_engine_notification(b,d,c)}break;case "list_created":break;
case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":if(a.source.screen_name!=screen_name){b=a.source.profile_image_url;c=a.target_object.description;d="@"+a.source.screen_name+" subscribed to "+a.target_object.full_name+"!";z_engine_notification(b,d,c)}break;case "list_user_unsubscribed":break;case "scrub_geo":break;case "user_update":break;default:console.log(JSON.stringify(a.event));console.log(JSON.stringify(a))}});socket.on("friends",
function(a){a=a.join(" ");store.set("friends",a)});socket.on("home",function(a){a.each(function(b){z_engine_tweet(b,"home bottom")});$("loading-home").fade();$("loading-mentions").appear();rates--;z_engine_fetch_timeline("userstream")});socket.on("info",function(a){screen_name=a.screen_name;user_id=a.user_id;store.set("screen_name",a.screen_name);store.set("user_id",user_id)});socket.on("klout",function(a){if(store.get("klout")=="on"){var b=a.klout;a=a.id_str;if(b!="error"){z_engine_set_klout(b.users,
a);klout[b.users[0].twitter_id]=JSON.stringify(b.users)}else if($("klout-"+a)){$("klout-"+a).setStyle("cursor: default;");$("klout-"+a).writeAttribute("onclick","");$("klout-"+a).addTip("<big><strong>?</strong></big>",kloutinfo_params)}}});socket.on("loaded",function(){loaded=true;$("new-tweet").setValue("");$("new-tweet").enable();z_engine_check_ratelimit();z_engine_fetch_timeline("home");z_engine_fetch_timeline.delay(10,"mentions");z_engine_fetch_timeline.delay(20,"dms-inbox");z_engine_fetch_timeline.delay(30,
"dms-outbox");new PeriodicalExecuter(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.dms")},update_relative_dms_interval);new PeriodicalExecuter(function(){z_engine_update_relative_time("time.threaded")},update_relative_home_interval);new PeriodicalExecuter(function(){z_engine_check_ratelimit()},
check_ratelimit_interval);new PeriodicalExecuter(function(){paused||z_engine_prune_tweets()},prune_tweets_interval);stream_queue_interval=new PeriodicalExecuter(function(){paused||z_engine_stream_queue()},store.get("stream_interval"));store.get("geo")=="on"&&new PeriodicalExecuter(function(){z_engine_geo()},geo_refresh_interval);new PeriodicalExecuter(function(){z_engine_input()},1);var a=$w(store.get("users").strip()).uniq(),b="";a.each(function(c){b+=c.replace(/@/i,"")+" "});new Autocompleter.Local("new-tweet",
"autocompleter",a,{choices:20,minChars:2,tokens:" ",afterUpdateElement:function(){$("new-tweet").setValue($("new-tweet").getValue()+" ")}});new Autocompleter.Local("new-dm-user","autocompleter-dm",$w(b.strip()).uniq(),{choices:20,minChars:2});store.get("geo")=="on"&&new HotKey("l",function(){z_engine_geo()},{shiftKey:true});new HotKey("o",function(){z_engine_clear_timeline()},{shiftKey:true});new HotKey("p",function(){z_engine_tweet_pause()},{shiftKey:true});new HotKey("s",function(){z_engine_shorten_urls()},
{shiftKey:true});progress_bar=new Control.ProgressBar("progress-bar");new Control.Modal($(document.body).down("[href=#settings-div]"),{className:"window",closeOnClick:"overlay",fade:true,overlayOpacity:0.5});tabs=new Control.Tabs("tabbed",{beforechange:function(){previous_tab=z_engine_current_timeline()},afterChange:function(){var c=z_engine_current_timeline();switch(c){case "dms-inbox-timeline":case "dms-outbox-timeline":$("new-dm-user").appear();break;default:$("new-tweet").removeClassName("dm");
$("new-dm-user").fade().setValue("")}if(c!="threaded-timeline"){$("threaded-timeline").update();latest_threaded_id=0}}});tabs.first();new Event.observe("new-tweet","keyup",function(){z_engine_input()});new Event.observe("new-tweet","keydown",function(){z_engine_input()});new Event.observe("new-tweet-form","submit",function(c){Event.stop(c);z_engine_send_tweet()});new Event.observe("pause","click",function(c){Event.stop(c);z_engine_tweet_pause()});store.get("geo")=="on"&&z_engine_geo();z_engine_image_dropper();
z_engine_notification_setup();z_engine_settings_setup()});socket.on("mentions",function(a){a.each(function(b){z_engine_tweet(b,"mentions bottom")});$("loading-mentions").fade();$("loading-inbox").appear();rates--});socket.on("rates",function(a){rates=a.remaining_hits;a.remaining_hits<=10&&z_engine_notification("","notice!","you have "+a.remaining_hits+" (of "+a.hourly_limit+") request tokens left!")});socket.on("related",function(a){try{a.data.each(function(c){if(c.kind=="Tweet"){switch(c.annotations.ConversationRole){case "Ancestor":var g=
"bottom";break;case "Descendant":g="top";break;case "Fork":g="top"}z_engine_tweet(c.value,"threaded "+g)}else c.results.each(function(f){if(f.kind=="Tweet"){switch(f.annotations.ConversationRole){case "Ancestor":var e="bottom";break;case "Descendant":e="top";break;case "Fork":e="top"}z_engine_tweet(f.value,"threaded "+e)}})});content_stored[a.origin]&&z_engine_tweet(content_stored[a.origin].evalJSON(true),"threaded top")}catch(b){console.log(b)}rates--});socket.on("retweet_info",function(a){var b=
a.retweeted_status.id_str,c=a.id_str;content_rts_stored[b]=JSON.stringify(a);if($("rt-"+b)){$("rt-"+b).writeAttribute("title","undo retweet");$("rt-"+b).writeAttribute("src","img/rtd.png");$("rt-"+b).writeAttribute("onclick","z_engine_destroy('"+c+"','rt');")}if($("rt-"+b+"-mentioned")){$("rt-"+b+"-mentioned").writeAttribute("title","undo retweet");$("rt-"+b+"-mentioned").writeAttribute("src","img/rtd.png");$("rt-"+b+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+c+"','rt');")}if($("rt-"+
b+"-threaded")){$("rt-"+b+"-threaded").writeAttribute("title","undo retweet");$("rt-"+b+"-threaded").writeAttribute("src","img/rtd.png");$("rt-"+b+"-threaded").writeAttribute("onclick","z_engine_destroy('"+c+"','rt');")}});socket.on("server_error",function(a){switch(a.event){case "end":$("new-tweet").disable();z_engine_notification("","notice!","lost connection to the userstream, reconnecting...");break;case "error":$("new-tweet").disable();z_engine_notification("","notice!","error occurred, reconnecting...")}});
socket.on("shorten",function(a){$("new-tweet").setValue($("new-tweet").getValue().replace(a.original,a.shorten))});socket.on("show",function(a){content_stored[a.retweeted_status?a.retweeted_status.id_str:a.id_str]=JSON.stringify(a);z_engine_tweet(a,"threaded bottom");rates--});socket.on("tweet",function(a){if(a.retweeted_status&&a.retweeted_status.user.screen_name==screen_name&&a.user.screen_name!=screen_name){var b=a.retweeted_status.retweet_count-1;z_engine_notification(a.user.profile_image_url,
b>1?"@"+a.user.screen_name+" and "+b+" others rt'd you!":b==1?"@"+a.user.screen_name+" and 1 other rt'd you!":"@"+a.user.screen_name+" retweeted you!",a.retweeted_status.text)}else{content_queued.push(JSON.stringify(a));if(paused){$("paused-count").update("("+pttid+")");pttid++}}});socket.on("disconnect",function(){$("new-tweet").disable()})}else $("new-tweet").setValue("sorry, your browser may not support this client!")}function z_engine_check_ratelimit(){z_engine_fetch_timeline("rates")}
function z_engine_clear_timeline(){var a=z_engine_current_timeline();if(z_engine_css3()){$(a).addClassName("comment-parent-drop").removeClassName("comment-parent");$(a).update().appear().delay(0.5)}else new Effect.Fade(a,{duration:0.5,afterFinish:function(){$(a).update().appear()}})}
function z_engine_current_timeline(){if($("home-timeline").visible())return"home-timeline";else if($("mentions-timeline").visible())return"mentions-timeline";else if($("dms-inbox-timeline").visible())return"dms-inbox-timeline";if($("dms-outbox-timeline").visible())return"dms-outbox-timeline";else if($("threaded-timeline").visible())return"threaded-timeline"}
function z_engine_css3(){return BrowserDetect.browser=="Firefox"&&BrowserDetect.version<=5||BrowserDetect.browser!="Chrome"||BrowserDetect.browser!="Safari"?false:true}
function z_engine_destroy(a,b){if(confirm("\nare you sure you want to delete this?\n")){if(b=="tweet"||b=="rt")var c={action:"tweet",id_str:a};else if(b=="dm"){c={action:"dm",id_str:a};z_engine_drop_tweet(a)}b=="rt"&&content_rts_stored.each(function(g,f){var e=g.evalJSON(true);if(a==e.id_str){var j=e.retweeted_status.screen_name,d=e.screen_name,i=e.retweeted_status.entities,m=e.retweeted_status.favorited;a=e.retweeted_status.id_str;var h=e.retweeted_status.user["protected"],l=e.retweeted_status.text;
e=e.retweeted_status.user.id;i=i?z_engine_tweet_mentioned_string(i):false;content_rts_stored.splice(f,1);if($("rt-"+a)){$("rt-"+a).writeAttribute("title","retweet");$("rt-"+a).writeAttribute("src","img/rt.png");$("rt-"+a).writeAttribute("onclick","z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a,j,d,e,i,l,m,false,h,"home")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").writeAttribute("title","retweet");$("rt-"+a+"-mentioned").writeAttribute("src","img/rt.png");$("rt-"+a+"-mentioned").writeAttribute("onclick",
"z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a+"-mentioned",j,d,e,i,l,m,false,h,"mentions")}if($("rt-"+a+"-threaded")){$("rt-"+a+"-threaded").writeAttribute("title","retweet");$("rt-"+a+"-threaded").writeAttribute("src","img/rt.png");$("rt-"+a+"-threaded").writeAttribute("onclick","z_engine_retweet('"+a+"');");z_engine_tweet_right_click(a,"rt-"+a+"-threaded",j,d,e,i,l,m,false,h,"threads")}}});socket.emit("delete",c)}}
function z_engine_drop_tweet(a){if(content_stored[a]){var b=content_stored.indexOf(a);content_stored.splice(b,1)}if($("comment-"+a)){$("comment-"+a).setStyle("text-decoration: line-through;");$("del-"+a)&&$("del-"+a).fade();$("fave-"+a)&&$("fave-"+a).fade();$("reply-"+a)&&$("reply-"+a).fade();$("rt-"+a)&&$("rt-"+a).fade();z_engine_fade_up.delay(3,"comment-"+a)}if($("comment-"+a+"-mentioned")){$("del-"+a+"-mentioned")&&$("del-"+a+"-mentioned").fade();$("fave-"+a+"-mentioned")&&$("fave-"+a+"-mentioned").fade();
$("reply-"+a+"-mentioned")&&$("reply-"+a+"-mentioned").fade();$("rt-"+a+"-mentioned")&&$("rt-"+a+"-mentioned").fade();z_engine_fade_up.delay(3,"comment-"+a+"-mentioned")}if($("comment-"+a+"-threaded")){$("del-"+a+"-threaded")&&$("del-"+a+"-threaded").fade();$("fave-"+a+"-threaded")&&$("fave-"+a+"-threaded").fade();$("reply-"+a+"-threaded")&&$("reply-"+a+"-threaded").fade();$("rt-"+a+"-threaded")&&$("rt-"+a+"-threaded").fade();z_engine_fade_up.delay(3,"comment-"+a+"-threaded")}}
function z_engine_fade_down(a){if(!z_engine_css3()){$(a).setStyle("display: none;");new Effect.Appear(a,{duration:1,transition:Effect.Transitions.sinoidal})}}function z_engine_fade_up(a){if(z_engine_css3())$(a).addClassName("comment-parent-drop").removeClassName("comment-parent");else new Effect.Fade(a,{duration:1,transition:Effect.Transitions.sinoidal})}
function z_engine_favorite(a){socket.emit("favorite",{action:"do",id_str:a});if($("fave-"+a)){$("fave-"+a).writeAttribute("title","unfavorite");$("fave-"+a).writeAttribute("src","img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("title","unfavorite");$("fave-"+a+"-mentioned").writeAttribute("src","img/favd.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+
a+"-threaded")){$("fave-"+a+"-threaded").writeAttribute("title","unfavorite");$("fave-"+a+"-threaded").writeAttribute("src","img/favd.png");$("fave-"+a+"-threaded").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}}function z_engine_fetch_timeline(a){socket.emit("fetch",a)}
function z_engine_geo(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(z_engine_geo_set,z_engine_geo_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout*1E3});else if(google.loader.ClientLocation!=null){latitude=google.loader.ClientLocation.latitude;longitude=google.loader.ClientLocation.longitude}else longitude=latitude=false}
function z_engine_geo_error(a){switch(a.code){case 0:case 1:case 2:case 3:if(google.loader.ClientLocation!=null){latitude=google.loader.ClientLocation.latitude;longitude=google.loader.ClientLocation.longitude}else longitude=latitude=false}}function z_engine_geo_set(a){latitude=a.coords.latitude;longitude=a.coords.longitude}
function z_engine_get_height(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function z_engine_get_klout(a,b,c){if(klout[b]){a=klout[b].evalJSON(true);z_engine_set_klout(a,c)}else socket.emit("klout",{klout:a,id_str:c})}
function z_engine_get_language(){var a=store.get("lang");switch(a){case "english":case "russian":new Ajax.Request("/lang/"+a+".json",{method:"GET",onSuccess:function(b){translation="";translation=b.responseText.evalJSON(true);z_engine_set_language();z_engine_settings_set_language()}})}}
function z_engine_image_dropper(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){$("image").show();$("image").ondragover=function(a){a.preventDefault();$("image").setStyle("border-color: #aaa;");return false};$("image").ondragend=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false};$("image").ondrop=function(a){a.preventDefault();var b=a.dataTransfer.files[0];if(b.size<=max_file_size*1048576)switch(b.type){case "application/pdf":case "image/apng":case "image/bmp":case "image/gif":case "image/jpeg":case "image/jpg":case "image/png":case "image/tiff":a=
new FormData;a.append("image",b);a.append("key",imgur_key);b=new XMLHttpRequest;b.upload.onprogress=function(c){c.lengthComputable&&progress_bar.step(c.loaded/c.total*100)};b.onreadystatechange=function(){if(this.readyState==1){$("progress-bar").appear();$("image").setStyle("border-color: #ddd;")}else if(this.readyState==4){$("progress-bar").fade();if(this.status==200){var c=this.responseText.evalJSON(true).upload.links.original,g=$("new-tweet").getValue();if(g.length>0)var f=g+" "+c;else if(g.length==
0)f=c;$("new-tweet").setValue(f)}else{z_engine_notification("","error!","there seems to have been an error on imgur's end!");$("image").setStyle("border-color: red;");Element.setStyle.delay(2,"image","border-color: #ddd;")}}};b.open("POST","http://api.imgur.com/2/upload.json",true);b.send(a);break;default:z_engine_notification("","error!","this file is not supported, sorry!");$("image").setStyle("border-color: red;");Element.setStyle.delay(2,"image","border-color: #ddd;")}return false};$("image").ondragleave=
function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false}}}function z_engine_input(){var a=$("new-tweet").getValue(),b=$("new-dm-user").getValue();if(a.length==0)shortened=reply_id=false;else if(a.length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else if(a.length>=141){z_engine_shorten_urls();$("new-tweet").setStyle("color: red;")}b.length==0&&$("new-tweet").removeClassName("dm")}
function z_engine_logout(){socket.disconnect();$("new-tweet").disable();$("new-tweet").setValue("see ya!");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}
function z_engine_notification(a,b,c){if(store.get("notifications")=="on"){if(store.get("sound")=="on"&&store.get("sound_src").length>0&&(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE"))audio.play();if(c==null)c="";if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var g=window.webkitNotifications.createNotification(a,b,c.unescapeHTML());g.show();window.setTimeout(function(){g.cancel()},store.get("notifications_timeout")*1E3)}else if(window.webkitNotifications&&
window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission();growler.growl(a,b,c.unescapeHTML())}else if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2)growler.growl(a,b,c.unescapeHTML())}}function z_engine_notification_setup(){window.webkitNotifications&&window.webkitNotifications.checkPermission()==1&&window.webkitNotifications.requestPermission()}
function z_engine_parse_tweet(a){if(a){a=twttr.txt.autoLink(a);a=a.replace(/\n\r?/g,"<br />")}return a}
function z_engine_prune_tweets(){var a=$("home-timeline").childElements(),b=$("mentions-timeline").childElements(),c=$("dms-inbox-timeline").childElements(),g=$("dms-outbox-timeline").childElements(),f=$("threaded-timeline").childElements();a.length>=home_cutoff&&a.each(function(e,j){if(j>home_cutoff){var d=$(e).readAttribute("id").replace(/comment-/i,"");d=content_stored.indexOf(d);content_stored.splice(d,1);$(e).remove()}});b.length>=mentions_cutoff&&b.each.delay(12,function(e,j){if(j>mentions_cutoff){var d=
$(e).readAttribute("id").replace(/comment-/i,"");d=d.replace(/-mentioned/i,"");d=content_stored.indexOf(d);content_stored.splice(d,1);$(e).remove()}});c.length>=dms_cutoff&&c.each.delay(24,function(e,j){if(j>dms_cutoff){var d=$(e).readAttribute("id").replace(/comment-/i,"");d=content_stored.indexOf(d);content_stored.splice(d,1);$(e).remove()}});g.length>=dms_cutoff&&g.each.delay(36,function(e,j){if(j>dms_cutoff){var d=$(e).readAttribute("id").replace(/comment-/i,"");d=content_stored.indexOf(d);content_stored.splice(d,
1);$(e).remove()}});f.length>=threaded_cutoff&&f.each.delay(48,function(e,j){if(j>threaded_cutoff){var d=$(e).readAttribute("id").replace(/comment-/i,"");d=d.replace(/-mentioned/i,"");d=content_stored.indexOf(d);content_stored.splice(d,1);$(e).remove()}})}function z_engine_related(a,b){tabs.last();socket.emit("related",{id_str:a,origin:b})}
function z_engine_remember_author(a){a="@"+a;var b="",c=false;$w(store.get("users")).uniq().compact().each(function(g,f){if(f<=remember_cutoff)if(g==a)c=true;else b+=" "+g});c||(b=a+" "+b);store.set("users",b.strip())}function z_engine_reply(a,b,c){reply_id=b;$("new-tweet").setValue("@"+a+" "+c);$("new-tweet").focus()}function z_engine_reply_dm(a,b){$("new-dm-user").setValue(b);$("new-tweet").addClassName("dm");$("new-tweet").focus()}
function z_engine_retweet(a){socket.emit("retweet",{id_str:a})}function z_engine_retweet_comment(a,b,c){reply_id=a;$("new-tweet").setValue("RT @"+b+" "+c.unescapeHTML());$("new-tweet").focus()}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();$("new-dm-user").disable();var a=$("new-tweet").getValue().strip(),b=$("new-dm-user").getValue().strip(),c=new Hash;if(b.length>0){if(b.startsWith("@"))b=b.replace(/@/i,"");c={action:"dm",data:{screen_name:b,text:a}}}else{c={action:"tweet",data:{status:a,include_entities:true}};store.get("geo")=="on"&&latitude&&longitude&&new Object.extend(c.data,{display_coordinates:true,
lat:latitude,"long":longitude});reply_id&&new Object.extend(c.data,{in_reply_to_status_id:reply_id})}socket.emit("status",c);shortened=reply_id=false;$("new-dm-user").enable();$("new-dm-user").removeClassName("dm");$("new-dm-user").setValue("");$("new-tweet").setValue("");$("new-tweet").enable();$("new-tweet").focus()}}
function z_engine_set_klout(a,b){if(typeof a=="object")if(a.length>0&&typeof b=="string"){var c=Math.round(a[0].score.network_score),g=Math.round(a[0].score.true_reach),f="score: <strong>"+Math.round(a[0].score.kscore)+"</strong><br />";f+="amp: <strong>"+Math.round(a[0].score.amplification_score)+"</strong><br />";f+="network: <strong>"+c+"</strong><br />";f+="reach: <strong>"+g+"</strong><br />";if($("klout-"+b)){$("klout-"+b).addTip(f,kloutinfo_params);$("klout-"+b).writeAttribute("src","img/kltd.png");
$("klout-"+b).writeAttribute("title","")}if($("klout-"+b+"-mentioned")){$("klout-"+b+"-mentioned").addTip(f,kloutinfo_params);$("klout-"+b+"-mentioned").writeAttribute("src","img/kltd.png");$("klout-"+b+"-mentioned").writeAttribute("title","")}}}
function z_engine_set_language(){$("home-timeline-click").update(translation.home);$("mentions-timeline-click").update(translation.mentions);$("dms-inbox-timeline-click").update(translation.inbox);$("dms-outbox-timeline-click").update(translation.outbox);$("pause").update(translation.stop);$("image").update(translation.image);$("settings").update(translation.settings);$("logout").update(translation.exit);$("new-dm-user").placeholder=translation.dm_to_placeholder;$("new-tweet").placeholder=translation.tweet_placeholder}
function z_engine_settings_checked_clicker(a,b){new Event.observe(a,"change",function(c){Event.stop(c);c=$(a).getValue();switch(b){case "lang":store.set(b,c);z_engine_get_language();break;case "notifications_timeout":store.set(b,c);break;case "stream_interval":store.set(b,c);stream_queue_interval.stop();stream_queue_interval=new PeriodicalExecuter(function(){paused||z_engine_stream_queue()},c);break;default:c=store.get(b)=="on"?"off":"on";store.set(b,c)}})}
function z_engine_settings_get(a,b){switch(b){case "notifications_timeout":$(a).setValue(store.get(b));break;case "stream_interval":$(a).setValue(store.get(b));break;case "lang":new Form.Element.select(store.get(b));break;default:store.get(b)=="on"&&$(a).click()}}
function z_engine_settings_set_language(){$("language-settings").update(translation.language_settings);$("notify-settings").update(translation.notify_settings);$("notify-enable-settings").update(translation.notify_enable_settings);$("notify-audio-settings").update(translation.notify_audio_settings);$("notify-length-settings").update(translation.notify_length_settings);$("wait-length-settings").update(translation.wait_length_settings);$("other-settings").update(translation.other_settings);$("geo-settings").update(translation.geo_settings);
$("klout-settings").update(translation.klout_settings)}
function z_engine_settings_setup(){z_engine_settings_get("language","lang");z_engine_settings_checked_clicker("language","lang");z_engine_settings_get("use-audio","sound");z_engine_settings_checked_clicker("use-audio","sound");z_engine_settings_get("use-notify","notifications");z_engine_settings_checked_clicker("use-notify","notifications");z_engine_settings_get("notify-length","notifications_timeout");z_engine_settings_checked_clicker("notify-length","notifications_timeout");z_engine_settings_get("stream-interval",
"stream_interval");z_engine_settings_checked_clicker("stream-interval","stream_interval");z_engine_settings_get("use-geo","geo");z_engine_settings_checked_clicker("use-geo","geo");z_engine_settings_get("use-klout","klout");z_engine_settings_checked_clicker("use-klout","klout")}
function z_engine_shorten_urls(){var a=$("new-tweet").getValue();if(a.length>0&&!shortened){a.replace(/((https?\:\/\/)|(www\.))([^ \(\)\{\}\[\]]+)/g,function(b){b.length>=20&&socket.emit("shorten",{shorten:b})});shortened=true}}function z_engine_stream_queue(){if(content_queued.length>0){var a=content_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"home top")}}}
function z_engine_threaded(a,b){if(a){tabs.last();if(content_stored[a])z_engine_tweet(content_stored[a].evalJSON(true),"threaded top");else content_stored[a]?z_engine_tweet(content_stored[a].evalJSON(true),"threaded top"):socket.emit("show",{id_str:a})}else if(content_stored[b])z_engine_tweet(content_stored[b].evalJSON(true),"threaded bottom");else content_stored[b]?z_engine_tweet(content_stored[b].evalJSON(true),"threaded bottom"):socket.emit("show",{id_str:b})}
function z_engine_tweet(a,b){var c=$w(b),g=c[0];c=c[1];if(g!="dms")if(a.retweeted_status){f=a.retweeted_status.user.screen_name;e=a.user.screen_name;j=a.retweeted_status.user.profile_image_url;d=BrowserDetect.browser=="Opera"?a.retweeted_status.created_at:(new Date(a.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");i=a.retweeted_status.user.description;m=a.retweeted_status.entities;h=a.retweeted_status.favorited;l=a.retweeted_status.user.followers_count;p=a.retweeted_status.user.friends_count;
k=a.retweeted_status.id_str;w=a.retweeted_status.user.listed_count;n=a.retweeted_status.user.location;y=a.retweeted_status.user["protected"];t=a.retweeted_status.place;o=a.retweeted_status.in_reply_to_screen_name;D=a.retweeted_status.in_reply_to_status_id_str;q=a.retweeted_status.retweet_count-1;E=true;J=a.retweeted_status.source.stripTags();A=a.retweeted_status.text;z=a.retweeted_status.user.statuses_count;F=a.retweeted_status.user.id;r=a.retweeted_status.user.verified}else{var f=a.user.screen_name,
e=false,j=a.user.profile_image_url,d=BrowserDetect.browser=="Opera"?a.created_at:(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");d=a.created_at;var i=a.user.description,m=a.entities,h=a.favorited,l=a.user.followers_count,p=a.user.friends_count,k=a.id_str,w=a.user.listed_count,n=a.user.location,y=a.user["protected"],t=a.place,o=a.in_reply_to_screen_name,D=a.in_reply_to_status_id_str,q=a.retweet_count-1,E=false,J=a.source.stripTags(),A=a.text,z=a.user.statuses_count,F=a.user.id,r=a.user.verified}else{f=
a.sender.screen_name;j=a.sender.profile_image_url;d=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");i=a.sender.description;m=false;l=a.sender.followers_count;p=a.sender.friends_count;k=a.id_str;w=a.sender.listed_count;n=a.sender.location;y=false;o=a.recipient.screen_name;q=0;E=false;A=a.text;z=a.sender.statuses_count;F=a.sender_id;r=a.sender.verified}var M=false,N=false,O=false,P=false,u=false;if(g!="threaded"&&content_stored[k])u=true;g!="dms"&&$w(store.get("client_blocks")).uniq().each(function(B){if(B.replace("'",
"")==J)M=true});if(m){typeof m.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(B){m.hashtags.uniq().each(function(K){if(B==K)N=true})});typeof m.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(B){m.user_mentions.uniq().each(function(K){if(B==K)O=true})})}$w(store.get("user_blocks")).uniq().each(function(B){if(B==f)P=true});if(!u&&!M&&!N&&!O&&!P){(new Image).src=j;content_stored[k]=JSON.stringify(a);z_engine_remember_author(f);u="";if(i!=null&&
i!="")u+=i+"<br /><br />";if(n!=null&&n!="")u+="location: <strong>"+n+"</strong><br />";u+="tweets: <strong>"+z+"</strong><br />";u+="following: <strong>"+p+"</strong><br />";u+="followers: <strong>"+l+"</strong><br />";u+="listed: <strong>"+w+"</strong>";if(m){w=z_engine_tweet_mentioned(m);i=z_engine_tweet_mentioned_string(m)}else i=w=false;z=new Element("br");l=g!="dms"?new Element("div",{ondblclick:'z_engine_reply("'+f+'", "'+k+'", "'+i+'");',id:"comment-"+k,"class":"comment-parent"}):new Element("div",
{ondblclick:'z_engine_reply_dm("'+F+'", "'+f+'");',id:"comment-"+k,"class":"comment-parent"});n=new Element("div",{"class":"comment-profile-wrapper left"});var H=new Element("div",{"class":"comment-gravatar"});p=new Element("img",{id:"av-"+k,src:j,style:"height: 50px; width: 50px; cursor: pointer;",alt:""});H.insert(p);n.insert(H);H=new Element("div",{id:"comment-"+k+"content","class":"comment-content-wrapper right"});var I=f!=screen_name?w?new Element("div",{"class":"comment-body-mentioned"}):new Element("div",
{"class":"comment-body"}):new Element("div",{"class":"comment-body-me"}),s=new Element("div",{"class":"comment-arrow"});I.insert(s);var G=new Element("div",{"class":"post-date"});s=new Element("div",{"class":"left",id:"left-"+k});var Q=new Element("a",{target:"_blank",href:"http://twitter.com/"+f});Q.update("@"+f+" ");var R=new Element("span");R.update(translation.wrote_this);if(g!="dms")var v=new Element("a",{target:"_blank",id:"comment-"+k+"-relative-date",href:"http://twitter.com/"+f+"/status/"+
k});var L=new Element("time",{datetime:d,"class":g});L.update(relative_time(d));g!="dms"&&v.insert(L);s.insert(Q);s.insert({bottom:R});if(g!="dms"){s.insert({bottom:v});if(D){v=new Element("span");v.update(translation.in_reply_to);d=g=="threaded"?new Element("a",{target:"_blank",href:"http://twitter.com/"+o+"/status/"+D}):new Element("span",{onclick:'z_engine_threaded("'+k+'","'+D+'");',style:"cursor: pointer;"});d.update("@"+o+" ");s.insert(v);s.insert({bottom:d})}o=new Element("span",{"class":"via"});
o.update(translation.via+" "+J);s.insert({bottom:o})}else{s.insert({bottom:L});if(o){v=new Element("span");v.update(" in reply to ");d=new Element("a",{target:"_blank",href:"http://twitter.com/"+o});d.update(o+" ");s.insert(v);s.insert({bottom:d})}}if(r){r=new Element("span");r.update(" ");o=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});r.insert({bottom:o});s.insert({bottom:r})}G.insert(s);r=new Element("div",{"class":"right"});if(E){o=q>0?"retweeted by "+e+" and "+q+" others!":
"retweeted by "+e+"!";q=new Element("span",{"class":"rtd"});q.update(" ");o=new Element("img",{src:"img/rtd2.png",alt:"",title:o});v=new Element("a",{target:"_blank",href:"http://twitter.com/"+e});v.update(e);q.insert({top:o});q.insert({bottom:v});r.insert({bottom:q})}if(g!="dms"&&t&&t.full_name){q=new Element("span",{"class":"place",id:"place-"+k});o=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+t.full_name});t=new Element("img",{src:"img/plc.png",alt:"",title:t.full_name});o.update(t);
q.update(o);r.insert({bottom:q})}G.insert({bottom:r});I.insert({bottom:G});q=new Element("div",{"class":"clearer"});q.update("&nbsp;");I.insert({bottom:q});G=new Element("div",{"class":"comment-text"});r=new Element("p",{id:"comment-"+k+"-text"});t=new Element("div",{id:"right-"+k,"class":"right"});r.insert(z);r.insert({bottom:t});z=new Element("div",{id:"text-"+k,"class":"comment-text-select"});z.update(z_engine_parse_tweet(A));r.insert({bottom:z});G.insert(r);I.insert({bottom:G});H.insert(I);l.insert(n);
l.insert({bottom:H});l.insert({bottom:q});new Element.extend(p);new Element.extend(s);new Element.extend(t);new Element.extend(l);switch(c){case "bottom":var x={bottom:l};break;case "top":x={top:l}}switch(g){case "dms":if(f!=screen_name)$("dms-inbox-timeline").insert(x);else f==screen_name&&$("dms-outbox-timeline").insert(x);break;case "home":$("home-timeline").insert(x);break;case "mentions":$("mentions-timeline").insert(x)}if(w&&g!="mentions"&&g!="threaded"&&f!=screen_name&&!a.retweeted_status){x=
cloneNodeWithEvents(l);x.writeAttribute("id","comment-"+k+"-mentioned");s.writeAttribute("id","left-"+k+"-mentioned");t.writeAttribute("id","right-"+k+"-mentioned");p.writeAttribute("id","av-"+k+"-mentioned");new Element.extend(x);switch(c){case "bottom":var C={bottom:x};break;case "top":C={top:x}}$("mentions-timeline").insert(C);z_engine_tweet_buttons("mentions",k,f,e,F,A,y,h,E,i,u);z_engine_fade_down("comment-"+k+"-mentioned");z_engine_notification(j,"@"+f+" mentioned you!",A)}if(g=="threaded"){s.writeAttribute("id",
"left-"+k+"-threaded");t.writeAttribute("id","right-"+k+"-threaded");p.writeAttribute("id","av-"+k+"-threaded");C=cloneNodeWithEvents(l);C.writeAttribute("id","comment-"+k+"-threaded");new Element.extend(C);switch(c){case "bottom":var S={bottom:C};break;case "top":S={top:C}}$("threaded-timeline").insert(S);z_engine_tweet_buttons("threaded",k,f,e,F,A,y,h,E,i,u);z_engine_fade_down("comment-"+k+"-threaded")}if($("comment-"+k)){z_engine_tweet_buttons(g,k,f,e,F,A,y,h,E,i,u);z_engine_fade_down("comment-"+
k)}}g=="threaded"&&D&&z_engine_threaded(false,D)}
function z_engine_tweet_buttons(a,b,c,g,f,e,j,d,i,m,h){switch(a){case "dms":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);if(c!=screen_name){h=new Element("img",{onclick:'z_engine_reply_dm("'+f+'", "'+c+'");',src:"/img/rep.png",title:"reply",id:"reply-"+b,alt:""});new Element.extend(h);$("right-"+b).insert(h)}h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "dm");',src:"/img/del.png",title:"delete",id:"del-"+b,alt:""});new Element.extend(h);$("right-"+b).insert({bottom:h});
z_engine_tweet_right_click(b,"comment-"+b,c,g,f,m,e,d,i,j,a);break;case "home":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);if(store.get("klout")=="on")if($("left-"+b)&&!$("klout-"+b)){h=new Element("span",{"class":"klout"});h.update(" ");var l=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+f+'", "'+b+'");',src:"/img/klt.png",id:"klout-"+b,alt:"",title:"click to get this users klout score"});h.insert({top:l});new Element.extend(l);$("left-"+b).insert({top:h})}if(c!=
screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+m+'");',title:"reply",id:"reply-"+b,alt:""});new Element.extend(h);if(j)l=new Element("img",{src:"/img/lock.png",style:"cursor: default;",title:"this account is private",alt:""});else{l=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:"retweet",id:"rt-"+b,alt:""});new Element.extend(l)}var p=d?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',
title:"unfavorite",id:"fave-"+b,alt:""}):new Element("img",{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:"favorite",id:"fave-"+b,alt:""});$("right-"+b).update();$("right-"+b).insert(h);$("right-"+b).insert({bottom:l});$("right-"+b).insert({bottom:p})}else{h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',title:"delete",src:"/img/del.png",id:"del-"+b,alt:""});new Element.extend(h);$("right-"+b).update();$("right-"+b).insert({bottom:h})}z_engine_tweet_right_click(b,
"comment-"+b,c,g,f,m,e,d,i,j,a);break;case "mentions":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(h),userinfo_params);$("av-"+b+"-mentioned")&&$("av-"+b+"-mentioned").addTip(z_engine_parse_tweet(h),userinfo_params);$("klout-"+b)&&$("klout-"+b).remove();if(c!=screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'-mentioned", "'+m+'");',title:"reply",id:"reply-"+b+"-mentioned",alt:""});new Element.extend(h);if(j)l=new Element("img",{src:"/img/lock.png",style:"cursor: default;",
title:"this account is private",alt:""});else{l=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',title:"retweet",id:"rt-"+b+"-mentioned",alt:""});new Element.extend(l)}p=d?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',title:"unfavorite",id:"fave-"+b+"-mentioned",alt:""}):new Element("img",{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:"favorite",id:"fave-"+b+"-mentioned",alt:""});if($("right-"+b)){$("right-"+b).update();$("right-"+
b).insert(h);$("right-"+b).insert({bottom:l});$("right-"+b).insert({bottom:p})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert(h);$("right-"+b+"-mentioned").insert({bottom:l});$("right-"+b+"-mentioned").insert({bottom:p})}}else{h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',title:"delete",src:"/img/del.png",id:"del-"+b+"-mentioned",alt:""});new Element.extend(h);if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert({bottom:h})}if($("right-"+
b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert({bottom:h})}}$("comment-"+b)&&z_engine_tweet_right_click(b,"comment-"+b,c,g,f,m,e,d,i,j,a);$("comment-"+b+"-mentioned")&&z_engine_tweet_right_click(b,"comment-"+b+"-mentioned",c,g,f,m,e,d,i,j,a);break;case "threaded":$("av-"+b+"-threaded")&&$("av-"+b+"-threaded").addTip(z_engine_parse_tweet(h),userinfo_params);$("klout-"+b)&&$("klout-"+b).remove();if(c!=screen_name){h=new Element("img",{src:"/img/rep.png",onclick:'z_engine_reply("'+
c+'", "'+b+'", "'+m+'");',title:"reply",id:"reply-"+b+"-threaded",alt:""});new Element.extend(h);if(j)l=new Element("img",{src:"/img/lock.png",style:"cursor: default;",title:"this account is private",alt:""});else{l=new Element("img",{src:"/img/rt.png",onclick:'z_engine_retweet("'+b+'");',id:"rt-"+b+"-threaded",title:"retweet",alt:""});new Element.extend(l)}p=d?new Element("img",{src:"/img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',title:"unfavorite",id:"fave-"+b+"-threaded",alt:""}):new Element("img",
{src:"/img/fav.png",onclick:'z_engine_favorite("'+b+'");',title:"favorite",id:"fave-"+b+"-threaded",alt:""});if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert(h);$("right-"+b+"-threaded").insert({bottom:l});$("right-"+b+"-threaded").insert({bottom:p})}}else{h=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"/img/del.png",title:"delete",id:"del-"+b+"-threaded",alt:""});new Element.extend(h);if($("right-"+b+"-threaded")){$("right-"+
b+"-threaded").update();$("right-"+b+"-threaded").insert({bottom:h})}}z_engine_tweet_right_click(b,"comment-"+b+"-threaded",c,g,f,m,e,d,i,j,a)}}function z_engine_tweet_mentioned(a){var b=false;a.user_mentions.uniq().each(function(c){if(c.screen_name==screen_name)b=true});return b}
function z_engine_tweet_mentioned_string(a){if(a&&a.user_mentions.length>0){var b="";a.user_mentions.uniq().each(function(c){if(c.screen_name!=screen_name)b+="@"+c.screen_name+" "});return b.length>0?$w(b).uniq().join(" ")+" ":""}else return""}
function z_engine_tweet_pause(){if(paused){paused=false;new Effect.Fade("paused-count",{afterFinish:function(){$("paused-count").update("(0)");$("pause").update(translation.stop);pttid=0}})}else{paused=true;$("pause").update(translation.start);$("paused-count").appear()}}
function z_engine_tweet_right_click(a,b,c,g,f,e,j,d,i,m,h){var l=false,p=true,k=false,w=false;if(c==screen_name){l=true;p=false}i||(k=true);if(i&&g!=screen_name){k=true;i=false}else if(i&&g==screen_name)w=true;var n=new Control.ContextMenu(b,{animation:false});switch(h){case "home":case "mentions":case "threaded":if(l)n.addItem({label:'<img src="/img/del.png" title="delete" alt="" />',callback:function(){z_engine_destroy(a,"tweet")}});else{n.addItem({label:'<img src="/img/rep.png" title="reply to all" alt="" />',
callback:function(){z_engine_reply(c,a,e)}});if(m)n.addItem({label:'<img src="/img/lock.png" title="this account is private" alt="" />',enabled:false});else{n.addItem({label:function(){return'<img src="/img/rt.png" title="retweet" alt="" />'},condition:function(){return k},callback:function(){if(content_rts_stored[a])a=content_rts_stored[a].evalJSON(true).retweeted_status.id_str;z_engine_retweet(a);new PeriodicalExecuter(function(y){if(content_rts_stored[a]){y.stop();y=content_rts_stored[a].evalJSON(true).id_str;
n.destroy();z_engine_tweet_right_click(y,b,c,screen_name,f,e,j,d,true,m,h)}},0.25)}});n.addItem({label:function(){return'<span title="retweet (with comment, old method)">RT</span>'},condition:function(){return k},callback:function(){z_engine_retweet_comment(a,c,j)}});n.addItem({label:function(){return'<img src="/img/rtd.png" title="undo retweet" alt="" />'},condition:function(){return w},callback:function(){z_engine_destroy(a,"rt");n.destroy();z_engine_tweet_right_click(a,b,c,screen_name,f,e,j,d,
false,m,h)}})}d?n.addItem({label:'<img src="/img/favd.png" title="unfavorite" alt="" />',callback:function(){z_engine_unfavorite(a);n.destroy();z_engine_tweet_right_click(a,b,c,g,f,e,j,false,i,m,h)}}):n.addItem({label:'<img src="/img/fav.png" title="favorite" alt="" />',callback:function(){z_engine_favorite(a);n.destroy();z_engine_tweet_right_click(a,b,c,g,f,e,j,true,i,m,h)}})}break;case "dms":n.addItem({label:function(){return'<img src="/img/rep.png" title="reply" alt="" />'},condition:function(){return p},
callback:function(){z_engine_reply_dm(f,c)}});n.addItem({label:'<img src="/img/del.png" title="delete" alt="" />',callback:function(){z_engine_destroy(a,"dm")}})}}
function z_engine_unfavorite(a){socket.emit("favorite",{action:"undo",id_str:a});if($("fave-"+a)){$("fave-"+a).writeAttribute("title","favorite");$("fave-"+a).writeAttribute("src","img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("title","favorite");$("fave-"+a+"-mentioned").writeAttribute("src","img/fav.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+
a+"-threaded")){$("fave-"+a+"-threaded").writeAttribute("title","favorite");$("fave-"+a+"-threaded").writeAttribute("src","img/fav.png");$("fave-"+a+"-threaded").writeAttribute("onclick","z_engine_favorite('"+a+"');")}}function z_engine_update_relative_time(a){a=$$(a);a.length>0&&a.each(function(b){var c=b.readAttribute("datetime");b.update(relative_time(c))})};
