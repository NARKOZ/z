var audio=new Audio;audio.src=BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?"/audio/notify.mp3":"/audio/notify.ogg";store.get("client_blocks")||store.set("client_blocks","");store.set("connect_id",CONNECT_SID);var check_ratelimit_interval=300,content_queued=[],content_stored=[],dms_cutoff=100,dms_loaded=0,dm_to=false,following=[],geo_high_accuracy=false,geo_timeout=12E3;store.get("hashtag_blocks")||store.set("hashtag_blocks","");
var home_cutoff=200,klout=[],kloutinfo_params={className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]},latest_threaded_id=0,latit=false,loaded=false,longit=false,max_file_size=2,max_fps=S2.Extensions.HardwareAcceleratedCSSTransitions?120:30;store.get("mention_blocks")||store.set("mention_blocks","");
var mentions_cutoff=150,paused=false,pttid=0,prune_tweets_interval=60,rates="",reply_id=false,screen_name="",socket=io.connectWithSession(),stream_queue_interval=1.5,update_relative_dms_interval=60,update_relative_home_interval=15,update_relative_mentions_interval=30,user_id=0,userinfo_params={className:"user",hideDelay:3,showOn:"click",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]};store.get("user_blocks")||store.set("user_blocks","");
store.get("users")||store.set("users","");new S2.FX.Base({fps:max_fps});z_engine_attrition();
function z_engine_attrition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(z_engine_get_geolocation,z_engine_geolocation_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout});window.webkitNotifications&&window.webkitNotifications.checkPermission()==1&&window.webkitNotifications.requestPermission();if(!loaded){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var b=$("image");b.setAttribute("title","drop images here!");b.show();b.ondragover=
function(a){a.preventDefault();b.setStyle("border-color: #aaa;");return false};b.ondragend=function(a){a.preventDefault();b.setStyle("border-color: #ddd;");return false};b.ondrop=function(a){a.preventDefault();z_engine_dropped_image(a.dataTransfer.files[0]);return false};b.ondragleave=function(a){a.preventDefault();b.setStyle("border-color: #ddd;");return false}}$("loading-home").center(8);$("loading-mentions").center(8);$("loading-inbox").center(8);$("loading-outbox").center(8);new Event.observe("logout",
"click",function(a){Event.stop(a);return z_engine_logout()});new Event.observe("pause","click",function(a){Event.stop(a);return z_engine_tweet_pause()});new Event.observe("shorten","click",function(a){Event.stop(a);return z_engine_shorten_urls()});new Event.observe("new-tweet","keyup",function(){if($("new-tweet").getValue().length===0)reply_id=dm_to=false;else if($("new-tweet").getValue().length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")});
new Event.observe("new-tweet","keydown",function(){if($("new-tweet").getValue().length===0)reply_id=false;else if($("new-tweet").getValue().length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")})}socket.on("connect",function(){loaded||$("new-tweet").setValue("connected...")});socket.on("message",function(a){var c=JSON.stringify(a);if(c.isJSON()&&c.evalJSON(true)){c="";if(a.loaded&&!loaded){loaded=true;$("new-tweet").setValue("");
$("new-tweet").enable();new Event.observe("new-tweet-form","submit",function(i){Event.stop(i);z_engine_send_tweet()});z_engine_clicker("home-timeline-click","home-timeline");z_engine_clicker("mentions-timeline-click","mentions-timeline");z_engine_clicker("dms-timeline-click","dms-timeline");z_engine_clicker_dms("dms-inbox-timeline-click","dms-inbox-timeline");z_engine_clicker_dms("dms-outbox-timeline-click","dms-outbox-timeline");z_engine_check_ratelimit();socket.emit("message",{fetch:"home"});setTimeout(function(){socket.emit("message",
{fetch:"mentions"})},1E4);setTimeout(function(){socket.emit("message",{fetch:"dms-inbox"})},2E4);setTimeout(function(){socket.emit("message",{fetch:"dms-outbox"})},3E4);setInterval(function(){z_engine_check_ratelimit()},check_ratelimit_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.dms")},
update_relative_dms_interval*1E3);setInterval(function(){$$("time.threaded").length>0&&z_engine_update_relative_time("time.threaded")},update_relative_home_interval*1E3);setInterval(function(){paused||z_engine_prune_tweets()},prune_tweets_interval*1E3);setInterval(function(){paused||z_engine_stream_queue()},stream_queue_interval*1E3)}else if(a.loaded&&loaded)$("new-tweet").enable();else if(a["delete"]){var d=typeof a["delete"].status=="object"?a["delete"].status.id_str:0;z_engine_drop_tweet(d)}else if(a.direct_message){z_engine_tweet(a.direct_message,
"dms");a.direct_message.sender.screen_name!=screen_name&&z_engine_notification(a.direct_message.sender.profile_image_url,"@"+a.direct_message.sender.screen_name+" sent a direct message",a.direct_message.text)}else if(a.dms){dms_loaded++;a.dms.each(function(i){z_engine_tweet(i,"dms")});switch(dms_loaded){case 1:$("loading-inbox").fade();$("loading-outbox").appear();break;case 2:$("loading-outbox").fade()}}else if(a.event)switch(a.event){case "block":$w(store.get("mention_blocks")).uniq();c=$w(store.get("user_blocks")).uniq();
var h=false,f=false;d.each(function(i){if(i==a.target.screen_name)h=true});c.each(function(i){if(i==a.target.screen_name)f=true});h||store.set("mention_blocks",current_blocks.join(" ")+" "+a.target.screen_name);f||store.set("user_blocks",current_blocks.join(" ")+" "+a.target.screen_name);break;case "unblock":d=$w(store.get("user_blocks")).uniq();c=$w(store.get("user_blocks")).uniq();var e="",j="";d.each(function(i){if(i!=a.target.screen_name)e+=i+" "});c.each(function(i){if(i!=a.target.screen_name)j+=
i+" "});store.set("mention_blocks",e);store.set("user_blocks",j);break;case "favorite":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" faved your tweet!",a.target_object.text);break;case "unfavorite":break;case "follow":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" is following you!",a.source.description);break;case "list_member_added":a.source.screen_name!=screen_name&&
z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" put you in "+a.target_object.full_name+"!",a.target_object.description);break;case "list_created":break;case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" subscribed to "+a.target_object.full_name+"!",a.target_object.description);break;case "list_user_unsubscribed":break;
case "scrub_geo":break;case "user_update":break;default:console.log(JSON.stringify(a.event));console.log(JSON.stringify(a))}else if(a.friends){d=a.friends.join(" ");store.set("friends",d)}else if(a.home){a.home.each(function(i){z_engine_tweet(i,"home")});$("loading-home").fade();$("loading-mentions").appear();socket.emit("message",{fetch:"userstream"})}else if(a.info){screen_name=a.info.screen_name;user_id=a.info.user_id;store.set("screen_name",screen_name);store.set("user_id",user_id)}else if(a.klout){c=
a.klout;d=a.id_str;if(c!="error"){z_engine_set_klout(c.users,d);klout[c.users[0].twitter_id]=JSON.stringify(c.users)}else if($("klout-"+d)){$("klout-"+d).setStyle("cursor: default;");$("klout-"+d).setAttribute("onclick","");$("klout-"+d).addTip("<big><strong>?</strong></big>",kloutinfo_params)}}else if(a.mentions){a.mentions.each(function(i){z_engine_tweet(i,"mentions")});$("loading-mentions").fade();$("loading-inbox").appear()}else if(a.rates)rates=JSON.stringify(a.rates);else if(a.retweet_info){c=
a.retweet_info;if($("comment-"+c.retweeted_status.id_str)){if($("rt-"+c.retweeted_status.id_str)){$("rt-"+c.retweeted_status.id_str).writeAttribute("src","img/rtd.png");$("rt-"+c.retweeted_status.id_str).writeAttribute("onclick","z_engine_destroy('"+c.id_str+"','rt');")}if($("rt-"+c.retweeted_status.id_str+"-mentioned")){$("rt-"+c.retweeted_status.id_str+"-mentioned").writeAttribute("src","img/rtd.png");$("rt-"+c.retweeted_status.id_str+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+
c.id_str+"','rt');")}if($("rt-"+c.retweeted_status.id_str+"-threaded")){$("rt-"+c.retweeted_status.id_str+"-threaded").writeAttribute("src","img/rtd.png");$("rt-"+c.retweeted_status.id_str+"-threaded").writeAttribute("onclick","z_engine_destroy('"+c.id_str+"','rt');")}}}else if(a.server_event){console.log(JSON.stringify(a));switch(a.server_event){case "end":$("new-tweet").disable();z_engine_notification("","notice!","lost connection to the userstream, reconnecting...");break;case "error":$("new-tweet").disable();
z_engine_notification("","notice!","error occurred, reconnecting...")}}else if(a.shorten){d=$("new-tweet").getValue().replace(a.original,a.shorten);$("new-tweet").setValue(d)}else if(a.show)z_engine_tweet(a.show,"threaded");else if(a.text&&a.user&&a.created_at){content_queued.push(JSON.stringify(a));if(paused){$("paused-count").update("("+pttid+")");pttid++}a.retweeted_status&&a.retweeted_status.user.screen_name==screen_name&&a.user.screen_name!=screen_name&&z_engine_notification(a.user.profile_image_url,
"@"+a.user.screen_name+" retweeted you!",a.retweeted_status.text)}}else if(c.isJSON())c.evalJSON(true)?console.log("unknown error, output: "+c):console.log("json could not be properly evaluated, skipping");else console.log("not json, skipping")});socket.on("disconnect",function(){$("new-tweet").disable()})}function z_engine_check_ratelimit(){socket.emit("message",{fetch:"rates"})}
function z_engine_clicker(b,a){new Event.observe(b,"click",function(c){Event.stop(c);if(a=="dms-timeline")new S2.FX.Parallel([new Effect.Fade("dms-timeline-click",{duration:0.25,mode:"relative"}),new Effect.Appear("dms-inbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"}),new Effect.Appear("dms-outbox-timeline-click",{delay:0.1,duration:0.25,mode:"relative"})],{duration:1});else if($("dms-inbox-timeline-click").visible()||$("dms-outbox-timeline-click").visible())new S2.FX.Parallel([new Effect.Fade("dms-outbox-timeline-click",
{duration:0.15,mode:"relative"}),new Effect.Fade("dms-inbox-timeline-click",{duration:0.15,mode:"relative"}),new Effect.Appear("dms-timeline-click",{delay:0.15,duration:0.25,mode:"relative"})],{duration:1});if(!$(a).visible()){if($("home-timeline").visible())var d="home-timeline";if($("mentions-timeline").visible())d="mentions-timeline";if($("threaded-timeline").visible())d="threaded-timeline";if($("dms-timeline").visible())d="dms-timeline";if(BrowserDetect.browser!="Webkit"||BrowserDetect.browser!=
"Firefox"||BrowserDetect.browser=="Firefox"&&BrowserDetect.version<5)new S2.FX.Parallel([new Effect.Fade(d,{duration:0.25,mode:"relative"}),new Effect.Appear(a,{delay:0.25,duration:0.25,mode:"relative"})],{duration:1});else{$(d).addClassName("hider").removeClass("shower");$(a).addClassName("shower").removeClass("hider")}}setTimeout(function(){$("threaded-timeline").update();latest_threaded_id=0},1E3)})}
function z_engine_clicker_dms(b,a){new Event.observe(b,"click",function(c){Event.stop(c);if(!$(a).visible()){if($("dms-outbox-timeline").visible())var d="dms-outbox-timeline";else if($("dms-inbox-timeline").visible())d="dms-inbox-timeline";new S2.FX.Parallel([new Effect.Fade(d,{duration:0.4,mode:"relative"}),new Effect.Appear(a,{delay:0.35,duration:0.4,mode:"relative"})],{duration:1})}})}
function z_engine_destroy(b,a){if(confirm("\nare you sure you want to delete this?\n")){if(a=="tweet"||a=="rt")var c={destroy:{status:{id_str:b}}};else if(a=="dm"){c={destroy_dm:{status:{id_str:b}}};z_engine_drop_tweet(b)}if(a=="rt"){if($("rt-"+b)){$("rt-"+b).setAttribute("src","img/rt.png");$("rt-"+b).setAttribute("onclick","z_engine_retweet('"+b+"');")}if($("rt-"+b+"-mentioned")){$("rt-"+b+"-mentioned").setAttribute("src","img/rt.png");$("rt-"+b+"-mentioned").setAttribute("onclick","z_engine_retweet('"+
b+"');")}if($("rt-"+b+"-threaded")){$("rt-"+b+"-threaded").setAttribute("src","img/rt.png");$("rt-"+b+"-threaded").setAttribute("onclick","z_engine_retweet('"+b+"');")}}socket.emit("message",c)}}
function z_engine_drop_tweet(b){if($("comment-"+b)){$("comment-"+b).setStyle("text-decoration: line-through;");$("del-"+b)&&$("del-"+b).fade();$("fave-"+b)&&$("fave-"+b).fade();$("reply-"+b)&&$("reply-"+b).fade();$("rt-"+b)&&$("rt-"+b).fade();setTimeout(function(){z_engine_fade_up("comment-"+b)},3E3)}if($("comment-"+b+"-mentioned")){$("del-"+b+"-mentioned")&&$("del-"+b+"-mentioned").fade();$("fave-"+b+"-mentioned")&&$("fave-"+b+"-mentioned").fade();$("reply-"+b+"-mentioned")&&$("reply-"+b+"-mentioned").fade();
$("rt-"+b+"-mentioned")&&$("rt-"+b+"-mentioned").fade();setTimeout(function(){z_engine_fade_up("comment-"+b+"-mentioned")},3E3)}if($("comment-"+b+"-threaded")){$("del-"+b+"-threaded")&&$("del-"+b+"-threaded").fade();$("fave-"+b+"-threaded")&&$("fave-"+b+"-threaded").fade();$("reply-"+b+"-threaded")&&$("reply-"+b+"-threaded").fade();$("rt-"+b+"-threaded")&&$("rt-"+b+"-threaded").fade();setTimeout(function(){z_engine_fade_up("comment-"+b+"-threaded")},3E3)}}
function z_engine_dropped_image(b){if(b.size<=max_file_size*1048576)switch(b.type){case "application/pdf":case "image/apng":case "image/bmp":case "image/gif":case "image/jpeg":case "image/jpg":case "image/png":case "image/tiff":var a=new FormData;a.append("image",b);a.append("key",imgur_key);b=new XMLHttpRequest;b.onreadystatechange=function(){if(this.readyState==3||this.readyState==2)$("image").setStyle("border-color: yellow;");if(this.readyState==4&&this.status==200){var c=this.responseText.evalJSON(true).upload.links.original,
d=$("new-tweet").getValue();if(d.length>0)var h=d+" "+c;else if(d.length==0)h=c;$("new-tweet").setValue(h);$("image").setStyle("border-color: green;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},1500)}if(this.readyState==4&&this.status!=200){$("image").setStyle("border-color: red;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},1500)}};b.open("POST","http://api.imgur.com/2/upload.json",true);b.send(a)}}
function z_engine_fade_down(b){if(BrowserDetect.browser!="Webkit"||BrowserDetect.browser!="Firefox"||BrowserDetect.browser=="Firefox"&&BrowserDetect.version<5)new S2.FX.Parallel([new Effect.Appear(b,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindDown(b,{duration:0.7,mode:"relative",transition:"easeOutSine"})],{duration:1.5})}
function z_engine_fade_up(b){if(BrowserDetect.browser!="Webkit"||BrowserDetect.browser!="Firefox"||BrowserDetect.browser=="Firefox"&&BrowserDetect.version<5)new S2.FX.Parallel([new Effect.Fade(b,{duration:1.25,mode:"relative",transition:"easeOutSine"}),new Effect.BlindUp(b,{duration:1,mode:"relative",transition:"easeOutSine"})],{duration:1.5});else $(b).addClassName("comment-parent-drop").removeClassName("comment-parent");setTimeout(function(){$(b).remove()},5E3)}
function z_engine_favorite(b){socket.emit("message",{favorite:{status:{id_str:b}}});if($("fave-"+b)){$("fave-"+b).writeAttribute("src","img/favd.png");$("fave-"+b).writeAttribute("onclick","z_engine_unfavorite('"+b+"');")}if($("fave-"+b+"-mentioned")){$("fave-"+b+"-mentioned").writeAttribute("src","img/favd.png");$("fave-"+b+"-mentioned").writeAttribute("onclick","z_engine_unfavorite('"+b+"');")}if($("fave-"+b+"-threaded")){$("fave-"+b+"-threaded").writeAttribute("src","img/favd.png");$("fave-"+b+
"-threaded").writeAttribute("onclick","z_engine_unfavorite('"+b+"');")}}function z_engine_get_geolocation(b){latit=b.coords.latitude;longit=b.coords.longitude}function z_engine_geolocation_error(b){switch(b.code){case 0:case 1:case 2:case 3:longit=latit=false}}function z_engine_get_klout(b,a,c){if(klout[a]){b=klout[a].evalJSON(true);z_engine_set_klout(b,c)}else socket.emit("message",{klout:b,id_str:c})}
function z_engine_logout(){socket.disconnect();$("new-tweet").disable();$("new-tweet").setValue("see ya!");store.remove("friends");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}
function z_engine_notification(b,a,c){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE")audio.play();if(c==null)c="";if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var d=window.webkitNotifications.createNotification(b,a,c);d.show();setTimeout(function(){d.cancel()},5E3)}else if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission();growler.growl(z_engine_parse_tweet(a),
z_engine_parse_tweet(c))}else if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2)growler.growl(z_engine_parse_tweet(a),z_engine_parse_tweet(c))}function z_engine_parse_tweet(b){if(b){b=twttr.txt.autoLink(b);b=b.replace(/\n\r?/g,"<br />")}return b}
function z_engine_prune_tweets(){var b=$("home-timeline").childElements();b.length>=home_cutoff&&b.each(function(a,c){c>home_cutoff&&$(a).remove()});setTimeout(function(){var a=$("mentions-timeline").childElements();a.length>=mentions_cutoff&&a.each(function(c,d){d>mentions_cutoff&&$(c).remove()})},1E4);setTimeout(function(){var a=$("dms-inbox-timeline").childElements();a.length>=dms_cutoff&&a.each(function(c,d){d>dms_cutoff&&$(c).remove()})},2E4);setTimeout(function(){var a=$("dms-outbox-timeline").childElements();
a.length>=dms_cutoff&&a.each(function(c,d){d>dms_cutoff&&$(c).remove()})},3E4);setTimeout(function(){var a=$("threaded-timeline").childElements();a.length>=home_cutoff&&a.each(function(c,d){d>home_cutoff&&$(c).remove()})},4E4)}function z_engine_reply(b,a,c){reply_id=a;$("new-tweet").setValue("@"+b+" "+c);$("new-tweet").focus()}function z_engine_reply_dm(b){dm_to=b;$("new-tweet").setValue("~");$("new-tweet").focus()}
function z_engine_retweet(b,a,c){if(confirm("\nare you sure you want to retweet this?\n"))if(confirm("ok for normal retweet\ncancel for commented retweet"))socket.emit("message",{retweet:{status:{id_str:b}}});else{reply_id=b;$("new-tweet").setValue("RT @"+a+" "+c);$("new-tweet").focus()}}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();var b=$("new-tweet").getValue().strip(),a=new Hash;if(dm_to){b.startsWith("~")&&b.replace(/~/i,"");a={direct_message:{text:b,user_id:dm_to}}}else{a={status:{status:b,include_entities:true}};latit&&longit&&new Object.extend(a.status,{display_coordinates:true,lat:latit,"long":longit});reply_id&&new Object.extend(a.status,{in_reply_to_status_id:reply_id})}socket.emit("message",
a);dm_to=reply_id=false;$("new-tweet").setValue("");$("new-tweet").enable()}}
function z_engine_set_klout(b,a){if(typeof b=="object")if(b.length>0&&typeof a=="string"){var c=Math.round(b[0].score.network_score),d=Math.round(b[0].score.true_reach),h="score: <strong>"+Math.round(b[0].score.kscore)+"</strong><br />";h+="amp: <strong>"+Math.round(b[0].score.amplification_score)+"</strong><br />";h+="network: <strong>"+c+"</strong><br />";h+="reach: <strong>"+d+"</strong><br />";if($("klout-"+a)){$("klout-"+a).addTip(h,kloutinfo_params);$("klout-"+a).setAttribute("src","img/kltd.png");
$("klout-"+a).setAttribute("title","")}if($("klout-"+a+"-mentioned")){$("klout-"+a+"-mentioned").addTip(h,kloutinfo_params);$("klout-"+a+"-mentioned").setAttribute("src","img/kltd.png");$("klout-"+a+"-mentioned").setAttribute("title","")}}}function z_engine_shorten_urls(){var b=$("new-tweet").getValue();b.length>0&&b.replace(/((https?\:\/\/)|(www\.))([^ ]+)/g,function(a){socket.emit("message",{shorten:a})})}
function z_engine_stream_queue(){if(content_queued.length>0){var b=content_queued.shift();if(typeof b=="string")if(b.isJSON()){b=b.evalJSON(true);z_engine_tweet(b,"home")}}}
function z_engine_threaded(b,a){if(b){if($("home-timeline").visible())var c="home-timeline";if($("mentions-timeline").visible())c="mentions-timeline";new S2.FX.Parallel([new Effect.Fade(c,{duration:0.4,mode:"relative"}),new Effect.Appear("threaded-timeline",{delay:0.35,duration:0.4,mode:"relative"})],{duration:1});if(content_stored[b]){c=content_stored[b].evalJSON(true);z_engine_tweet(c,"threaded")}else socket.emit("message",{show:{id_str:b}})}else if(content_stored[a]){c=content_stored[a].evalJSON(true);
z_engine_tweet(c,"threaded")}else socket.emit("message",{show:{id_str:a}})}
function z_engine_tweet(b,a){if(a!="dms")if(b.retweeted_status){c=b.retweeted_status.user.screen_name;d=b.user.screen_name;h=b.retweeted_status.user.profile_image_url;f=(new Date(b.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");e=b.retweeted_status.user.description;j=b.retweeted_status.entities;i=b.retweeted_status.favorited;k=b.retweeted_status.user.followers_count;o=b.retweeted_status.user.friends_count;g=b.retweeted_status.id_str;p=b.retweeted_status.user.location;z=b.retweeted_status.user["protected"];
q=b.retweeted_status.place;m=b.retweeted_status.in_reply_to_screen_name;x=b.retweeted_status.in_reply_to_status_id_str;n=true;E=b.retweeted_status.source.stripTags();v=b.retweeted_status.text;y=b.retweeted_status.user.statuses_count;A=b.retweeted_status.user.id;r=b.retweeted_status.user.verified}else var c=b.user.screen_name,d=false,h=b.user.profile_image_url,f=(new Date(b.created_at)).toLocaleString().replace(/GMT.+/,""),e=b.user.description,j=b.entities,i=b.favorited,k=b.user.followers_count,o=
b.user.friends_count,g=b.id_str,p=b.user.location,z=b.user["protected"],q=b.place,m=b.in_reply_to_screen_name,x=b.in_reply_to_status_id_str,n=false,E=b.source.stripTags(),v=b.text,y=b.user.statuses_count,A=b.user.id,r=b.user.verified;else{c=b.sender.screen_name;h=b.sender.profile_image_url;f=(new Date(b.created_at)).toLocaleString().replace(/GMT.+/,"");e=b.sender.description;j=false;k=b.sender.followers_count;o=b.sender.friends_count;g=b.id_str;p=b.sender.location;z=false;m=b.recipient.screen_name;
n=false;v=b.text;y=b.sender.statuses_count;A=b.sender_id;r=b.sender.verified}var H=false,I=false,J=false,K=false,s=false;if(a!="threaded"&&content_stored[g])s=true;a!="dms"&&$w(store.get("client_blocks")).uniq().each(function(w){if(w.replace("'","")==E)H=true});if(j){typeof j.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(w){j.hashtags.uniq().each(function(F){if(w==F)I=true})});typeof j.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(w){j.user_mentions.uniq().each(function(F){if(w==
F)J=true})})}$w(store.get("user_blocks")).uniq().each(function(w){if(w==c)K=true});if(!s&&!H&&!I&&!J&&!K){content_stored[g]=JSON.stringify(b);s="";if(e!=null)s+=e+"<br /><br />";if(p!=null)s+="location: "+p+"<br />";s+="tweets: <strong>"+y+"</strong><br />";s+="following: <strong>"+o+"</strong><br />";s+="followers: <strong>"+k+"</strong>";if(j){p=z_engine_tweet_mentioned(j);e=z_engine_tweet_mentioned_string(j)}else e=p=false;var D=new Element("br");k=new Element("div",{id:"comment-"+g,"class":"comment-parent"});
y=new Element("div",{"class":"comment-profile-wrapper left"});var B=new Element("div",{"class":"comment-gravatar"});o=new Element("img",{id:"av-"+g,src:h,style:"height: 50px; width: 50px; cursor: pointer;",alt:""});B.insert(o);y.insert(B);B=new Element("div",{id:"comment-"+g+"content","class":"comment-content-wrapper right"});var C=c!=screen_name?p?new Element("div",{"class":"comment-body-mentioned"}):new Element("div",{"class":"comment-body"}):new Element("div",{"class":"comment-body-me"}),l=new Element("div",
{"class":"comment-arrow"});C.insert(l);var t=new Element("div",{"class":"post-date"});l=new Element("div",{"class":"left",id:"left-"+g});var L=new Element("a",{target:"_blank",href:"http://twitter.com/"+c});L.update("@"+c+" ");var M=new Element("span");M.update("wrote this ");if(a!="dms")var u=new Element("a",{target:"_blank",id:"comment-"+g+"-relative-date",href:"http://twitter.com/"+c+"/status/"+g});var G=new Element("time",{datetime:f,"class":a});G.update(relative_time(f));a!="dms"&&u.insert(G);
l.insert(L);l.insert({bottom:M});if(a!="dms"){l.insert({bottom:u});if(x){f=new Element("span");f.update(" in reply to ");u=a=="threaded"?new Element("a",{target:"_blank",href:"http://twitter.com/"+m+"/status/"+x}):new Element("span",{onclick:'z_engine_threaded("'+g+'","'+x+'");',style:"cursor: pointer;"});u.update(m+" ");l.insert(f);l.insert({bottom:u})}m=new Element("span",{"class":"via"});m.update(" via "+E);l.insert({bottom:m})}else{l.insert({bottom:G});if(m){f=new Element("span");f.update(" in reply to ");
u=new Element("a",{target:"_blank",href:"http://twitter.com/"+m});u.update(m+" ");l.insert(f);l.insert({bottom:u})}}if(r){r=new Element("span");r.update(" ");m=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});r.insert({bottom:m});l.insert({bottom:r})}t.insert(l);r=new Element("div",{"class":"right"});if(n){n=new Element("span",{"class":"rtd"});n.update(" ");m=new Element("img",{src:"img/rtd2.png",alt:""});f=new Element("a",{target:"_blank",href:"http://twitter.com/"+d});f.update(d);
n.insert({top:m});n.insert({bottom:f});r.insert({bottom:n})}if(a!="dms"&&q&&q.full_name){d=new Element("span",{"class":"place"});q=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+q.full_name});n=new Element("img",{src:"img/plc.png",alt:""});q.update(n);d.update(q);r.insert({bottom:d})}t.insert({bottom:r});C.insert({bottom:t});d=new Element("div",{"class":"clearer"});d.update("&nbsp;");C.insert({bottom:d});n=new Element("div",{"class":"comment-text"});t=new Element("p",{id:"comment-"+
g+"-text"});q=new Element("div",{id:"right-"+g,"class":"right"});t.insert(D);t.insert({bottom:q});D=new Element("div",{id:"text-"+g});D.update(z_engine_parse_tweet(v));t.insert({bottom:D});n.insert(t);C.insert({bottom:n});B.insert(C);k.insert(y);k.insert({bottom:B});k.insert({bottom:d});new Element.extend(o);new Element.extend(l);new Element.extend(q);new Element.extend(k);switch(a){case "dms":if(c!=screen_name)$("dms-inbox-timeline").insert({top:k});else c==screen_name&&$("dms-outbox-timeline").insert({top:k});
break;case "home":$("home-timeline").insert({top:k});break;case "mentions":$("mentions-timeline").insert({bottom:k})}if(p&&a!="mentions"&&a!="threaded"&&c!=screen_name&&!b.retweeted_status){p=cloneNodeWithEvents(k);p.setAttribute("id","comment-"+g+"-mentioned");l.setAttribute("id","left-"+g+"-mentioned");q.setAttribute("id","right-"+g+"-mentioned");o.setAttribute("id","av-"+g+"-mentioned");new Element.extend(p);$("mentions-timeline").insert({top:p});z_engine_tweet_buttons("mentions",g,c,A,v,z,i,e,
s);z_engine_notification(h,"@"+c+" mentioned you!",v);z_engine_fade_down("comment-"+g+"-mentioned")}if(a=="threaded"){l.setAttribute("id","left-"+g+"-threaded");q.setAttribute("id","right-"+g+"-threaded");o.setAttribute("id","av-"+g+"-threaded");h=cloneNodeWithEvents(k);h.setAttribute("id","comment-"+g+"-threaded");new Element.extend(h);$("threaded-timeline").insert({bottom:h});z_engine_tweet_buttons("threaded",g,c,A,v,z,i,e,s);z_engine_fade_down("comment-"+g+"-threaded")}$("comment-"+g)&&z_engine_tweet_buttons(a,
g,c,A,v,z,i,e,s)}a=="threaded"&&x&&z_engine_threaded(false,x)}
function z_engine_tweet_buttons(b,a,c,d,h,f,e,j,i){h=(new Element("textarea")).update(escape_string(h.replace(/</g,"&lt;").replace(/>/g,"&gt;")));var k=h.getValue();h="";h=[{name:"reply",callback:function(){z_engine_reply(c,a,j)}},{name:"retweet",callback:function(){z_engine_retweet(a,c,k)}},{name:"favorite",callback:function(){z_engine_favorite(a)}}];var o=[{name:"reply",callback:function(){z_engine_reply(c,a,j)}}],g=[{name:"reply",callback:function(){z_engine_reply(c,a,j)}}];switch(b){case "dms":$("av-"+
a)&&$("av-"+a).addTip(z_engine_parse_tweet(i),userinfo_params);if(c!=screen_name){d=new Element("img",{onclick:'z_engine_reply_dm("'+d+'", "'+c+'");',src:"img/rep.png",id:"reply-"+a,alt:""});new Element.extend(d);$("right-"+a).insert(d)}e=new Element("img",{onclick:'z_engine_destroy("'+a+'", "dm");',src:"img/del.png",id:"del-"+a,alt:""});new Element.extend(e);$("right-"+a).insert({bottom:e});new Proto.Menu({selector:"#comment-"+a,className:"menu",menuItems:g});break;case "home":$("av-"+a)&&$("av-"+
a).addTip(z_engine_parse_tweet(i),userinfo_params);if($("left-"+a)&&!$("klout-"+a)){b=new Element("span",{"class":"klout"});b.update(" ");d=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+d+'", "'+a+'");',src:"img/klt.png",id:"klout-"+a,alt:"",title:"click to get this users klout score"});b.insert({top:d});new Element.extend(d);$("left-"+a).insert({top:b})}if(c!=screen_name){d=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+a+'", "'+j+'");',id:"reply-"+a,alt:""});
new Element.extend(d);if(f)f=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{f=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+a+'", "'+c+'", "'+k+'");',id:"rt-"+a,alt:""});new Element.extend(f)}e=e?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+a+'");',id:"fave-"+a,alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+a+'");',id:"fave-"+a,alt:""});new Element.extend(e);$("right-"+a).update();$("right-"+a).insert(d);
$("right-"+a).insert({bottom:f});$("right-"+a).insert({bottom:e});new Proto.Menu({selector:"#comment-"+a,className:"menu",menuItems:h})}else{e=new Element("img",{onclick:'z_engine_destroy("'+a+'", "tweet");',src:"img/del.png",id:"del-"+a,alt:""});new Element.extend(e);$("right-"+a).update();$("right-"+a).insert({bottom:e});new Proto.Menu({selector:"#comment-"+a,className:"menu",menuItems:o})}break;case "mentions":$("av-"+a+"-mentioned")&&$("av-"+a+"-mentioned").addTip(z_engine_parse_tweet(i),userinfo_params);
if($("left-"+a+"-mentioned")&&!$("klout-"+a+"-mentioned")){b=new Element("span",{"class":"klout"});b.update(" ");d=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+d+'", "'+a+'");',src:"img/klt.png",id:"klout-"+a+"-mentioned",alt:"",title:"click to get this users klout score"});b.insert({top:d});new Element.extend(d);$("left-"+a+"-mentioned").insert({top:b})}if(c!=screen_name){d=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+a+'-mentioned", "'+j+'");',id:"reply-"+
a+"-mentioned",alt:""});new Element.extend(d);if(f)f=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{f=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+a+'", "'+c+'", "'+k+'");',id:"rt-"+a+"-mentioned",alt:""});new Element.extend(f)}e=e?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+a+'");',id:"fave-"+a+"-mentioned",alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+a+'");',id:"fave-"+a+"-mentioned",alt:""});
new Element.extend(e);if($("right-"+a)){$("right-"+a).update();$("right-"+a).insert(d);$("right-"+a).insert({bottom:f});$("right-"+a).insert({bottom:e})}if($("right-"+a+"-mentioned")){$("right-"+a+"-mentioned").update();$("right-"+a+"-mentioned").insert(d);$("right-"+a+"-mentioned").insert({bottom:f});$("right-"+a+"-mentioned").insert({bottom:e})}new Proto.Menu({selector:"#comment-"+a+"-mentioned",className:"menu",menuItems:h})}else{e=new Element("img",{onclick:'z_engine_destroy("'+a+'", "tweet");',
src:"img/del.png",id:"del-"+a+"-mentioned",alt:""});new Element.extend(e);if($("right-"+a)){$("right-"+a).update();$("right-"+a).insert({bottom:e})}if($("right-"+a+"-mentioned")){$("right-"+a+"-mentioned").update();$("right-"+a+"-mentioned").insert({bottom:e})}new Proto.Menu({selector:"#comment-"+a+"-mentioned",className:"menu",menuItems:o})}break;case "threaded":$("av-"+a+"-threaded")&&$("av-"+a+"-threaded").addTip(z_engine_parse_tweet(i),userinfo_params);if(c!=screen_name){d=new Element("img",{src:"img/rep.png",
onclick:'z_engine_reply("'+c+'", "'+a+'", "'+j+'");',id:"reply-"+a+"-threaded",alt:""});new Element.extend(d);if(f)f=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{f=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+a+'", "'+c+'", "'+k+'");',id:"rt-"+a+"-threaded",alt:""});new Element.extend(f)}e=e?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+a+'");',id:"fave-"+a+"-threaded",alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+
a+'");',id:"fave-"+a+"-threaded",alt:""});new Element.extend(e);if($("right-"+a+"-threaded")){$("right-"+a+"-threaded").update();$("right-"+a+"-threaded").insert(d);$("right-"+a+"-threaded").insert({bottom:f});$("right-"+a+"-threaded").insert({bottom:e})}new Proto.Menu({selector:"#comment-"+a+"-threaded",className:"menu",menuItems:h})}else{e=new Element("img",{onclick:'z_engine_destroy("'+a+'", "tweet");',src:"img/del.png",id:"del-"+a+"-threaded",alt:""});new Element.extend(e);if($("right-"+a+"-threaded")){$("right-"+
a+"-threaded").update();$("right-"+a+"-threaded").insert({bottom:e})}new Proto.Menu({selector:"#comment-"+a+"-threaded",className:"menu",menuItems:o})}}}function z_engine_tweet_mentioned(b){var a=false;b.user_mentions.uniq().each(function(c){if(c.screen_name==screen_name)a=true});return a}function z_engine_tweet_mentioned_string(b){var a=[],c="";b.user_mentions.uniq().each(function(d){if(d.screen_name!=screen_name&&!a[d.screen_name]){a[d.screen_name]=true;c+="@"+d.screen_name+" "}});return c}
function z_engine_tweet_pause(){if(paused){paused=false;$("paused-count").fade();$("paused-count").update("(0)");$("pause").update("pause");pttid=0}else{paused=true;$("pause").update("unpause");$("paused-count").appear()}}
function z_engine_unfavorite(b){socket.emit("message",{unfavorite:{status:{id_str:b}}});if($("fave-"+b)){$("fave-"+b).writeAttribute("src","img/fav.png");$("fave-"+b).writeAttribute("onclick","z_engine_favorite('"+b+"');")}if($("fave-"+b+"mentioned")){$("fave-"+b+"-mentioned").writeAttribute("src","img/fav.png");$("fave-"+b+"-mentioned").writeAttribute("onclick","z_engine_favorite('"+b+"');")}if($("fave-"+b+"threaded")){$("fave-"+b+"-threaded").writeAttribute("src","img/fav.png");$("fave-"+b+"-threaded").writeAttribute("onclick",
"z_engine_favorite('"+b+"');")}}function z_engine_update_relative_time(b){$$(b).each(function(a){var c=a.getAttribute("datetime");a.update(relative_time(c))})};
