var audio=new Audio;audio.src=BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?"/audio/notify.mp3":"/audio/notify.ogg";store.get("client_blocks")||store.set("client_blocks","");store.set("connect_id",CONNECT_SID);
var check_ratelimit_interval=300,content_dms_queued=[],content_mentions_queued=[],content_queued=[],content_threads_queued=[],content_stored=[],dms_cutoff=50,dms_loaded=0,dm_to=false,following=[],geo_high_accuracy=false,geo_refresh_interval=300,geo_timeout=120;store.get("hashtag_blocks")||store.set("hashtag_blocks","");
var home_cutoff=200,klout=[],kloutinfo_params={className:"klout",stem:true,target:true,targetJoint:["left","top"],tipJoint:["right","bottom"]},latest_threaded_id=0,latitude=false,loaded=false,longitude=false,max_file_size=2;store.get("mention_blocks")||store.set("mention_blocks","");
var mentions_cutoff=100,paused=false,pttid=0,prune_tweets_interval=60,rates="",reply_id=false,screen_name="",socket=io.connectWithSession(),stream_queue_interval=1.5,threaded_cutoff=50,update_relative_dms_interval=60,update_relative_home_interval=15,update_relative_mentions_interval=30,user_id=0,userinfo_params={className:"user",hideDelay:3,showOn:"click",offset:[11,0],stem:true,target:true,targetJoint:["right","middle"],tipJoint:["left","middle"]};
store.get("user_blocks")||store.set("user_blocks","");store.get("users")||store.set("users","");BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>=3.6||BrowserDetect.browser=="Chrome"||BrowserDetect.browser=="Opera"&&BrowserDetect.version>=9||BrowserDetect.browser=="Safari"?z_engine_attrition():$("new-tweet").setValue("sorry, your browser may not support this client!");
function z_engine_attrition(){if(!loaded){$("loading-home").center(8);$("loading-mentions").center(8);$("loading-inbox").center(8);$("loading-outbox").center(8);new Autocompleter.Local("new-tweet","autocompleter",$w(store.get("users")).uniq(),{choices:15,minChars:2,tokens:" ",afterUpdateElement:function(){$("new-tweet").setValue($("new-tweet").getValue()+" ")}});new Event.observe("logout","click",function(a){Event.stop(a);z_engine_logout()});new Event.observe("pause","click",function(a){Event.stop(a);
z_engine_tweet_pause()});new Event.observe("shorten","click",function(a){Event.stop(a);z_engine_shorten_urls()});new Event.observe("new-tweet","keyup",function(){if($("new-tweet").getValue().length===0)reply_id=dm_to=false;else if($("new-tweet").getValue().length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")});new Event.observe("new-tweet","keydown",function(){if($("new-tweet").getValue().length===0)reply_id=false;
else if($("new-tweet").getValue().length<=140)$("new-tweet").setStyle("color: #4d4d4d;");else $("new-tweet").getValue().length>=141&&$("new-tweet").setStyle("color: red;")});z_engine_geo();z_engine_image_dropper();z_engine_notification_setup()}socket.on("connect",function(){loaded||$("new-tweet").setValue("connected...")});socket.on("message",function(a){var b=JSON.stringify(a);if(b.isJSON()&&b.evalJSON(true)){b="";if(a.loaded&&!loaded){loaded=true;$("new-tweet").setValue("");$("new-tweet").enable();
new Event.observe("new-tweet-form","submit",function(f){Event.stop(f);z_engine_send_tweet()});z_engine_clicker("home-timeline-click","home-timeline");z_engine_clicker("mentions-timeline-click","mentions-timeline");z_engine_clicker("dms-inbox-timeline-click","dms-inbox-timeline");z_engine_clicker("dms-outbox-timeline-click","dms-outbox-timeline");z_engine_check_ratelimit();socket.emit("message",{fetch:"home"});setTimeout(function(){socket.emit("message",{fetch:"mentions"})},1E4);setTimeout(function(){socket.emit("message",
{fetch:"dms-inbox"})},2E4);setTimeout(function(){socket.emit("message",{fetch:"dms-outbox"})},3E4);setInterval(function(){z_engine_check_ratelimit()},check_ratelimit_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.home")},update_relative_home_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.mentions")},update_relative_mentions_interval*1E3);setInterval(function(){z_engine_update_relative_time("time.dms")},update_relative_dms_interval*1E3);setInterval(function(){$$("time.threaded").length>
0&&z_engine_update_relative_time("time.threaded")},update_relative_home_interval*1E3);setInterval(function(){paused||z_engine_prune_tweets()},prune_tweets_interval*1E3);setInterval(function(){paused||z_engine_stream_queue()},stream_queue_interval*1E3);setInterval(function(){z_engine_geo()},geo_refresh_interval*1E3)}else if(a.loaded&&loaded)$("new-tweet").enable();else if(a["delete"]){b=typeof a["delete"].status=="object"?a["delete"].status.id_str:0;z_engine_drop_tweet(b)}else if(a.direct_message){z_engine_tweet(a.direct_message,
"dms");a.direct_message.sender.screen_name!=screen_name&&z_engine_notification(a.direct_message.sender.profile_image_url,"@"+a.direct_message.sender.screen_name+" sent a direct message",a.direct_message.text)}else if(a.dms){dms_loaded++;a.dms.each(function(f){content_dms_queued.push(JSON.stringify(f))});switch(dms_loaded){case 1:$("loading-inbox").fade();$("loading-outbox").appear();break;case 2:$("loading-outbox").fade()}}else if(a.event)switch(a.event){case "block":b=$w(store.get("mention_blocks")).uniq().strip();
var c=$w(store.get("user_blocks")).uniq().strip(),d=false,j=false;b.each(function(f){if(f==a.target.screen_name)d=true});c.each(function(f){if(f==a.target.screen_name)j=true});d||store.set("mention_blocks",current_blocks.join(" ")+" "+a.target.screen_name);j||store.set("user_blocks",current_blocks.join(" ")+" "+a.target.screen_name);break;case "unblock":b=$w(store.get("user_blocks")).uniq().strip();c=$w(store.get("user_blocks")).uniq().strip();var h="",i="";b.each(function(f){if(f!=a.target.screen_name)h+=
f+" "});c.each(function(f){if(f!=a.target.screen_name)i+=f+" "});store.set("mention_blocks",h);store.set("user_blocks",i);break;case "favorite":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" faved your tweet!",a.target_object.text);break;case "unfavorite":break;case "follow":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" is following you!",a.source.description);break;case "list_member_added":a.source.screen_name!=
screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" put you in "+a.target_object.full_name+"!",a.target_object.description);break;case "list_created":break;case "list_destroyed":break;case "list_member_removed":break;case "list_updated":break;case "list_user_subscribed":a.source.screen_name!=screen_name&&z_engine_notification(a.source.profile_image_url,"@"+a.source.screen_name+" subscribed to "+a.target_object.full_name+"!",a.target_object.description);break;case "list_user_unsubscribed":break;
case "scrub_geo":break;case "user_update":break;default:console.log(JSON.stringify(a.event));console.log(JSON.stringify(a))}else if(a.friends){b=a.friends.join(" ");store.set("friends",b)}else if(a.home){a.home.each(function(f){content_queued.push(JSON.stringify(f))});$("loading-home").fade();$("loading-mentions").appear();socket.emit("message",{fetch:"userstream"})}else if(a.info){screen_name=a.info.screen_name;user_id=a.info.user_id;store.set("screen_name",screen_name);store.set("user_id",user_id)}else if(a.klout){c=
a.klout;b=a.id_str;if(c!="error"){z_engine_set_klout(c.users,b);klout[c.users[0].twitter_id]=JSON.stringify(c.users)}else if($("klout-"+b)){$("klout-"+b).setStyle("cursor: default;");$("klout-"+b).setAttribute("onclick","");$("klout-"+b).addTip("<big><strong>?</strong></big>",kloutinfo_params)}}else if(a.mentions){a.mentions.each(function(f){content_mentions_queued.push(JSON.stringify(f))});$("loading-mentions").fade();$("loading-inbox").appear()}else if(a.rates){rates=JSON.stringify(a.rates);a.rates.remaining_hits<=
10&&z_engine_notification("","notice!","you have "+a.rates.remaining_hits+" (of "+a.rates.hourly_limit+") request tokens left!")}else if(a.retweet_info){c=a.retweet_info;b=c.retweeted_status.id_str;if($("comment-"+b)){if($("rt-"+b)){$("rt-"+b).writeAttribute("src","img/rtd.png");$("rt-"+b).writeAttribute("onclick","z_engine_destroy('"+c.id_str+"','rt');")}if($("rt-"+b+"-mentioned")){$("rt-"+b+"-mentioned").writeAttribute("src","img/rtd.png");$("rt-"+b+"-mentioned").writeAttribute("onclick","z_engine_destroy('"+
c.id_str+"','rt');")}if($("rt-"+b+"-threaded")){$("rt-"+b+"-threaded").writeAttribute("src","img/rtd.png");$("rt-"+b+"-threaded").writeAttribute("onclick","z_engine_destroy('"+c.id_str+"','rt');")}}}else if(a.server_event){console.log(JSON.stringify(a));switch(a.server_event){case "end":$("new-tweet").disable();z_engine_notification("","notice!","lost connection to the userstream, reconnecting...");break;case "error":$("new-tweet").disable();z_engine_notification("","notice!","error occurred, reconnecting...")}}else if(a.shorten){b=
$("new-tweet").getValue().replace(a.original,a.shorten);$("new-tweet").setValue(b)}else if(a.show)content_threads_queued.push(JSON.stringify(a.show));else if(a.text&&a.user&&a.created_at){content_queued.push(JSON.stringify(a));if(paused){$("paused-count").update("("+pttid+")");pttid++}a.retweeted_status&&a.retweeted_status.user.screen_name==screen_name&&a.user.screen_name!=screen_name&&z_engine_notification(a.user.profile_image_url,"@"+a.user.screen_name+" retweeted you!",a.retweeted_status.text)}}else if(b.isJSON())b.evalJSON(true)?
console.log("unknown error, output: "+b):console.log("json could not be properly evaluated, skipping");else console.log("not json, skipping")});socket.on("disconnect",function(){$("new-tweet").disable()})}function z_engine_check_ratelimit(){socket.emit("message",{fetch:"rates"})}
function z_engine_clicker(a,b){new Event.observe(a,"click",function(c){Event.stop(c);if(!$(b).visible()){if($("home-timeline").visible())var d="home-timeline";if($("mentions-timeline").visible())d="mentions-timeline";if($("threaded-timeline").visible())d="threaded-timeline";if($("dms-inbox-timeline").visible())d="dms-inbox-timeline";if($("dms-outbox-timeline").visible())d="dms-outbox-timeline";if(z_engine_css3()){$(d).addClassName("hider").removeClassName("shower");setTimeout(function(){$(b).addClassName("shower").removeClassName("hider")},
500);setTimeout(function(){$("threaded-timeline").update();latest_threaded_id=0},1E3)}else new Effect.Parallel([new Effect.Fade(d,{duration:0.5,mode:"relative"}),new Effect.Appear(b,{delay:0.51,duration:0.5,mode:"relative"})],{duration:1,afterFinish:function(){$("threaded-timeline").update();latest_threaded_id=0}})}})}function z_engine_css3(){return BrowserDetect.browser=="Firefox"&&BrowserDetect.version>=5||BrowserDetect.browser!="Chrome"||BrowserDetect.browser!="Safari"?false:true}
function z_engine_destroy(a,b){if(confirm("\nare you sure you want to delete this?\n")){if(b=="tweet"||b=="rt")var c={destroy:{status:{id_str:a}}};else if(b=="dm"){c={destroy_dm:{status:{id_str:a}}};z_engine_drop_tweet(a)}if(b=="rt"){if($("rt-"+a)){$("rt-"+a).setAttribute("src","img/rt.png");$("rt-"+a).setAttribute("onclick","z_engine_retweet('"+a+"');")}if($("rt-"+a+"-mentioned")){$("rt-"+a+"-mentioned").setAttribute("src","img/rt.png");$("rt-"+a+"-mentioned").setAttribute("onclick","z_engine_retweet('"+
a+"');")}if($("rt-"+a+"-threaded")){$("rt-"+a+"-threaded").setAttribute("src","img/rt.png");$("rt-"+a+"-threaded").setAttribute("onclick","z_engine_retweet('"+a+"');")}}socket.emit("message",c)}}
function z_engine_drop_tweet(a){if($("comment-"+a)){$("comment-"+a).setStyle("text-decoration: line-through;");$("del-"+a)&&$("del-"+a).fade();$("fave-"+a)&&$("fave-"+a).fade();$("reply-"+a)&&$("reply-"+a).fade();$("rt-"+a)&&$("rt-"+a).fade();setTimeout(function(){z_engine_fade_up("comment-"+a)},3E3)}if($("comment-"+a+"-mentioned")){$("del-"+a+"-mentioned")&&$("del-"+a+"-mentioned").fade();$("fave-"+a+"-mentioned")&&$("fave-"+a+"-mentioned").fade();$("reply-"+a+"-mentioned")&&$("reply-"+a+"-mentioned").fade();
$("rt-"+a+"-mentioned")&&$("rt-"+a+"-mentioned").fade();setTimeout(function(){z_engine_fade_up("comment-"+a+"-mentioned")},3E3)}if($("comment-"+a+"-threaded")){$("del-"+a+"-threaded")&&$("del-"+a+"-threaded").fade();$("fave-"+a+"-threaded")&&$("fave-"+a+"-threaded").fade();$("reply-"+a+"-threaded")&&$("reply-"+a+"-threaded").fade();$("rt-"+a+"-threaded")&&$("rt-"+a+"-threaded").fade();setTimeout(function(){z_engine_fade_up("comment-"+a+"-threaded")},3E3)}}
function z_engine_fade_down(a){z_engine_css3()||new Effect.Appear(a,{duration:1,transition:Effect.Transitions.sinoidal})}function z_engine_fade_up(a){if(z_engine_css3())$(a).addClassName("comment-parent-drop").removeClassName("comment-parent");else new Effect.Fade(a,{duration:1,transition:Effect.Transitions.sinoidal})}
function z_engine_favorite(a){socket.emit("message",{favorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/favd.png");$("fave-"+a).writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/favd.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}if($("fave-"+a+"-threaded")){$("fave-"+a+"-threaded").writeAttribute("src","img/favd.png");$("fave-"+a+
"-threaded").writeAttribute("onclick","z_engine_unfavorite('"+a+"');")}}function z_engine_geo(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(z_engine_geo_set,z_engine_geo_error,{enableHighAccuracy:geo_high_accuracy,maximumAge:0,timeout:geo_timeout*1E3})}function z_engine_geo_error(a){switch(a.code){case 0:case 1:case 2:case 3:longitude=latitude=false}}function z_engine_geo_set(a){latitude=a.coords.latitude;longitude=a.coords.longitude}
function z_engine_image_dropper(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){$("image").show();$("image").ondragover=function(a){a.preventDefault();$("image").setStyle("border-color: #aaa;");return false};$("image").ondragend=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false};$("image").ondrop=function(a){a.preventDefault();var b=a.dataTransfer.files[0];if(b.size<=max_file_size*1048576)switch(b.type){case "application/pdf":case "image/apng":case "image/bmp":case "image/gif":case "image/jpeg":case "image/jpg":case "image/png":case "image/tiff":a=
new FormData;a.append("image",b);a.append("key",imgur_key);b=new XMLHttpRequest;b.onreadystatechange=function(){if(this.readyState==3||this.readyState==2)$("image").setStyle("border-color: yellow;");if(this.readyState==4&&this.status==200){var c=this.responseText.evalJSON(true).upload.links.original,d=$("new-tweet").getValue();if(d.length>0)var j=d+" "+c;else if(d.length==0)j=c;$("new-tweet").setValue(j);$("image").setStyle("border-color: green;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},
1500)}if(this.readyState==4&&this.status!=200){$("image").setStyle("border-color: red;");setTimeout(function(){$("image").setStyle("border-color: #ddd;")},1500)}};b.open("POST","http://api.imgur.com/2/upload.json",true);b.send(a)}return false};$("image").ondragleave=function(a){a.preventDefault();$("image").setStyle("border-color: #ddd;");return false}}}
function z_engine_get_klout(a,b,c){if(klout[b]){a=klout[b].evalJSON(true);z_engine_set_klout(a,c)}else socket.emit("message",{klout:a,id_str:c})}function z_engine_logout(){socket.disconnect();$("new-tweet").disable();$("new-tweet").setValue("see ya!");store.remove("friends");store.remove("screen_name");store.remove("user_id");window.location="/oauth/logout"}
function z_engine_notification(a,b,c){if(BrowserDetect.browser=="MSIE"&&BrowserDetect.version>=9||BrowserDetect.browser!="MSIE")audio.play();if(c==null)c="";if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==0){var d=window.webkitNotifications.createNotification(a,b,c);d.show();setTimeout(function(){d.cancel()},5E3)}else if(window.webkitNotifications&&window.webkitNotifications.checkPermission()==1){window.webkitNotifications.requestPermission();growler.growl(z_engine_parse_tweet(b),
z_engine_parse_tweet(c))}else if(!window.webkitNotifications||window.webkitNotifications&&window.webkitNotifications.checkPermission()==2)growler.growl(z_engine_parse_tweet(b),z_engine_parse_tweet(c))}function z_engine_notification_setup(){window.webkitNotifications&&window.webkitNotifications.checkPermission()==1&&window.webkitNotifications.requestPermission()}function z_engine_parse_tweet(a){if(a){a=twttr.txt.autoLink(a);a=a.replace(/\n\r?/g,"<br />")}return a}
function z_engine_prune_tweets(){var a=$("home-timeline").childElements();a.length>=home_cutoff&&a.each(function(b,c){c>home_cutoff&&$(b).remove()});setTimeout(function(){var b=$("mentions-timeline").childElements();b.length>=mentions_cutoff&&b.each(function(c,d){d>mentions_cutoff&&$(c).remove()})},1E4);setTimeout(function(){var b=$("dms-inbox-timeline").childElements();b.length>=dms_cutoff&&b.each(function(c,d){d>dms_cutoff&&$(c).remove()})},2E4);setTimeout(function(){var b=$("dms-outbox-timeline").childElements();
b.length>=dms_cutoff&&b.each(function(c,d){d>dms_cutoff&&$(c).remove()})},3E4);setTimeout(function(){var b=$("threaded-timeline").childElements();b.length>=threaded_cutoff&&b.each(function(c,d){d>threaded_cutoff&&$(c).remove()})},4E4)}function z_engine_remember_author(a){a="@"+a;var b="",c=false;$w(store.get("users")).uniq().each(function(d,j){if(j<=199)if(d==a)c=true;else b+=" "+d});c||(b=a+" "+b);store.set("users",b.strip())}
function z_engine_reply(a,b,c){reply_id=b;$("new-tweet").setValue("@"+a+" "+c);$("new-tweet").focus()}function z_engine_reply_dm(a){dm_to=a;$("new-tweet").setValue("~");$("new-tweet").focus()}function z_engine_retweet(a){socket.emit("message",{retweet:{status:{id_str:a}}})}function z_engine_retweet_comment(a,b,c){reply_id=a;a=(new Element("textarea")).update(c.replace(/</g,"&lt;").replace(/>/g,"&gt;").strip());$("new-tweet").setValue("RT @"+b+" "+a.getValue());$("new-tweet").focus()}
function z_engine_send_tweet(){if($("new-tweet").getValue().length>0&&$("new-tweet").getValue().length<=140){$("new-tweet").disable();var a=$("new-tweet").getValue().strip(),b=new Hash;if(dm_to){if(a.startsWith("~"))a=a.replace(/~/i,"");b={direct_message:{text:a,user_id:dm_to}}}else{b={status:{status:a,include_entities:true}};latitude&&longitude&&new Object.extend(b.status,{display_coordinates:true,lat:latitude,"long":longitude});reply_id&&new Object.extend(b.status,{in_reply_to_status_id:reply_id})}socket.emit("message",
b);dm_to=reply_id=false;$("new-tweet").setValue("");$("new-tweet").enable()}}
function z_engine_set_klout(a,b){if(typeof a=="object")if(a.length>0&&typeof b=="string"){var c=Math.round(a[0].score.network_score),d=Math.round(a[0].score.true_reach),j="score: <strong>"+Math.round(a[0].score.kscore)+"</strong><br />";j+="amp: <strong>"+Math.round(a[0].score.amplification_score)+"</strong><br />";j+="network: <strong>"+c+"</strong><br />";j+="reach: <strong>"+d+"</strong><br />";if($("klout-"+b)){$("klout-"+b).addTip(j,kloutinfo_params);$("klout-"+b).setAttribute("src","img/kltd.png");
$("klout-"+b).setAttribute("title","")}if($("klout-"+b+"-mentioned")){$("klout-"+b+"-mentioned").addTip(j,kloutinfo_params);$("klout-"+b+"-mentioned").setAttribute("src","img/kltd.png");$("klout-"+b+"-mentioned").setAttribute("title","")}}}function z_engine_shorten_urls(){var a=$("new-tweet").getValue();a.length>0&&a.replace(/((https?\:\/\/)|(www\.))([^ \(\)\{\}\[\]]+)/g,function(b){socket.emit("message",{shorten:b})})}
function z_engine_stream_queue(){if(content_queued.length>0){var a=content_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"home")}}if(content_mentions_queued.length>0){a=content_mentions_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"mentions")}}if(content_dms_queued.length>0){a=content_dms_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"dms")}}if(content_threads_queued.length>
0){a=content_threads_queued.shift();if(typeof a=="string")if(a.isJSON()){a=a.evalJSON(true);z_engine_tweet(a,"threaded")}}}
function z_engine_threaded(a,b){if(a){if($("home-timeline").visible())var c="home-timeline";if($("mentions-timeline").visible())c="mentions-timeline";if(z_engine_css3()){$(c).addClassName("hider").removeClassName("shower");setTimeout(function(){$("threaded-timeline").addClassName("shower").removeClassName("hider")},500)}else new Effect.Parallel([new Effect.Fade(c,{duration:0.5,mode:"relative"}),new Effect.Appear("threaded-timeline",{delay:0.51,duration:0.5,mode:"relative"})],{duration:1});socket.emit("message",
{show:{id_str:a}})}else socket.emit("message",{show:{id_str:b}})}
function z_engine_tweet(a,b){if(b!="dms")if(a.retweeted_status){c=a.retweeted_status.user.screen_name;d=a.user.screen_name;j=a.retweeted_status.user.profile_image_url;h=(new Date(a.retweeted_status.created_at)).toLocaleString().replace(/GMT.+/,"");i=a.retweeted_status.user.description;f=a.retweeted_status.entities;t=a.retweeted_status.favorited;g=a.retweeted_status.user.followers_count;k=a.retweeted_status.user.friends_count;e=a.retweeted_status.id_str;n=a.retweeted_status.user.location;A=a.retweeted_status.user["protected"];
p=a.retweeted_status.place;m=a.retweeted_status.in_reply_to_screen_name;x=a.retweeted_status.in_reply_to_status_id_str;o=a.retweeted_status.retweet_count;q=true;E=a.retweeted_status.source.stripTags();v=a.retweeted_status.text;y=a.retweeted_status.user.statuses_count;z=a.retweeted_status.user.id;r=a.retweeted_status.user.verified}else var c=a.user.screen_name,d=false,j=a.user.profile_image_url,h=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,""),i=a.user.description,f=a.entities,t=a.favorited,
g=a.user.followers_count,k=a.user.friends_count,e=a.id_str,n=a.user.location,A=a.user["protected"],p=a.place,m=a.in_reply_to_screen_name,x=a.in_reply_to_status_id_str,o=a.retweet_count,q=false,E=a.source.stripTags(),v=a.text,y=a.user.statuses_count,z=a.user.id,r=a.user.verified;else{c=a.sender.screen_name;j=a.sender.profile_image_url;h=(new Date(a.created_at)).toLocaleString().replace(/GMT.+/,"");i=a.sender.description;f=false;g=a.sender.followers_count;k=a.sender.friends_count;e=a.id_str;n=a.sender.location;
A=false;m=a.recipient.screen_name;o=0;q=false;v=a.text;y=a.sender.statuses_count;z=a.sender_id;r=a.sender.verified}var I=false,J=false,K=false,L=false,s=false;if(b!="threaded"&&content_stored[e])s=true;b!="dms"&&$w(store.get("client_blocks")).uniq().each(function(w){if(w.replace("'","")==E)I=true});if(f){typeof f.hashtags=="object"&&$w(store.get("hashtag_blocks")).uniq().each(function(w){f.hashtags.uniq().each(function(F){if(w==F)J=true})});typeof f.user_mentions=="object"&&$w(store.get("mention_blocks")).uniq().each(function(w){f.user_mentions.uniq().each(function(F){if(w==
F)K=true})})}$w(store.get("user_blocks")).uniq().each(function(w){if(w==c)L=true});if(!s&&!I&&!J&&!K&&!L){(new Image).src=j;content_stored[e]=true;z_engine_remember_author(c);s="";if(i!=null)s+=i+"<br /><br />";if(n!=null)s+="location: "+n+"<br />";s+="tweets: <strong>"+y+"</strong><br />";s+="following: <strong>"+k+"</strong><br />";s+="followers: <strong>"+g+"</strong>";if(f){n=z_engine_tweet_mentioned(f);i=z_engine_tweet_mentioned_string(f)}else i=n=false;var D=new Element("br");g=b!="dms"?new Element("div",
{ondblclick:'z_engine_reply("'+c+'", "'+e+'", "'+i+'");',id:"comment-"+e,"class":"comment-parent"}):new Element("div",{ondblclick:'z_engine_reply_dm("'+z+'", "'+c+'");',id:"comment-"+e,"class":"comment-parent"});y=new Element("div",{"class":"comment-profile-wrapper left"});var B=new Element("div",{"class":"comment-gravatar"});k=new Element("img",{id:"av-"+e,src:j,style:"height: 50px; width: 50px; cursor: pointer;",alt:""});B.insert(k);y.insert(B);B=new Element("div",{id:"comment-"+e+"content","class":"comment-content-wrapper right"});
var C=c!=screen_name?n?new Element("div",{"class":"comment-body-mentioned"}):new Element("div",{"class":"comment-body"}):new Element("div",{"class":"comment-body-me"}),l=new Element("div",{"class":"comment-arrow"});C.insert(l);var G=new Element("div",{"class":"post-date"});l=new Element("div",{"class":"left",id:"left-"+e});var M=new Element("a",{target:"_blank",href:"http://twitter.com/"+c});M.update("@"+c+" ");var N=new Element("span");N.update("wrote this ");if(b!="dms")var u=new Element("a",{target:"_blank",
id:"comment-"+e+"-relative-date",href:"http://twitter.com/"+c+"/status/"+e});var H=new Element("time",{datetime:h,"class":b});H.update(relative_time(h));b!="dms"&&u.insert(H);l.insert(M);l.insert({bottom:N});if(b!="dms"){l.insert({bottom:u});if(x){h=new Element("span");h.update(" in reply to ");u=b=="threaded"?new Element("a",{target:"_blank",href:"http://twitter.com/"+m+"/status/"+x}):new Element("span",{onclick:'z_engine_threaded("'+e+'","'+x+'");',style:"cursor: pointer;"});u.update(m+" ");l.insert(h);
l.insert({bottom:u})}m=new Element("span",{"class":"via"});m.update(" via "+E);l.insert({bottom:m})}else{l.insert({bottom:H});if(m){h=new Element("span");h.update(" in reply to ");u=new Element("a",{target:"_blank",href:"http://twitter.com/"+m});u.update(m+" ");l.insert(h);l.insert({bottom:u})}}if(r){r=new Element("span");r.update(" ");m=new Element("img",{src:"img/ver.png",alt:"",title:"verified user"});r.insert({bottom:m});l.insert({bottom:r})}G.insert(l);r=new Element("div",{"class":"right"});
if(q){q=o>0?"retweeted by "+d+" and "+o+" others!":"retweeted by "+d+"!";o=new Element("span",{"class":"rtd"});o.update(" ");q=new Element("img",{src:"img/rtd2.png",alt:"",title:q});m=new Element("a",{target:"_blank",href:"http://twitter.com/"+d});m.update(d);o.insert({top:q});o.insert({bottom:m});r.insert({bottom:o})}if(b!="dms"&&p&&p.full_name){d=new Element("span",{"class":"place"});p=new Element("a",{target:"_blank",href:"http://maps.google.com?q="+p.full_name});o=new Element("img",{src:"img/plc.png",
alt:""});p.update(o);d.update(p);r.insert({bottom:d})}G.insert({bottom:r});C.insert({bottom:G});d=new Element("div",{"class":"clearer"});d.update("&nbsp;");C.insert({bottom:d});o=new Element("div",{"class":"comment-text"});q=new Element("p",{id:"comment-"+e+"-text"});p=new Element("div",{id:"right-"+e,"class":"right"});q.insert(D);q.insert({bottom:p});D=new Element("div",{id:"text-"+e});D.update(z_engine_parse_tweet(v));q.insert({bottom:D});o.insert(q);C.insert({bottom:o});B.insert(C);g.insert(y);
g.insert({bottom:B});g.insert({bottom:d});new Element.extend(k);new Element.extend(l);new Element.extend(p);new Element.extend(g);switch(b){case "dms":if(c!=screen_name)$("dms-inbox-timeline").insert({top:g});else c==screen_name&&$("dms-outbox-timeline").insert({top:g});break;case "home":$("home-timeline").insert({top:g});break;case "mentions":$("mentions-timeline").insert({top:g})}if(n&&b!="mentions"&&b!="threaded"&&c!=screen_name&&!a.retweeted_status){n=cloneNodeWithEvents(g);n.setAttribute("id",
"comment-"+e+"-mentioned");l.setAttribute("id","left-"+e+"-mentioned");p.setAttribute("id","right-"+e+"-mentioned");k.setAttribute("id","av-"+e+"-mentioned");new Element.extend(n);$("mentions-timeline").insert({top:n});z_engine_tweet_buttons("mentions",e,c,z,v,A,t,i,s);z_engine_notification(j,"@"+c+" mentioned you!",v);z_engine_fade_down("comment-"+e+"-mentioned")}if(b=="threaded"){l.setAttribute("id","left-"+e+"-threaded");p.setAttribute("id","right-"+e+"-threaded");k.setAttribute("id","av-"+e+"-threaded");
j=cloneNodeWithEvents(g);j.setAttribute("id","comment-"+e+"-threaded");new Element.extend(j);$("threaded-timeline").insert({bottom:j});z_engine_tweet_buttons("threaded",e,c,z,v,A,t,i,s);z_engine_fade_down("comment-"+e+"-threaded")}if($("comment-"+e)){z_engine_tweet_buttons(b,e,c,z,v,A,t,i,s);z_engine_fade_down("comment-"+e)}}b=="threaded"&&x&&z_engine_threaded(false,x)}
function z_engine_tweet_buttons(a,b,c,d,j,h,i,f,t){var g=[{name:"reply",callback:function(){z_engine_reply(c,b,f)}},{name:"rt (new)",callback:function(){z_engine_retweet(b)}},{name:"rt (old)",callback:function(){z_engine_retweet_comment(b,c,j)}},{name:"favorite",callback:function(){z_engine_favorite(b)}}],k=[{name:"delete",callback:function(){z_engine_destroy(b,"tweet")}}],e=[{name:"reply",callback:function(){z_engine_reply(c,b,f)}},{name:"delete",callback:function(){z_engine_destroy(b,"dm")}}],n=
[{name:"delete",callback:function(){z_engine_destroy(b,"dm")}}];switch(a){case "dms":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(t),userinfo_params);if(c!=screen_name){k=new Element("img",{onclick:'z_engine_reply_dm("'+d+'", "'+c+'");',src:"img/rep.png",id:"reply-"+b,alt:""});new Element.extend(k);$("right-"+b).insert(k);new Proto.Menu({selector:"#comment-"+b,className:"menu",menuItems:e})}else new Proto.Menu({selector:"#comment-"+b,className:"menu",menuItems:n});g=new Element("img",{onclick:'z_engine_destroy("'+
b+'", "dm");',src:"img/del.png",id:"del-"+b,alt:""});new Element.extend(g);$("right-"+b).insert({bottom:g});break;case "home":$("av-"+b)&&$("av-"+b).addTip(z_engine_parse_tweet(t),userinfo_params);if($("left-"+b)&&!$("klout-"+b)){e=new Element("span",{"class":"klout"});e.update(" ");d=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+d+'", "'+b+'");',src:"img/klt.png",id:"klout-"+b,alt:"",title:"click to get this users klout score"});e.insert({top:d});new Element.extend(d);$("left-"+b).insert({top:e})}if(c!=
screen_name){k=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+f+'");',id:"reply-"+b,alt:""});new Element.extend(k);if(h)h=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{h=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+b+'");',id:"rt-"+b,alt:""});new Element.extend(h)}i=i?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',id:"fave-"+b,alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+
b+'");',id:"fave-"+b,alt:""});new Element.extend(i);$("right-"+b).update();$("right-"+b).insert(k);$("right-"+b).insert({bottom:h});$("right-"+b).insert({bottom:i});new Proto.Menu({selector:"#comment-"+b,className:"menu",menuItems:g})}else{g=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"img/del.png",id:"del-"+b,alt:""});new Element.extend(g);$("right-"+b).update();$("right-"+b).insert({bottom:g});new Proto.Menu({selector:"#comment-"+b,className:"menu",menuItems:k})}break;case "mentions":$("av-"+
b+"-mentioned")&&$("av-"+b+"-mentioned").addTip(z_engine_parse_tweet(t),userinfo_params);if($("left-"+b+"-mentioned")&&!$("klout-"+b+"-mentioned")){e=new Element("span",{"class":"klout"});e.update(" ");d=new Element("img",{onclick:'z_engine_get_klout("'+c+'", "'+d+'", "'+b+'");',src:"img/klt.png",id:"klout-"+b+"-mentioned",alt:"",title:"click to get this users klout score"});e.insert({top:d});new Element.extend(d);$("left-"+b+"-mentioned").insert({top:e})}if(c!=screen_name){k=new Element("img",{src:"img/rep.png",
onclick:'z_engine_reply("'+c+'", "'+b+'-mentioned", "'+f+'");',id:"reply-"+b+"-mentioned",alt:""});new Element.extend(k);if(h)h=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{h=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+b+'");',id:"rt-"+b+"-mentioned",alt:""});new Element.extend(h)}i=i?new Element("img",{src:"img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',id:"fave-"+b+"-mentioned",alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+
b+'");',id:"fave-"+b+"-mentioned",alt:""});new Element.extend(i);if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert(k);$("right-"+b).insert({bottom:h});$("right-"+b).insert({bottom:i})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert(k);$("right-"+b+"-mentioned").insert({bottom:h});$("right-"+b+"-mentioned").insert({bottom:i})}$("comment-"+b)&&new Proto.Menu({selector:"#comment-"+b,className:"menu",menuItems:g});$("comment-"+b+"-mentioned")&&
new Proto.Menu({selector:"#comment-"+b+"-mentioned",className:"menu",menuItems:g})}else{g=new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"img/del.png",id:"del-"+b+"-mentioned",alt:""});new Element.extend(g);if($("right-"+b)){$("right-"+b).update();$("right-"+b).insert({bottom:g})}if($("right-"+b+"-mentioned")){$("right-"+b+"-mentioned").update();$("right-"+b+"-mentioned").insert({bottom:g})}new Proto.Menu({selector:"#comment-"+b+"-mentioned",className:"menu",menuItems:k})}break;
case "threaded":$("av-"+b+"-threaded")&&$("av-"+b+"-threaded").addTip(z_engine_parse_tweet(t),userinfo_params);if(c!=screen_name){k=new Element("img",{src:"img/rep.png",onclick:'z_engine_reply("'+c+'", "'+b+'", "'+f+'");',id:"reply-"+b+"-threaded",alt:""});new Element.extend(k);if(h)h=new Element("img",{src:"img/lock.png",style:"cursor: default;",alt:""});else{h=new Element("img",{src:"img/rt.png",onclick:'z_engine_retweet("'+b+'");',id:"rt-"+b+"-threaded",alt:""});new Element.extend(h)}i=i?new Element("img",
{src:"img/favd.png",onclick:'z_engine_unfavorite("'+b+'");',id:"fave-"+b+"-threaded",alt:""}):new Element("img",{src:"img/fav.png",onclick:'z_engine_favorite("'+b+'");',id:"fave-"+b+"-threaded",alt:""});new Element.extend(i);if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert(k);$("right-"+b+"-threaded").insert({bottom:h});$("right-"+b+"-threaded").insert({bottom:i})}new Proto.Menu({selector:"#comment-"+b+"-threaded",className:"menu",menuItems:g})}else{g=
new Element("img",{onclick:'z_engine_destroy("'+b+'", "tweet");',src:"img/del.png",id:"del-"+b+"-threaded",alt:""});new Element.extend(g);if($("right-"+b+"-threaded")){$("right-"+b+"-threaded").update();$("right-"+b+"-threaded").insert({bottom:g})}new Proto.Menu({selector:"#comment-"+b+"-threaded",className:"menu",menuItems:k})}}}function z_engine_tweet_mentioned(a){var b=false;a.user_mentions.uniq().each(function(c){if(c.screen_name==screen_name)b=true});return b}
function z_engine_tweet_mentioned_string(a){var b="";a.user_mentions.uniq().each(function(c){if(c.screen_name!=screen_name)b+="@"+c.screen_name+" "});return $w(b).uniq().join(" ")+" "}function z_engine_tweet_pause(){if(paused){paused=false;new Effect.Fade("paused-count",{afterFinish:function(){$("paused-count").update("(0)");$("pause").update("stop");pttid=0}})}else{paused=true;$("pause").update("start");$("paused-count").appear()}}
function z_engine_unfavorite(a){socket.emit("message",{unfavorite:{status:{id_str:a}}});if($("fave-"+a)){$("fave-"+a).writeAttribute("src","img/fav.png");$("fave-"+a).writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"mentioned")){$("fave-"+a+"-mentioned").writeAttribute("src","img/fav.png");$("fave-"+a+"-mentioned").writeAttribute("onclick","z_engine_favorite('"+a+"');")}if($("fave-"+a+"threaded")){$("fave-"+a+"-threaded").writeAttribute("src","img/fav.png");$("fave-"+a+"-threaded").writeAttribute("onclick",
"z_engine_favorite('"+a+"');")}}function z_engine_update_relative_time(a){$$(a).length>0&&$$(a).each(function(b){var c=b.getAttribute("datetime");b.update(relative_time(c))})};
